<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Fish, PP" />










<meta name="description" content="深入浅出WPF知识点小结">
<meta name="keywords" content="Nice body">
<meta property="og:type" content="article">
<meta property="og:title" content="DeepInWPF">
<meta property="og:url" content="http://yoursite.com/2018/06/23/DeepInWPF/index.html">
<meta property="og:site_name" content="Psmyfish">
<meta property="og:description" content="深入浅出WPF知识点小结">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-06-26T09:43:31.252Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DeepInWPF">
<meta name="twitter:description" content="深入浅出WPF知识点小结">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/06/23/DeepInWPF/"/>





  <title>DeepInWPF | Psmyfish</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
<a href="https://github.com/psmyfish" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Psmyfish</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">what is this fish?</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/23/DeepInWPF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Psmyfish">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Psmyfish">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">DeepInWPF</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-23T10:56:24+08:00">
                2018-06-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn-everyday/" itemprop="url" rel="index">
                    <span itemprop="name">learn everyday</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>深入浅出WPF知识点小结</strong></p>
<hr>
<a id="more"></a>
<p>在XAML中为对象属性赋值的三种形式</p>
<ol>
<li>Attribute=Value形式</li>
<li>属性标签</li>
<li>标签扩展</li>
</ol>
<h2 id="TypeConverter"><a href="#TypeConverter" class="headerlink" title="TypeConverter"></a>TypeConverter</h2><p>其实wpf中xaml窗口中的属性定义的Value很多都是字符串，但是仍然可以转换为目标对象类型。这就和TypeConverter脱不了干系。我们自己实现一次对此有更深入的理解。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public partial class MainWindow : Window</span><br><span class="line">    &#123;</span><br><span class="line">        public MainWindow()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line">        private void button_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Human h = (Human)this.FindResource(&quot;human&quot;);</span><br><span class="line">            MessageBox.Show(h.Child.Name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [TypeConverterAttribute(typeof(StringToHumanTypeConverter))]</span><br><span class="line">    public class Human</span><br><span class="line">    &#123;</span><br><span class="line">        public string Name &#123; get; set; &#125;</span><br><span class="line">        public Human Child &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class StringToHumanTypeConverter:TypeConverter</span><br><span class="line">    &#123;</span><br><span class="line">        public override object ConvertFrom(ITypeDescriptorContext context, CultureInfo culture, object value)</span><br><span class="line">        &#123;</span><br><span class="line">            if (value is string )</span><br><span class="line">            &#123;</span><br><span class="line">                Human h = new Human();</span><br><span class="line">                h.Name = value as string;</span><br><span class="line">                return h;</span><br><span class="line">            &#125;</span><br><span class="line">            return base.ConvertFrom(context, culture, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;local:Human x:Key=&quot;human&quot; Child=&quot;ABC&quot;/&gt;</span><br><span class="line">    &lt;/Window.Resources&gt;</span><br></pre></td></tr></table></figure>
<h2 id="属性标签"><a href="#属性标签" class="headerlink" title="属性标签"></a>属性标签</h2><p>所谓属性标签，居然就是简单的.+扩展的属性.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Width=&quot;30&quot; Height=&quot;30&quot; Button.Click=&quot;ButtonClick&quot; &gt;</span><br><span class="line">            &lt;Button.Content&gt;</span><br><span class="line">                &lt;Rectangle Width=&quot;30&quot; Height=&quot;30&quot; Stroke=&quot;Black&quot; Fill=&quot;red&quot;/&gt;</span><br><span class="line">            &lt;/Button.Content&gt;</span><br><span class="line">        &lt;/Button&gt;</span><br></pre></td></tr></table></figure>
<p>其中Button.Content即为属性标签的用法。</p>
<p>xmal是生命性语言，也就是说声明Button.Content属性对象中要增加的东西。</p>
<p>下面看LinearGradientBrush的完全体，这个纯属个人需求，读者可以掠过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;Rectangle x:Name=&quot;rectangle&quot; Width=&quot;200&quot; Height=&quot;120&quot;&gt;</span><br><span class="line">            &lt;Rectangle.Fill&gt;</span><br><span class="line">                &lt;LinearGradientBrush&gt;</span><br><span class="line">                    &lt;LinearGradientBrush.StartPoint&gt;</span><br><span class="line">                        &lt;Point X=&quot;0&quot; Y=&quot;0&quot;&gt;&lt;/Point&gt;</span><br><span class="line">                    &lt;/LinearGradientBrush.StartPoint&gt;</span><br><span class="line">                    &lt;LinearGradientBrush.EndPoint&gt;</span><br><span class="line">                        &lt;Point X=&quot;1&quot; Y=&quot;1&quot;/&gt;</span><br><span class="line">                    &lt;/LinearGradientBrush.EndPoint&gt;</span><br><span class="line">                    &lt;LinearGradientBrush.GradientStops&gt;</span><br><span class="line">                        &lt;GradientStopCollection&gt;</span><br><span class="line">                            &lt;GradientStop Offset=&quot;0.2&quot; Color=&quot;LightBlue&quot;/&gt;</span><br><span class="line">                            &lt;GradientStop Offset=&quot;0.5&quot; Color=&quot;Blue&quot;/&gt;</span><br><span class="line">                            &lt;GradientStop Offset=&quot;0.8&quot; Color=&quot;DarkBlue&quot;/&gt;</span><br><span class="line">                        &lt;/GradientStopCollection&gt;</span><br><span class="line">                    &lt;/LinearGradientBrush.GradientStops&gt;</span><br><span class="line">                &lt;/LinearGradientBrush&gt;</span><br><span class="line">            &lt;/Rectangle.Fill&gt;</span><br><span class="line">        &lt;/Rectangle&gt;</span><br></pre></td></tr></table></figure>
<h2 id="标签扩展"><a href="#标签扩展" class="headerlink" title="标签扩展"></a>标签扩展</h2><p>就是花括号的形式。。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;sys:String x:Key=&quot;stringHello&quot;&gt;Hello Her!&lt;/sys:String&gt;</span><br><span class="line">    &lt;/Window.Resources&gt;</span><br><span class="line">    &lt;Grid&gt;</span><br><span class="line">        &lt;TextBlock Height=&quot;24&quot; Width=&quot;120&quot; Background=&quot;LightBlue&quot; </span><br><span class="line">                   Text=&quot;&#123;StaticResource ResourceKey=stringHello&#125;&quot;/&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>{StaticResource}</li>
<li>{DynamicResource}</li>
<li>{Binding }</li>
</ul>
<hr>
<p>内容分布</p>
<ol>
<li>事件处理器与代码后置</li>
<li>导入程序集和引用其中的命名空间</li>
<li>XAML的注释</li>
</ol>
<h2 id="事件处理器与代码后置"><a href="#事件处理器与代码后置" class="headerlink" title="事件处理器与代码后置"></a>事件处理器与代码后置</h2><p>事件响应者:事件处理器-&gt;订阅事件-&gt;事件的拥有者:事件。</p>
<p>可以用简单的Button  Click事件来理解。除了xaml方式添加事件订阅 ，也可以用C#代码的方式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.button.Click += Button_Click1;</span><br></pre></td></tr></table></figure>
<h2 id="导入程序集和引用其中的命名空间"><a href="#导入程序集和引用其中的命名空间" class="headerlink" title="导入程序集和引用其中的命名空间"></a>导入程序集和引用其中的命名空间</h2><p>同一sln中引用自己开发的自定义控件时，也需要先添加引用add Reference.</p>
<p>然后在要用的地方，如Window 中 </p>
<p><code>xmlns:controls=&quot;clr-namespace:HerLib;assembly=HerLib&quot;</code></p>
<p>引用其他公司的程序集，也是先添加引用。</p>
<p>然后如果有https方式就用，没有就照常引用。</p>
<h2 id="XAML的注释"><a href="#XAML的注释" class="headerlink" title="XAML的注释"></a>XAML的注释</h2><p>和C#注释一样，两组快捷键Ctrl+EC EU  Ctrl+KC KU</p>
<hr>
<p>厉害的x名称空间</p>
<ol>
<li>x名称空间的由来和作用</li>
<li>x名称空间里都有什么</li>
<li>x:Class</li>
<li>x:ClassModifier</li>
<li>x:Name</li>
<li>x:FieldModifier</li>
</ol>
<h2 id="名称空间的由来和作用"><a href="#名称空间的由来和作用" class="headerlink" title="名称空间的由来和作用"></a>名称空间的由来和作用</h2><p><code>xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</code></p>
<p>专门用来解析和分析xaml文档的命名空间，大概可以理解为包含了很多”using”.就是“XAML名称空间”</p>
<h2 id="x名称空间里都有什么"><a href="#x名称空间里都有什么" class="headerlink" title="x名称空间里都有什么"></a>x名称空间里都有什么</h2><p>Tools：</p>
<ul>
<li>x:Array</li>
<li>x:Class</li>
<li>x:ClassModifier</li>
<li>x:Code</li>
<li>x:FieldModifier</li>
<li>x:Key</li>
<li>x:Name</li>
<li>x:Null</li>
<li>x:Shared</li>
<li>x:Static</li>
<li>x:Subclass</li>
<li>x:Type</li>
<li>x:TypeArguments</li>
<li>x:Uid</li>
<li>x:XData</li>
</ul>
<h2 id="x-Class"><a href="#x-Class" class="headerlink" title="x:Class"></a>x:Class</h2><p><code>x:Class=&quot;V3.引用&quot;</code></p>
<p>实际也是声明了一个partial class。即WPF设计是想要把页面设置和后台代码分开。XAML里的partial class专注于设计，代码的专注于逻辑。</p>
<h2 id="x-ClassModifier"><a href="#x-ClassModifier" class="headerlink" title="x:ClassModifier"></a>x:ClassModifier</h2><p><code>&lt;Window x:Class=&quot;V3.引用&quot; x:ClassModifier=&quot;internal&quot;...&gt;</code></p>
<p>只是改了xaml还不够，上面可以知道还得改C#</p>
<p><code>internal partial class 引用 : Window</code></p>
<h2 id="x-Name"><a href="#x-Name" class="headerlink" title="x:Name"></a>x:Name</h2><p>为对象准备一个引用变量方便在C#中直接访问。类似搞个指针？</p>
<p>对应到Unity，应该就是public一个变量命名并且拖过来。</p>
<p>声明一个引用变量，并且检查改对象是否有Name属性，没有就给他赋值，把name注册到WPF树里。</p>
<p>对于派生自FrameworkElement类的元素，都是有Name属性的，对于他们Name 和x:Name是同样的。但是其他就不同了</p>
<h2 id="x-FieldModifier"><a href="#x-FieldModifier" class="headerlink" title="x:FieldModifier"></a>x:FieldModifier</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid&gt;</span><br><span class="line">	&lt;TextBox x:FieldModifier=&quot;private&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">&lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>意思说xaml  的partial 类里定义的基本都是public ，这个x:FieldModifier就是给它设置权限的。</p>
<hr>
<h1 id="控件与布局"><a href="#控件与布局" class="headerlink" title="控件与布局"></a>控件与布局</h1><p>常用控件:</p>
<ol>
<li>布局控件: Grid StackPanel</li>
<li>内容控件: Window Button</li>
<li>带标题内容控件:GroupBox  TabItem</li>
<li>条目控件:ListBox  ComboBox</li>
<li>带标题条目控件:TreeViewItem  MenuItem</li>
<li>特殊内容控件:Image  TextBox</li>
</ol>
<h1 id="Binding"><a href="#Binding" class="headerlink" title="Binding"></a>Binding</h1><h2 id="Data-Binding在WPF中的地位"><a href="#Data-Binding在WPF中的地位" class="headerlink" title="Data Binding在WPF中的地位"></a>Data Binding在WPF中的地位</h2><p>它说程序的本质是数据加算法。数据在存储/逻辑/展示3个层流通。但是算法一般分布在这几处:</p>
<ol>
<li>数据库内部</li>
<li>读取与写回数据</li>
<li>业务逻辑</li>
<li>数据展示</li>
<li>界面与逻辑的交互</li>
</ol>
<p>理解WPF的数据驱动UI</p>
<p>Binding通过Path来指定关心的哪个属性，当值变化后属性还要有通知Binding的能力：一般在Set中激发PropertyChanged事件。实现System.ComponentModel名称空间中的InotifyPropertyChanged接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public partial class BindingBasic : Window</span><br><span class="line">   &#123;</span><br><span class="line">       Student stu;</span><br><span class="line">       public BindingBasic()</span><br><span class="line">       &#123;</span><br><span class="line">           InitializeComponent();</span><br><span class="line">           stu = new Student();</span><br><span class="line">           Binding binding = new Binding();</span><br><span class="line">           binding.Source = stu;</span><br><span class="line">           binding.Path = new PropertyPath(&quot;Name&quot;);</span><br><span class="line">           BindingOperations.SetBinding(this.textBox, TextBox.TextProperty, binding);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       private void ButtonClick(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           stu.Name += &quot;Name&quot;;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   public class Student:INotifyPropertyChanged</span><br><span class="line">   &#123;</span><br><span class="line">       public event PropertyChangedEventHandler PropertyChanged;</span><br><span class="line">       private string name;</span><br><span class="line">       public string Name</span><br><span class="line">       &#123;</span><br><span class="line">           get &#123; return name; &#125;</span><br><span class="line">           set</span><br><span class="line">           &#123;</span><br><span class="line">               name = value;</span><br><span class="line">               if (this.PropertyChanged!=null)</span><br><span class="line">               &#123;</span><br><span class="line">                   PropertyChanged.Invoke(this,new PropertyChangedEventArgs(&quot;Name&quot;));</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><code>BindingOperations.SetBinding(this.textBox, TextBox.TextProperty, binding);</code></p>
<p><code>public class Student:INotifyPropertyChanged</code></p>
<p>比较重要的就是上面两条。</p>
<p>实际工作中有简化。因为FrameworkElement对BindingOperations.SetBinding()方法进行了封装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public BindingExpressionBase SetBinding(DependencyProperty dp,BindingBase binding)</span><br><span class="line">&#123;</span><br><span class="line">    return BindingOperations.SetBinding(this,dp,binding);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有经验就继续</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public Window1()</span><br><span class="line">&#123;</span><br><span class="line">    InitializeComponent();</span><br><span class="line">    this.textBox.SetBinding(TextBox.TextProperty,new Binding(&quot;Name&quot;)&#123;Source=stu=new Student()&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="控制Binding的方向及数据更新"><a href="#控制Binding的方向及数据更新" class="headerlink" title="控制Binding的方向及数据更新"></a>控制Binding的方向及数据更新</h3><p>控制Binding数据流向的属性是Mode，它的类型是BindingMode枚举。取值为TwoWay,OneWay,OnTime,OneWayToSource,Default.</p>
<p>控制更新的属性UpdateSourceTrigger.枚举为PropertyChanged,LostFocus,Explicit,Default.</p>
<h3 id="没有Path的binding"><a href="#没有Path的binding" class="headerlink" title="没有Path的binding"></a>没有Path的binding</h3><p>如果Binding源本身就是数据且不需要path来指明，如string,int等基本类型。那么就可以把Path设定为.  xaml中可以不写.   C#中必须写. 0</p>
<p><code>Text=&quot;{Binding Source={StaticResource ResourceKey=myString}}&quot;</code> </p>
<p><code>Text=&quot;{Binding ., Source={StaticResource ResourceKey=myString}}</code></p>
<h3 id="为Binding指定源-Source-的几种方法"><a href="#为Binding指定源-Source-的几种方法" class="headerlink" title="为Binding指定源(Source)的几种方法"></a>为Binding指定源(Source)的几种方法</h3><p>常见的办法有</p>
<ul>
<li>把普通CLR单个对象指定为Source</li>
<li>把普通CLR集合类型对象指定为Source，包括数组、List<t>、ObservableCollection&lt;&gt; 。</t></li>
<li>ADO.NET数据对象指定为Source:DataTable和DataView等对象</li>
<li>用XmlDataProvider把XML数据指定为Source :</li>
<li>把依赖对象(Dependency Object)指定为Source:即可以成目标也可以成源。可以形成Binding链。</li>
<li>把容器的DataContext指定为Source，设置Path而不设置Source，让Binding自己去找Source。</li>
<li>通过ElementName指定Source：</li>
<li>通过Binding的RelativeSource属性相对地指定Source：控件关注自己的和内部元素的某个值。</li>
<li>把ObjectDataProvider对象指定为Source：</li>
<li>把LINQ检索得到的数据对象作为Bingding的源。</li>
</ul>
<h3 id="没有Source的Binding-使用DataContext作为Binding源"><a href="#没有Source的Binding-使用DataContext作为Binding源" class="headerlink" title="没有Source的Binding__使用DataContext作为Binding源"></a>没有Source的Binding__使用DataContext作为Binding源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Student</span><br><span class="line">&#123;</span><br><span class="line">    public int Id&#123;get;set;&#125;</span><br><span class="line">    public String Name&#123;get;set;&#125;</span><br><span class="line">    public int Age&#123;get;set;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;StackPanel.DataContext&gt;</span><br><span class="line">            &lt;local:Student Id=&quot;6&quot; Age=&quot;29&quot; Name=&quot;Tim&quot;&gt;&lt;/local:Student&gt;</span><br><span class="line">        &lt;/StackPanel.DataContext&gt;</span><br><span class="line">        &lt;Grid&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Path=Id&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Path=Name&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Path=Age&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Id&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Name&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Age&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<p>结合前面的Source本身为数据时，path可以写成”.”。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;StackPanel.DataContext&gt;</span><br><span class="line">            &lt;sys:String&gt;Hello HerWorld!&lt;/sys:String&gt;</span><br><span class="line">        &lt;/StackPanel.DataContext&gt;</span><br><span class="line">        &lt;Grid&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding .&#125;&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<p>因为DataContext是依赖属性，当你没有为控件的某个依赖属性赋值时，该控件会把自己容器的属性值“借过来”当作自己的，也就是属性值可以沿某些UI元素树向下传递。</p>
<p>实际工作用法</p>
<ol>
<li>当UI上的多个控件都使用Binding关注同一个对象时</li>
<li>当作为Source的对象不能被直接访问的时候–</li>
</ol>
<h3 id="使用集合对象作为列表控件的ItemsSource"><a href="#使用集合对象作为列表控件的ItemsSource" class="headerlink" title="使用集合对象作为列表控件的ItemsSource"></a>使用集合对象作为列表控件的ItemsSource</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel x:Name=&quot;StackPanel&quot; Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;Student ID:&quot; FontWeight=&quot;Bold&quot; Margin=&quot;5&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;TextBlock&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;Student List&quot; FontWeight=&quot;Bold&quot; Margin=&quot;5&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">        &lt;ListBox x:Name=&quot;ListBoxStudent&quot; Height=&quot;110&quot; Margin=&quot;5&quot;&gt;&lt;/ListBox&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public List()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            List&lt;Student&gt; stuList = new List&lt;Student&gt;()</span><br><span class="line">            &#123;</span><br><span class="line">                new Student()&#123;Id=0,Name = &quot;Tim&quot;,Age=29&#125;,</span><br><span class="line">                new Student()&#123;Id=1,Name =&quot;Tom&quot;,Age=28 &#125;,</span><br><span class="line">                new Student()&#123;Id=2,Name = &quot;Kyle&quot;,Age=27&#125;,</span><br><span class="line">                new Student()&#123;Id=3,Name = &quot;Tony&quot;,Age=26&#125;,</span><br><span class="line">                new Student()&#123;Id=4,Name = &quot;Vina&quot;,Age=25&#125;,</span><br><span class="line">                new Student()&#123;Id=5,Name = &quot;Mike&quot;,Age=24&#125;,</span><br><span class="line">            &#125;;</span><br><span class="line">            ListBoxStudent.ItemsSource = stuList;</span><br><span class="line">            ListBoxStudent.DisplayMemberPath = &quot;Name&quot;;</span><br><span class="line"></span><br><span class="line">            Binding binding = new Binding(&quot;SelectedItem.Id&quot;)&#123;Source=this.ListBoxStudent&#125;;</span><br><span class="line">            TextBlock.SetBinding(TextBox.TextProperty, binding);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p><code>this.ListBoxStudent.DisplayMemberPath=&quot;Name&quot;</code>赋值后，ListBox在获得ItemsSource的时候就会创建等量的ListBoxItem 并且以DisplayMemberPath的属性值Path创建Binding，Binding的目标是ListBoxItem的内容插件</p>
<p>这个创建Binding的过程是在DisplayerMemberTemplateSelector类的SelectTemplate方法里完成的。这个方法的定义格式如下</p>
<p><code>public override DataTemplate SelectTemplate(object item,DependencyObject container){}</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Binding binding = new Binding();</span><br><span class="line">binding.Path = new PropertyPath(_displayMemberPath);</span><br><span class="line">bingding.StringFormat=_stringFormat;</span><br><span class="line">text.SetBinding(TextBlock.TextProperty,binding);</span><br></pre></td></tr></table></figure>
<p>显式设置DataTemplate的例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;ListBox x:Name=&quot;ListBoxStudent&quot; Height=&quot;110&quot; Margin=&quot;5&quot;&gt;</span><br><span class="line">            &lt;ListBox.ItemTemplate&gt;</span><br><span class="line">                &lt;DataTemplate&gt;</span><br><span class="line">                    &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                        &lt;TextBlock Text=&quot;&#123;Binding Path=Id&#125;&quot; Width=&quot;30&quot;/&gt;</span><br><span class="line">                        &lt;TextBlock Text=&quot;&#123;Binding Path=Name&#125;&quot; Width=&quot;60&quot;/&gt;</span><br><span class="line">                        &lt;TextBlock Text=&quot;&#123;Binding Path=Age&#125;&quot; Width=&quot;30&quot;/&gt;</span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                &lt;/DataTemplate&gt;</span><br><span class="line">            &lt;/ListBox.ItemTemplate&gt;</span><br><span class="line">        &lt;/ListBox&gt;</span><br></pre></td></tr></table></figure>
<p>Note:使用集合时一般考虑用ObservableCollection&lt;&gt;，它实现了InotifyCollectionChanged和INotifyPropertyChange接口，能把集合的变化立即通知显示它的列表控件。</p>
<h3 id="使用ADO-NET对象作为Binding源"><a href="#使用ADO-NET对象作为Binding源" class="headerlink" title="使用ADO.NET对象作为Binding源"></a>使用ADO.NET对象作为Binding源</h3><p>DataTable。。。Skip</p>
<hr>
<h3 id="使用XML数据作为Binding的源"><a href="#使用XML数据作为Binding的源" class="headerlink" title="使用XML数据作为Binding的源"></a>使用XML数据作为Binding的源</h3><p>.NET Framework提供了两套处理XML数据的类库：</p>
<ul>
<li>符合DOM(Document Object Modle,文档对象模型)标准的类库：包括XmlDocument、XmlElement、XmlAttribute等类。中规中矩。</li>
<li>以LINQ(Language-Intergrated Query,语言集成查询)为基础的类库：包括XDocument、XElement、XNode、XAttribute等类。方便</li>
</ul>
<p>Note:当使用XML数据作为Binding的Source时我们将使用XPath属性而不是Path来指定数据来源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private void ButtonClick(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            XmlDocument doc= new XmlDocument();</span><br><span class="line">            doc.Load(@&quot;C:\C\xml\RawData.xml&quot;);</span><br><span class="line">            XmlDataProvider xdp = new XmlDataProvider();</span><br><span class="line">            xdp.Document = doc;</span><br><span class="line">            //XmlDataProvider xdp1= new XmlDataProvider();</span><br><span class="line">            //xdp1.Source= new Uri(@&quot;C:\C\xml\RawData.xml&quot;);</span><br><span class="line">            xdp.XPath = @&quot;/StudentList/Student&quot;;</span><br><span class="line">            this.listViewStudents.DataContext = xdp;</span><br><span class="line">            listViewStudents.SetBinding(ListView.ItemsSourceProperty, new Binding());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>使用@的是元素的Attribute，不加的是子集元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;XmlDataProvider x:Key=&quot;xdp&quot; XPath=&quot;FileSystem/Folder&quot;&gt;</span><br><span class="line">            &lt;x:XData&gt;</span><br><span class="line">                &lt;FileSystem xmlns=&quot;&quot;&gt;</span><br><span class="line">                    &lt;Folder Name=&quot;Books&quot;&gt;</span><br><span class="line">                        &lt;Folder Name=&quot;Programing&quot;&gt;</span><br><span class="line">                            &lt;Folder Name=&quot;Windows&quot;&gt;</span><br><span class="line">                                &lt;Folder Name=&quot;WPF&quot;&gt;&lt;/Folder&gt;</span><br><span class="line">                                &lt;Folder Name=&quot;MFC&quot;/&gt;</span><br><span class="line">                                &lt;Folder Name=&quot;Delphi&quot;/&gt;</span><br><span class="line">                            &lt;/Folder&gt;</span><br><span class="line">                        &lt;/Folder&gt;</span><br><span class="line">                        &lt;Folder Name=&quot;Tools&quot;&gt;</span><br><span class="line">                            &lt;Folder Name=&quot;Development&quot;/&gt;</span><br><span class="line">                            &lt;Folder Name=&quot;Designment&quot;/&gt;</span><br><span class="line">                            &lt;Folder Name=&quot;Players&quot;/&gt;</span><br><span class="line">                        &lt;/Folder&gt;</span><br><span class="line">                    &lt;/Folder&gt;</span><br><span class="line">                &lt;/FileSystem&gt;</span><br><span class="line">            &lt;/x:XData&gt;</span><br><span class="line">        &lt;/XmlDataProvider&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;/Window.Resources&gt;</span><br><span class="line">    &lt;Grid&gt;</span><br><span class="line">        &lt;TreeView ItemsSource=&quot;&#123;Binding Source=&#123;StaticResource xdp&#125;&#125;&quot;&gt;</span><br><span class="line">            &lt;TreeView.ItemTemplate&gt;</span><br><span class="line">                &lt;HierarchicalDataTemplate ItemsSource=&quot;&#123;Binding XPath=Folder&#125;&quot;&gt;</span><br><span class="line">                    &lt;TextBlock Text=&quot;&#123;Binding XPath=@Name&#125;&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                &lt;/HierarchicalDataTemplate&gt;</span><br><span class="line">            &lt;/TreeView.ItemTemplate&gt;</span><br><span class="line">        &lt;/TreeView&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<h3 id="使用LINQ检索结果作为Binding的源"><a href="#使用LINQ检索结果作为Binding的源" class="headerlink" title="使用LINQ检索结果作为Binding的源"></a>使用LINQ检索结果作为Binding的源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;ListView x:Name=&quot;listViewStudents&quot; Height=&quot;143&quot; Margin=&quot;3&quot;&gt;</span><br><span class="line">            &lt;ListView.View&gt;</span><br><span class="line">                &lt;GridView&gt;</span><br><span class="line">                    &lt;GridViewColumn Header=&quot;Id&quot; Width=&quot;60&quot; DisplayMemberBinding=&quot;&#123;Binding Id&#125;&quot;&gt;&lt;/GridViewColumn&gt;</span><br><span class="line">                    &lt;GridViewColumn Header=&quot;Name&quot; Width=&quot;100&quot; DisplayMemberBinding=&quot;&#123;Binding Name&#125;&quot;&gt;&lt;/GridViewColumn&gt;</span><br><span class="line">                    &lt;GridViewColumn Header=&quot;Age&quot; Width=&quot;80&quot; DisplayMemberBinding=&quot;&#123;Binding Age&#125;&quot;&gt;&lt;/GridViewColumn&gt;</span><br><span class="line">                &lt;/GridView&gt;</span><br><span class="line">            &lt;/ListView.View&gt;</span><br><span class="line">        &lt;/ListView&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private void ButtonClick(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Student&gt; stuList = new List&lt;Student&gt;()</span><br><span class="line">            &#123;</span><br><span class="line">                new Student()&#123;Id=0,Name = &quot;Tim&quot;,Age=29&#125;,</span><br><span class="line">                new Student()&#123;Id=1,Name =&quot;Tom&quot;,Age=28 &#125;,</span><br><span class="line">                new Student()&#123;Id=2,Name = &quot;Kyle&quot;,Age=27&#125;,</span><br><span class="line">                new Student()&#123;Id=3,Name = &quot;Tony&quot;,Age=26&#125;,</span><br><span class="line">                new Student()&#123;Id=4,Name = &quot;Vina&quot;,Age=25&#125;,</span><br><span class="line">                new Student()&#123;Id=5,Name = &quot;Mike&quot;,Age=24&#125;,</span><br><span class="line">            &#125;;</span><br><span class="line">            this.listViewStudents.ItemsSource = from stu in stuList where stu.Name.StartsWith(&quot;T&quot;) select stu;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>如果是xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">XDocument xdoc= XDocument.Load(@"C:\C\xml\RawData01.xml");</span><br><span class="line">            listViewStudents.ItemsSource = from element in xdoc.Descendants("Student")</span><br><span class="line">                where element.Attribute("Name").Value.StartsWith("T")</span><br><span class="line">                select new Student()</span><br><span class="line">                &#123;</span><br><span class="line">                    Id = int.Parse(element.Attribute("Id").Value),</span><br><span class="line">                    Name = element.Attribute("Name").Value,</span><br><span class="line">                    Age = int.Parse(element.Attribute("Age").Value)</span><br><span class="line">                &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="使用ObjectDataProvider对象作为Source"><a href="#使用ObjectDataProvider对象作为Source" class="headerlink" title="使用ObjectDataProvider对象作为Source"></a>使用ObjectDataProvider对象作为Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Background=&quot;Gray&quot;&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBoxArg1&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBoxArg2&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBoxResult&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public ODPBook()</span><br><span class="line">       &#123;</span><br><span class="line">           InitializeComponent();</span><br><span class="line">           SetBinding();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       private void SetBinding()</span><br><span class="line">       &#123;</span><br><span class="line">           ObjectDataProvider odp= new ObjectDataProvider();</span><br><span class="line">           odp.ObjectInstance= new Calculator();</span><br><span class="line">           odp.MethodName = &quot;Add&quot;;</span><br><span class="line">           odp.MethodParameters.Add(&quot;0&quot;);</span><br><span class="line">           odp.MethodParameters.Add(&quot;0&quot;);</span><br><span class="line"></span><br><span class="line">           Binding bindingToArg1 = new Binding(&quot;MethodParameters[0]&quot;)</span><br><span class="line">           &#123;</span><br><span class="line">               Source = odp,</span><br><span class="line">               BindsDirectlyToSource = true,</span><br><span class="line">               UpdateSourceTrigger = UpdateSourceTrigger.PropertyChanged</span><br><span class="line">           &#125;;</span><br><span class="line"></span><br><span class="line">           Binding bindingToArg2 = new Binding(&quot;MethodParameters[1]&quot;)</span><br><span class="line">           &#123;</span><br><span class="line">               Source = odp,</span><br><span class="line">               BindsDirectlyToSource = true,</span><br><span class="line">               UpdateSourceTrigger = UpdateSourceTrigger.PropertyChanged</span><br><span class="line">           &#125;;</span><br><span class="line"></span><br><span class="line">           Binding bindingToResult = new Binding(&quot;.&quot;)&#123;Source = odp&#125;;</span><br><span class="line"></span><br><span class="line">           textBoxArg1.SetBinding(TextBox.TextProperty, bindingToArg1);</span><br><span class="line">           textBoxArg2.SetBinding(TextBox.TextProperty, bindingToArg2);</span><br><span class="line">           textBoxResult.SetBinding(TextBox.TextProperty, bindingToResult);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>Something Skip</p>
<h3 id="6-3-12-使用Binding的RelativeSource"><a href="#6-3-12-使用Binding的RelativeSource" class="headerlink" title="6.3.12 使用Binding的RelativeSource"></a>6.3.12 使用Binding的RelativeSource</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid x:Name=&quot;g1&quot; Background=&quot;Red&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">        &lt;DockPanel x:Name=&quot;d1&quot; Background=&quot;Orange&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">            &lt;Grid x:Name=&quot;g2&quot; Background=&quot;Yellow&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">                &lt;DockPanel x:Name=&quot;d2&quot; Background=&quot;LawnGreen&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">                    &lt;TextBox x:Name=&quot;TextBox&quot; FontSize=&quot;24&quot; Margin=&quot;10&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;/DockPanel&gt;</span><br><span class="line">            &lt;/Grid&gt;            </span><br><span class="line">        &lt;/DockPanel&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>把TextBox的Text属性关联到外层容器的Name属性上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public RelativeSourceHer()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            RelativeSource rs = new RelativeSource(RelativeSourceMode.FindAncestor);</span><br><span class="line">            rs.AncestorLevel = 1;</span><br><span class="line">            rs.AncestorType = typeof(Grid);</span><br><span class="line">            Binding binding = new Binding(&quot;Name&quot;)&#123;RelativeSource = rs&#125;;</span><br><span class="line">            TextBox.SetBinding(TextBox.TextProperty, binding);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>或者XAML中插入等效代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Text=&quot;&#123;Binding RelativeSource=&#123;RelativeSource FindAncestor, AncestorType=</span><br><span class="line">                        &#123;x:Type Grid&#125;,AncestorLevel=1&#125;,Path=Name&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>其中AncestorLevel属性指的是以Binding目标控件为起点的层级偏移量–d2的偏移量是1，g2的偏移量是2，依次类推。AncestorType属性告诉Binding寻找哪个类型的对象作为自己的源，不是这个类型的对象会被跳过。同理修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Text=&quot;&#123;Binding RelativeSource=&#123;RelativeSource FindAncestor, AncestorType=</span><br><span class="line">                        &#123;x:Type DockPanel&#125;,AncestorLevel=2&#125;,Path=Name</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Text=&quot;&#123;Binding RelativeSource=&#123;RelativeSource Self&#125;,Path=Name&#125;</span><br></pre></td></tr></table></figure>
<p>RelativeSource类的Mode属性的类型是RelativeSourceMode枚举，它的取值有：PreviousData、TemplateParent、Self和FindAncestor。RelativeSource类还有3个静态属性PreviousData、TemplateParent、Self。实际上这三静态属性就是创建一个RelativeSource实例、把实例的Mode属性设置为相应的值，然后返回这个实例。</p>
<p>例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public static RelativeSource Self</span><br><span class="line">&#123;</span><br><span class="line">    get</span><br><span class="line">    &#123;</span><br><span class="line">		if(s_self==null)</span><br><span class="line">		&#123; s_self = new RelativeSource(RelativeSourceMode.Self);&#125;</span><br><span class="line">		return s_self;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常用于 DataTemplate</p>
<ul>
<li>PreviousData</li>
<li>TemplateParent</li>
<li>Self</li>
</ul>
<h2 id="Binding对数据的转换与校验"><a href="#Binding对数据的转换与校验" class="headerlink" title="Binding对数据的转换与校验"></a>Binding对数据的转换与校验</h2><p>Source与Target之间的桥梁，可以设置安检。而且还可以提供变脸器（转换器Converter）让你通过。</p>
<h3 id="Binding的数据校验"><a href="#Binding的数据校验" class="headerlink" title="Binding的数据校验"></a>Binding的数据校验</h3><p>Binding的ValidationRules属性类型是Collection<validationrule>,从它的名称和数据类型可知可以设置多个数据校验条件，每个条件是一个ValidationRule类型对象。ValidationRule类是个抽象类，在使用的时候需要创建它的派生类并且实现它的Validate方法。该方法的返回值是ValidationResult类型对象，如果校验通过，就把ValidationResult对象的IsValid属性设为True，反之，则设置为false并为其ErrorContent属性设置一个合适的消息内容。</validationrule></p>
<p>Slider：0~100</p>
<p>xaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">        &lt;Slider x:Name=&quot;slider&quot; Minimum=&quot;-10&quot; Maximum=&quot;110&quot; Margin=&quot;5&quot; &gt;&lt;/Slider&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public SliderCheck()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            Binding binding = new Binding(&quot;Value&quot;)&#123;Source = this.slider&#125;;</span><br><span class="line">            binding.UpdateSourceTrigger = UpdateSourceTrigger.PropertyChanged;</span><br><span class="line">            RangeValidationRule rvr = new RangeValidationRule();</span><br><span class="line">            binding.ValidationRules.Add(rvr);</span><br><span class="line">            textBox.SetBinding(TextBox.TextProperty, binding);</span><br><span class="line">        &#125;</span><br><span class="line">        public class RangeValidationRule : ValidationRule</span><br><span class="line">        &#123;</span><br><span class="line">            public override ValidationResult Validate(object value, System.Globalization.CultureInfo cultureInfo)</span><br><span class="line">            &#123;</span><br><span class="line">                double d = 0;</span><br><span class="line">                if (double.TryParse(value.ToString(), out d))</span><br><span class="line">                &#123;</span><br><span class="line">                    if (d &gt;= 0 &amp;&amp; d &lt;= 100)</span><br><span class="line">                    &#123;</span><br><span class="line">                        return new ValidationResult(true, null);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return new ValidationResult(false, &quot;Validation Failed!&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>Binding校验默认来自Source的数据总是正确的，例如在Target  Slider里设置-10，上述方法不会报错。</p>
<p>所以当Source的数据有可能出现问题时，将校验条件的ValidatesOnTargetUpdated属性设置为True。</p>
<p><code>rvr.ValidatesOnTargetUpdated = true;</code></p>
<p>Route Event提示ToolTip失败提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RangeValidationRule rvr = new RangeValidationRule();</span><br><span class="line">            rvr.ValidatesOnTargetUpdated = true;</span><br><span class="line">            binding.ValidationRules.Add(rvr);</span><br><span class="line">            binding.NotifyOnValidationError = true;</span><br><span class="line">            textBox.SetBinding(TextBox.TextProperty, binding);</span><br><span class="line">            textBox.AddHandler(Validation.ErrorEvent,new RoutedEventHandler(this.ValidationError));</span><br></pre></td></tr></table></figure>
<p>事件处理器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void ValidationError(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            if (Validation.GetErrors(textBox).Count&gt;0)</span><br><span class="line">            &#123;</span><br><span class="line">                this.textBox.ToolTip = Validation.GetErrors(textBox)[0].ErrorContent.ToString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Binding的数据转换"><a href="#Binding的数据转换" class="headerlink" title="Binding的数据转换"></a>Binding的数据转换</h3><p>之前的Double和String 居然可以在C#这种强类型语言中转换自如。</p>
<p>那是因为Binding的另外一个机制 Data Convert，当Source端Path所关联的数据与Target端目标属性类型不一样的时候，可以添加转换器。上面提到的自动做了，但是有时需要自己做：</p>
<ul>
<li>Source里数据是Y、N和X三个值，UI对应CheckBox控件，需要把这三个值映射为它的IsChecked属性。</li>
<li>当TextBox里已经输入了文字时用于登陆的Button才出现，String类型与Visibility或者bool之间的转换</li>
<li>Source是Male或者Female（string或者枚举），UI上对应的是Image控件，需要转成Uri</li>
</ul>
<p>自己动手写Converter，创建一个类实现IValueConverter接口。定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface IValueConverter</span><br><span class="line">&#123;</span><br><span class="line">    object Convert(object value,Type targetType,object parameter,CultureInfo culture);</span><br><span class="line">    object ConvertBack(object value,Type targetType,object parameter,CultureInfo culture);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数据从Source流向Target时，Convert被调用，反之调用ConvertBack。第二个参数可以命名为outputType，确定方法的返回类型，第三个参数把额外的信息传入方法，如果需要多个信息可以把信息放入一个集合。Binding的Mode属性  OneWay 和TwoWay 影响到ConvertBack是否会被调用。</p>
<p>Converter实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;local:CategoryToSourceConverter x:Key=&quot;cts&quot;&gt;&lt;/local:CategoryToSourceConverter&gt;</span><br><span class="line">        &lt;local:StateToNullableBoolConverter x:Key=&quot;stnb&quot;&gt;&lt;/local:StateToNullableBoolConverter&gt;</span><br><span class="line">    &lt;/Window.Resources&gt;</span><br><span class="line">    &lt;StackPanel Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;ListBox x:Name=&quot;listBoxPlane&quot; Height=&quot;160&quot; Margin=&quot;5&quot;&gt;</span><br><span class="line">            &lt;ListBox.ItemTemplate&gt;</span><br><span class="line">                &lt;DataTemplate&gt;</span><br><span class="line">                    &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                        &lt;Image Width=&quot;20&quot; Height=&quot;20&quot; Source=&quot;&#123;Binding Path=Category,Converter=&#123;StaticResource cts&#125;&#125;&quot;/&gt;</span><br><span class="line">                        &lt;TextBlock Text=&quot;&#123;Binding Path=Name&#125;&quot; Width=&quot;60&quot; Margin=&quot;80,0&quot;/&gt;</span><br><span class="line">                        &lt;CheckBox IsThreeState=&quot;True&quot; IsChecked=&quot;&#123;Binding Path=State,Converter=&#123;StaticResource stnb&#125;&#125;&quot;/&gt;</span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                &lt;/DataTemplate&gt;</span><br><span class="line">            &lt;/ListBox.ItemTemplate&gt;</span><br><span class="line">        &lt;/ListBox&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;buttonLoad&quot; Content=&quot;Load&quot; Height=&quot;25&quot; Margin=&quot;5,0&quot; Click=&quot;buttonLoad_Click&quot;&gt;&lt;/Button&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;buttonSave&quot; Content=&quot;Save&quot; Height=&quot;25&quot; Margin=&quot;5,0&quot; Click=&quot;buttonSave_Click&quot;&gt;&lt;/Button&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">public partial class ConvertHer : Window</span><br><span class="line">    &#123;</span><br><span class="line">        public ConvertHer()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void buttonLoad_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Plane&gt; planeList = new List&lt;Plane&gt;()</span><br><span class="line">            &#123;</span><br><span class="line">                new Plane()&#123;Category =Category.Boomer,Name = &quot;B-1&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Boomer,Name = &quot;B-2&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Fighter,Name = &quot;F-22&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Fighter,Name = &quot;Su-47&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Boomer,Name = &quot;B-52&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Fighter,Name = &quot;J-10&quot;,State = State.Unknown&#125;,</span><br><span class="line">            &#125;;</span><br><span class="line">            this.listBoxPlane.ItemsSource = planeList;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void buttonSave_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            StringBuilder sb = new StringBuilder();</span><br><span class="line">            foreach (Plane plane in listBoxPlane.Items)</span><br><span class="line">            &#123;</span><br><span class="line">                sb.AppendLine(string.Format(&quot;Category=&#123;0&#125;,Name=&#123;1&#125;,State=&#123;2&#125;&quot;, plane.Category, plane.Name,</span><br><span class="line">                    plane.State));</span><br><span class="line">            &#125;</span><br><span class="line">            File.WriteAllText(@&quot;C:\C\xml\PlaneLIst.txt&quot;, sb.ToString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class CategoryToSourceConverter : IValueConverter</span><br><span class="line">    &#123;</span><br><span class="line">        public object Convert(object value, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            Category c = (Category) value;</span><br><span class="line">            switch (c)</span><br><span class="line">            &#123;</span><br><span class="line">                    case Category.Boomer:</span><br><span class="line">                        return @&quot;\Icons\boomer.png&quot;;</span><br><span class="line">                    case Category.Fighter:</span><br><span class="line">                        return @&quot;\Icons\fighter.png&quot;;</span><br><span class="line">                default:</span><br><span class="line">                    return null;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public object ConvertBack(object value, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new NotImplementedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class StateToNullableBoolConverter : IValueConverter</span><br><span class="line">    &#123;</span><br><span class="line">        public object Convert(object value, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            State s = (State) value;</span><br><span class="line">            switch (s)</span><br><span class="line">            &#123;</span><br><span class="line">                case State.Locked:</span><br><span class="line">                    return false;</span><br><span class="line">                    case State.Available:</span><br><span class="line">                        return true;</span><br><span class="line">                    case State.Unknown:</span><br><span class="line">                default:</span><br><span class="line">                        return null;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public object ConvertBack(object value, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            bool? nb = (bool?) value;</span><br><span class="line">            switch (nb)</span><br><span class="line">            &#123;</span><br><span class="line">                case true:</span><br><span class="line">                    return State.Available;</span><br><span class="line">                case false:</span><br><span class="line">                    return State.Locked;</span><br><span class="line">                case null:</span><br><span class="line">                    return State.Unknown;</span><br><span class="line">                default:</span><br><span class="line">                    return State.Unknown;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public enum Category</span><br><span class="line">    &#123;</span><br><span class="line">        Boomer,</span><br><span class="line">        Fighter</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public enum State</span><br><span class="line">    &#123;</span><br><span class="line">        Available,</span><br><span class="line">        Locked,</span><br><span class="line">        Unknown</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class Plane</span><br><span class="line">    &#123;</span><br><span class="line">        public Category Category &#123; get; set; &#125;</span><br><span class="line">        public  string Name &#123; get; set; &#125;</span><br><span class="line">        public  State  State &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="MultiBinding"><a href="#MultiBinding" class="headerlink" title="MultiBinding"></a>MultiBinding</h2><p>multiBinding与Binding一样均以BindingBase为基类，凡是能使用Binding对象的场合就可以使用MultiBinding。它具有一个名为Binding的属性，其类型是Collection<bindingbase>.</bindingbase></p>
<p>考虑这么一个需求，有一个用于新用户注册的UI，包含四个TextBox和一个Button。</p>
<ul>
<li>第一 二个TextBox输入用户名，要求内容一致</li>
<li>第三 四个TextBox输入E-Mail，要求内容一致</li>
<li>上述符合时Button可用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox1&quot; Height=&quot;23&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox2&quot; Height=&quot;23&quot; Margin=&quot;5,0&quot;/&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox3&quot; Height=&quot;23&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox4&quot; Height=&quot;23&quot; Margin=&quot;5,0&quot;/&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;button1&quot; Content=&quot;Submit&quot; Width=&quot;80&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;button2&quot; Content=&quot;Submit&quot; Width=&quot;80&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public MultiBindingHer()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            this.SetMultiBinding();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void SetMultiBinding()</span><br><span class="line">        &#123;</span><br><span class="line">            Binding b1= new Binding(&quot;Text&quot;)&#123;Source = textBox1&#125;;</span><br><span class="line">            Binding b2 = new Binding(&quot;Text&quot;) &#123; Source = textBox2 &#125;;</span><br><span class="line">            Binding b3 = new Binding(&quot;Text&quot;) &#123; Source = textBox3 &#125;;</span><br><span class="line">            Binding b4 = new Binding(&quot;Text&quot;) &#123; Source = textBox4 &#125;;</span><br><span class="line"></span><br><span class="line">            MultiBinding mb = new MultiBinding()&#123;Mode=BindingMode.OneWay&#125;;</span><br><span class="line">            mb.Bindings.Add(b1);</span><br><span class="line">            mb.Bindings.Add(b2);</span><br><span class="line">            mb.Bindings.Add(b3);</span><br><span class="line">            mb.Bindings.Add(b4);</span><br><span class="line">            mb.Converter = new LogonMultiBindingConverter();</span><br><span class="line">            button1.SetBinding(Button.IsEnabledProperty,mb);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public class LogonMultiBindingConverter : IMultiValueConverter</span><br><span class="line">        &#123;</span><br><span class="line">            public object Convert(object[] values, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">            &#123;</span><br><span class="line">                if (!values.Cast&lt;String&gt;().Any(text=&gt;string.IsNullOrEmpty(text))</span><br><span class="line">                    &amp;&amp;values[0].ToString()==values[1].ToString()</span><br><span class="line">                    &amp;&amp;values[2].ToString()==values[3].ToString())</span><br><span class="line">                &#123;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public object[] ConvertBack(object value, Type[] outputTypes, object parameter, CultureInfo culture)</span><br><span class="line">            &#123;</span><br><span class="line">                throw new NotImplementedException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>总结：SetMultiBinding()  实现MutiBindingConverter()</p>
<h1 id="Attributes-讲属性"><a href="#Attributes-讲属性" class="headerlink" title="Attributes 讲属性"></a>Attributes 讲属性</h1><h2 id="7-1-属性的来龙去脉"><a href="#7-1-属性的来龙去脉" class="headerlink" title="7.1 属性的来龙去脉"></a>7.1 属性的来龙去脉</h2><p>C#规定 对类有意义的字段和方法使用static关键字修饰，称为静态成员，通过.访问</p>
<p>对类的实例有意义的字段和方法不加static，称为非静态成员或实例成员。</p>
<p>直接写字段暴露在外太不安全</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class Human&#123;public int age;&#125;</span><br></pre></td></tr></table></figure>
<p>于是聪明的程序源改写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Human</span><br><span class="line">        &#123;</span><br><span class="line">            private int age;</span><br><span class="line"></span><br><span class="line">            public void SetAge(int value)</span><br><span class="line">            &#123;</span><br><span class="line">                if (value&gt;=0 &amp;&amp; value&lt;=100)</span><br><span class="line">                &#123;</span><br><span class="line">                    age = value;</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    throw new OverflowException(&quot;Age overflow&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            public int GetAge()</span><br><span class="line">            &#123;</span><br><span class="line">                return age;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>.NET Framework推出时，微软更进一步把 GEt/Set合并成了属性。简短了代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class Human</span><br><span class="line">        &#123;</span><br><span class="line">            private int age;</span><br><span class="line">            public int Age</span><br><span class="line">            &#123;</span><br><span class="line">                get &#123; return age; &#125;</span><br><span class="line">                set</span><br><span class="line">                &#123;</span><br><span class="line">                    if (value&gt;=0&amp;&amp;value&lt;=100)</span><br><span class="line">                    &#123;</span><br><span class="line">                        this.age = value;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        throw  new OverflowException(&quot;Age overflow&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>.NET Framework推出时，微软更进一步把 GEt/Set合并成了属性。简短了代码,不失阅读性。这种属性又称为CLR属性（Common Language Runtime）。可以说CLR属性是private字段的安全访问包装，也可以说一个private字段在后台支持（back）一个CLR属性。</p>
<p>Note：CLR属性会占更多内存吗？属性的编译结果是两个方法！再多实例方法也只有一个Copy。</p>
<h2 id="依赖属性"><a href="#依赖属性" class="headerlink" title="依赖属性"></a>依赖属性</h2><ul>
<li>节省实例对内存的开销</li>
<li>属性值可以通过Binding依赖在其他对象上</li>
</ul>
<h3 id="7-2-1-依赖属性对内存的使用方式"><a href="#7-2-1-依赖属性对内存的使用方式" class="headerlink" title="7.2.1 依赖属性对内存的使用方式"></a>7.2.1 依赖属性对内存的使用方式</h3><p>思考，TextBox有138个属性，假设每个CLR属性包装一个4字节的字段，如果程序运行创建了一个10列1000行的TextBox列表，那么将占用4<em>138</em>10*1000=5.26M内存，怎么避免呢</p>
<p>用得着就带着，用不着就不带</p>
<p>WPF允许对象在被创建时不包含用于存储数据的空间（字段占用的空间）、只保留在需要用到数据时获取默认值、借用其他对象数据或实时分配空间的能力–这种对象就是依赖对象(Dependency Object),这种能力依靠依赖属性来实现。</p>
<p>依赖对象的概念被DependencyObject类实现。依赖属性的概念由DependencyProperty类实现。DependencyObject具有GetValue和SetValue两个方法。</p>
<p>DependencyProperty必须以DependencObject为宿主，因此，想自定义，宿主一定是DependencyObject的派生类。DependecyProperty实例的声明特点很鲜明–引用变量由public static readonly三个修饰符修饰，实例并非使用new操作符得到而是使用DependencyProperty.Register方法生成。代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class Student:DependencyObject</span><br><span class="line">&#123;</span><br><span class="line">	public static readonly DependencyProperty NameProperty=</span><br><span class="line">		DependencyProperty.Register(&quot;Name&quot;,typeof(string),typeof(Student));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3个参数</p>
<ol>
<li>此依赖属性back哪个CLR属性</li>
<li>此依赖属性存储什么类型的值，依赖属性的注册属性</li>
<li>依赖属性宿主类型，注册关联到哪个类型上。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">private Student stu;</span><br><span class="line">        public Dp()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            stu=new Student();</span><br><span class="line">            Binding binding= new Binding(&quot;Text&quot;)&#123;Source = textBox1&#125;;</span><br><span class="line">            BindingOperations.SetBinding(stu, Student.NameProperty, binding);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void ButtonClick(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Student stu= new Student();</span><br><span class="line">            stu.SetValue(Student.NameProperty,textBox1.Text);</span><br><span class="line">            textBox2.Text = (string) stu.GetValue(Student.NameProperty);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public class Student : DependencyObject</span><br><span class="line">        &#123;</span><br><span class="line">            public static readonly DependencyProperty NameProperty =</span><br><span class="line">                DependencyProperty.Register(&quot;Name&quot;, typeof(string), typeof(Student));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void ButtonClick1(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(stu.GetValue(Student.NameProperty).ToString());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>FrameworkElement类的SetBinding方法并不神秘，仅仅对BindingOperations的SetBinding方法做了一个简单的封装，代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public clas FrameworkElemnt:UIElement</span><br><span class="line">&#123;</span><br><span class="line">	public BindingExpressionBase SetBinding(DependencyProperty dp,BindingBase binding)</span><br><span class="line">    &#123;</span><br><span class="line">    	return BindingOperations.SetBinding(this,dp,binding);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Get,Set显得太过麻烦，于是添加一个CLR属性包装器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Student : DependencyObject</span><br><span class="line">        &#123;            </span><br><span class="line">            public String Name</span><br><span class="line">            &#123;</span><br><span class="line">                get &#123; return (string) GetValue(NameProperty); &#125;</span><br><span class="line">                set &#123; SetValue(NameProperty,value);&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            public static readonly DependencyProperty NameProperty =</span><br><span class="line">                DependencyProperty.Register(&quot;Name&quot;, typeof(string), typeof(Student));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>有了它就可以像普通属性一样访问依赖属性了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private void Button_Click(object sender,RoutedEventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    Student stu = new Student();</span><br><span class="line">    stu.Name=this.textBox1.Text;</span><br><span class="line">    this.textBox2.Text=stu.Name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note:propdp可以自动生成依赖属性</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/22/WPF-Control-Templates/" rel="next" title="WPF-Control Templates">
                <i class="fa fa-chevron-left"></i> WPF-Control Templates
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Psmyfish</p>
              <p class="site-description motion-element" itemprop="description">Some fish in the rain,some fish in the sun.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#TypeConverter"><span class="nav-number">1.</span> <span class="nav-text">TypeConverter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#属性标签"><span class="nav-number">2.</span> <span class="nav-text">属性标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#标签扩展"><span class="nav-number">3.</span> <span class="nav-text">标签扩展</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事件处理器与代码后置"><span class="nav-number">4.</span> <span class="nav-text">事件处理器与代码后置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#导入程序集和引用其中的命名空间"><span class="nav-number">5.</span> <span class="nav-text">导入程序集和引用其中的命名空间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XAML的注释"><span class="nav-number">6.</span> <span class="nav-text">XAML的注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#名称空间的由来和作用"><span class="nav-number">7.</span> <span class="nav-text">名称空间的由来和作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x名称空间里都有什么"><span class="nav-number">8.</span> <span class="nav-text">x名称空间里都有什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x-Class"><span class="nav-number">9.</span> <span class="nav-text">x:Class</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x-ClassModifier"><span class="nav-number">10.</span> <span class="nav-text">x:ClassModifier</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x-Name"><span class="nav-number">11.</span> <span class="nav-text">x:Name</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x-FieldModifier"><span class="nav-number">12.</span> <span class="nav-text">x:FieldModifier</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#控件与布局"><span class="nav-number"></span> <span class="nav-text">控件与布局</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Binding"><span class="nav-number"></span> <span class="nav-text">Binding</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-Binding在WPF中的地位"><span class="nav-number">1.</span> <span class="nav-text">Data Binding在WPF中的地位</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#控制Binding的方向及数据更新"><span class="nav-number">1.1.</span> <span class="nav-text">控制Binding的方向及数据更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#没有Path的binding"><span class="nav-number">1.2.</span> <span class="nav-text">没有Path的binding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为Binding指定源-Source-的几种方法"><span class="nav-number">1.3.</span> <span class="nav-text">为Binding指定源(Source)的几种方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#没有Source的Binding-使用DataContext作为Binding源"><span class="nav-number">1.4.</span> <span class="nav-text">没有Source的Binding__使用DataContext作为Binding源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用集合对象作为列表控件的ItemsSource"><span class="nav-number">1.5.</span> <span class="nav-text">使用集合对象作为列表控件的ItemsSource</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用ADO-NET对象作为Binding源"><span class="nav-number">1.6.</span> <span class="nav-text">使用ADO.NET对象作为Binding源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用XML数据作为Binding的源"><span class="nav-number">1.7.</span> <span class="nav-text">使用XML数据作为Binding的源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用LINQ检索结果作为Binding的源"><span class="nav-number">1.8.</span> <span class="nav-text">使用LINQ检索结果作为Binding的源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用ObjectDataProvider对象作为Source"><span class="nav-number">1.9.</span> <span class="nav-text">使用ObjectDataProvider对象作为Source</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-12-使用Binding的RelativeSource"><span class="nav-number">1.10.</span> <span class="nav-text">6.3.12 使用Binding的RelativeSource</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Binding对数据的转换与校验"><span class="nav-number">2.</span> <span class="nav-text">Binding对数据的转换与校验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding的数据校验"><span class="nav-number">2.1.</span> <span class="nav-text">Binding的数据校验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding的数据转换"><span class="nav-number">2.2.</span> <span class="nav-text">Binding的数据转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MultiBinding"><span class="nav-number">3.</span> <span class="nav-text">MultiBinding</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Attributes-讲属性"><span class="nav-number"></span> <span class="nav-text">Attributes 讲属性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-属性的来龙去脉"><span class="nav-number">1.</span> <span class="nav-text">7.1 属性的来龙去脉</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖属性"><span class="nav-number">2.</span> <span class="nav-text">依赖属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-1-依赖属性对内存的使用方式"><span class="nav-number">2.1.</span> <span class="nav-text">7.2.1 依赖属性对内存的使用方式</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Psmyfish</span>

  
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
