<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Fish, PP" />










<meta name="description" content="深入浅出WPF知识点小结">
<meta name="keywords" content="Nice body">
<meta property="og:type" content="article">
<meta property="og:title" content="DeepInWPF">
<meta property="og:url" content="http://yoursite.com/2018/06/23/DeepInWPF/index.html">
<meta property="og:site_name" content="Psmyfish">
<meta property="og:description" content="深入浅出WPF知识点小结">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/images/001.png">
<meta property="og:updated_time" content="2018-06-28T12:04:02.917Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DeepInWPF">
<meta name="twitter:description" content="深入浅出WPF知识点小结">
<meta name="twitter:image" content="http://yoursite.com/images/001.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/06/23/DeepInWPF/"/>





  <title>DeepInWPF | Psmyfish</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
<a href="https://github.com/psmyfish" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Psmyfish</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">what is this fish?</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/23/DeepInWPF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Psmyfish">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Psmyfish">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">DeepInWPF</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-23T10:56:24+08:00">
                2018-06-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/learn-everyday/" itemprop="url" rel="index">
                    <span itemprop="name">learn everyday</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>深入浅出WPF知识点小结</strong></p>
<hr>
<a id="more"></a>
<p>在XAML中为对象属性赋值的三种形式</p>
<ol>
<li>Attribute=Value形式</li>
<li>属性标签</li>
<li>标签扩展</li>
</ol>
<h2 id="TypeConverter"><a href="#TypeConverter" class="headerlink" title="TypeConverter"></a>TypeConverter</h2><p>其实wpf中xaml窗口中的属性定义的Value很多都是字符串，但是仍然可以转换为目标对象类型。这就和TypeConverter脱不了干系。我们自己实现一次对此有更深入的理解。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public partial class MainWindow : Window</span><br><span class="line">    &#123;</span><br><span class="line">        public MainWindow()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line">        private void button_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Human h = (Human)this.FindResource(&quot;human&quot;);</span><br><span class="line">            MessageBox.Show(h.Child.Name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [TypeConverterAttribute(typeof(StringToHumanTypeConverter))]</span><br><span class="line">    public class Human</span><br><span class="line">    &#123;</span><br><span class="line">        public string Name &#123; get; set; &#125;</span><br><span class="line">        public Human Child &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class StringToHumanTypeConverter:TypeConverter</span><br><span class="line">    &#123;</span><br><span class="line">        public override object ConvertFrom(ITypeDescriptorContext context, CultureInfo culture, object value)</span><br><span class="line">        &#123;</span><br><span class="line">            if (value is string )</span><br><span class="line">            &#123;</span><br><span class="line">                Human h = new Human();</span><br><span class="line">                h.Name = value as string;</span><br><span class="line">                return h;</span><br><span class="line">            &#125;</span><br><span class="line">            return base.ConvertFrom(context, culture, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;local:Human x:Key=&quot;human&quot; Child=&quot;ABC&quot;/&gt;</span><br><span class="line">    &lt;/Window.Resources&gt;</span><br></pre></td></tr></table></figure>
<h2 id="属性标签"><a href="#属性标签" class="headerlink" title="属性标签"></a>属性标签</h2><p>所谓属性标签，居然就是简单的.+扩展的属性.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Width=&quot;30&quot; Height=&quot;30&quot; Button.Click=&quot;ButtonClick&quot; &gt;</span><br><span class="line">            &lt;Button.Content&gt;</span><br><span class="line">                &lt;Rectangle Width=&quot;30&quot; Height=&quot;30&quot; Stroke=&quot;Black&quot; Fill=&quot;red&quot;/&gt;</span><br><span class="line">            &lt;/Button.Content&gt;</span><br><span class="line">        &lt;/Button&gt;</span><br></pre></td></tr></table></figure>
<p>其中Button.Content即为属性标签的用法。</p>
<p>xmal是生命性语言，也就是说声明Button.Content属性对象中要增加的东西。</p>
<p>下面看LinearGradientBrush的完全体，这个纯属个人需求，读者可以掠过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;Rectangle x:Name=&quot;rectangle&quot; Width=&quot;200&quot; Height=&quot;120&quot;&gt;</span><br><span class="line">            &lt;Rectangle.Fill&gt;</span><br><span class="line">                &lt;LinearGradientBrush&gt;</span><br><span class="line">                    &lt;LinearGradientBrush.StartPoint&gt;</span><br><span class="line">                        &lt;Point X=&quot;0&quot; Y=&quot;0&quot;&gt;&lt;/Point&gt;</span><br><span class="line">                    &lt;/LinearGradientBrush.StartPoint&gt;</span><br><span class="line">                    &lt;LinearGradientBrush.EndPoint&gt;</span><br><span class="line">                        &lt;Point X=&quot;1&quot; Y=&quot;1&quot;/&gt;</span><br><span class="line">                    &lt;/LinearGradientBrush.EndPoint&gt;</span><br><span class="line">                    &lt;LinearGradientBrush.GradientStops&gt;</span><br><span class="line">                        &lt;GradientStopCollection&gt;</span><br><span class="line">                            &lt;GradientStop Offset=&quot;0.2&quot; Color=&quot;LightBlue&quot;/&gt;</span><br><span class="line">                            &lt;GradientStop Offset=&quot;0.5&quot; Color=&quot;Blue&quot;/&gt;</span><br><span class="line">                            &lt;GradientStop Offset=&quot;0.8&quot; Color=&quot;DarkBlue&quot;/&gt;</span><br><span class="line">                        &lt;/GradientStopCollection&gt;</span><br><span class="line">                    &lt;/LinearGradientBrush.GradientStops&gt;</span><br><span class="line">                &lt;/LinearGradientBrush&gt;</span><br><span class="line">            &lt;/Rectangle.Fill&gt;</span><br><span class="line">        &lt;/Rectangle&gt;</span><br></pre></td></tr></table></figure>
<h2 id="标签扩展"><a href="#标签扩展" class="headerlink" title="标签扩展"></a>标签扩展</h2><p>就是花括号的形式。。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;sys:String x:Key=&quot;stringHello&quot;&gt;Hello Her!&lt;/sys:String&gt;</span><br><span class="line">    &lt;/Window.Resources&gt;</span><br><span class="line">    &lt;Grid&gt;</span><br><span class="line">        &lt;TextBlock Height=&quot;24&quot; Width=&quot;120&quot; Background=&quot;LightBlue&quot; </span><br><span class="line">                   Text=&quot;&#123;StaticResource ResourceKey=stringHello&#125;&quot;/&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>{StaticResource}</li>
<li>{DynamicResource}</li>
<li>{Binding }</li>
</ul>
<hr>
<p>内容分布</p>
<ol>
<li>事件处理器与代码后置</li>
<li>导入程序集和引用其中的命名空间</li>
<li>XAML的注释</li>
</ol>
<h2 id="事件处理器与代码后置"><a href="#事件处理器与代码后置" class="headerlink" title="事件处理器与代码后置"></a>事件处理器与代码后置</h2><p>事件响应者:事件处理器-&gt;订阅事件-&gt;事件的拥有者:事件。</p>
<p>可以用简单的Button  Click事件来理解。除了xaml方式添加事件订阅 ，也可以用C#代码的方式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.button.Click += Button_Click1;</span><br></pre></td></tr></table></figure>
<h2 id="导入程序集和引用其中的命名空间"><a href="#导入程序集和引用其中的命名空间" class="headerlink" title="导入程序集和引用其中的命名空间"></a>导入程序集和引用其中的命名空间</h2><p>同一sln中引用自己开发的自定义控件时，也需要先添加引用add Reference.</p>
<p>然后在要用的地方，如Window 中 </p>
<p><code>xmlns:controls=&quot;clr-namespace:HerLib;assembly=HerLib&quot;</code></p>
<p>引用其他公司的程序集，也是先添加引用。</p>
<p>然后如果有https方式就用，没有就照常引用。</p>
<h2 id="XAML的注释"><a href="#XAML的注释" class="headerlink" title="XAML的注释"></a>XAML的注释</h2><p>和C#注释一样，两组快捷键Ctrl+EC EU  Ctrl+KC KU</p>
<hr>
<p>厉害的x名称空间</p>
<ol>
<li>x名称空间的由来和作用</li>
<li>x名称空间里都有什么</li>
<li>x:Class</li>
<li>x:ClassModifier</li>
<li>x:Name</li>
<li>x:FieldModifier</li>
</ol>
<h2 id="名称空间的由来和作用"><a href="#名称空间的由来和作用" class="headerlink" title="名称空间的由来和作用"></a>名称空间的由来和作用</h2><p><code>xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</code></p>
<p>专门用来解析和分析xaml文档的命名空间，大概可以理解为包含了很多”using”.就是“XAML名称空间”</p>
<h2 id="x名称空间里都有什么"><a href="#x名称空间里都有什么" class="headerlink" title="x名称空间里都有什么"></a>x名称空间里都有什么</h2><p>Tools：</p>
<ul>
<li>x:Array</li>
<li>x:Class</li>
<li>x:ClassModifier</li>
<li>x:Code</li>
<li>x:FieldModifier</li>
<li>x:Key</li>
<li>x:Name</li>
<li>x:Null</li>
<li>x:Shared</li>
<li>x:Static</li>
<li>x:Subclass</li>
<li>x:Type</li>
<li>x:TypeArguments</li>
<li>x:Uid</li>
<li>x:XData</li>
</ul>
<h2 id="x-Class"><a href="#x-Class" class="headerlink" title="x:Class"></a>x:Class</h2><p><code>x:Class=&quot;V3.引用&quot;</code></p>
<p>实际也是声明了一个partial class。即WPF设计是想要把页面设置和后台代码分开。XAML里的partial class专注于设计，代码的专注于逻辑。</p>
<h2 id="x-ClassModifier"><a href="#x-ClassModifier" class="headerlink" title="x:ClassModifier"></a>x:ClassModifier</h2><p><code>&lt;Window x:Class=&quot;V3.引用&quot; x:ClassModifier=&quot;internal&quot;...&gt;</code></p>
<p>只是改了xaml还不够，上面可以知道还得改C#</p>
<p><code>internal partial class 引用 : Window</code></p>
<h2 id="x-Name"><a href="#x-Name" class="headerlink" title="x:Name"></a>x:Name</h2><p>为对象准备一个引用变量方便在C#中直接访问。类似搞个指针？</p>
<p>对应到Unity，应该就是public一个变量命名并且拖过来。</p>
<p>声明一个引用变量，并且检查改对象是否有Name属性，没有就给他赋值，把name注册到WPF树里。</p>
<p>对于派生自FrameworkElement类的元素，都是有Name属性的，对于他们Name 和x:Name是同样的。但是其他就不同了</p>
<h2 id="x-FieldModifier"><a href="#x-FieldModifier" class="headerlink" title="x:FieldModifier"></a>x:FieldModifier</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid&gt;</span><br><span class="line">	&lt;TextBox x:FieldModifier=&quot;private&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">&lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>意思说xaml  的partial 类里定义的基本都是public ，这个x:FieldModifier就是给它设置权限的。</p>
<hr>
<h1 id="控件与布局"><a href="#控件与布局" class="headerlink" title="控件与布局"></a>控件与布局</h1><p>常用控件:</p>
<ol>
<li>布局控件: Grid StackPanel</li>
<li>内容控件: Window Button</li>
<li>带标题内容控件:GroupBox  TabItem</li>
<li>条目控件:ListBox  ComboBox</li>
<li>带标题条目控件:TreeViewItem  MenuItem</li>
<li>特殊内容控件:Image  TextBox</li>
</ol>
<h1 id="Binding"><a href="#Binding" class="headerlink" title="Binding"></a>Binding</h1><h2 id="Data-Binding在WPF中的地位"><a href="#Data-Binding在WPF中的地位" class="headerlink" title="Data Binding在WPF中的地位"></a>Data Binding在WPF中的地位</h2><p>它说程序的本质是数据加算法。数据在存储/逻辑/展示3个层流通。但是算法一般分布在这几处:</p>
<ol>
<li>数据库内部</li>
<li>读取与写回数据</li>
<li>业务逻辑</li>
<li>数据展示</li>
<li>界面与逻辑的交互</li>
</ol>
<p>理解WPF的数据驱动UI</p>
<p>Binding通过Path来指定关心的哪个属性，当值变化后属性还要有通知Binding的能力：一般在Set中激发PropertyChanged事件。实现System.ComponentModel名称空间中的InotifyPropertyChanged接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public partial class BindingBasic : Window</span><br><span class="line">   &#123;</span><br><span class="line">       Student stu;</span><br><span class="line">       public BindingBasic()</span><br><span class="line">       &#123;</span><br><span class="line">           InitializeComponent();</span><br><span class="line">           stu = new Student();</span><br><span class="line">           Binding binding = new Binding();</span><br><span class="line">           binding.Source = stu;</span><br><span class="line">           binding.Path = new PropertyPath(&quot;Name&quot;);</span><br><span class="line">           BindingOperations.SetBinding(this.textBox, TextBox.TextProperty, binding);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       private void ButtonClick(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           stu.Name += &quot;Name&quot;;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   public class Student:INotifyPropertyChanged</span><br><span class="line">   &#123;</span><br><span class="line">       public event PropertyChangedEventHandler PropertyChanged;</span><br><span class="line">       private string name;</span><br><span class="line">       public string Name</span><br><span class="line">       &#123;</span><br><span class="line">           get &#123; return name; &#125;</span><br><span class="line">           set</span><br><span class="line">           &#123;</span><br><span class="line">               name = value;</span><br><span class="line">               if (this.PropertyChanged!=null)</span><br><span class="line">               &#123;</span><br><span class="line">                   PropertyChanged.Invoke(this,new PropertyChangedEventArgs(&quot;Name&quot;));</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><code>BindingOperations.SetBinding(this.textBox, TextBox.TextProperty, binding);</code></p>
<p><code>public class Student:INotifyPropertyChanged</code></p>
<p>比较重要的就是上面两条。</p>
<p>实际工作中有简化。因为FrameworkElement对BindingOperations.SetBinding()方法进行了封装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public BindingExpressionBase SetBinding(DependencyProperty dp,BindingBase binding)</span><br><span class="line">&#123;</span><br><span class="line">    return BindingOperations.SetBinding(this,dp,binding);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有经验就继续</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public Window1()</span><br><span class="line">&#123;</span><br><span class="line">    InitializeComponent();</span><br><span class="line">    this.textBox.SetBinding(TextBox.TextProperty,new Binding(&quot;Name&quot;)&#123;Source=stu=new Student()&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="控制Binding的方向及数据更新"><a href="#控制Binding的方向及数据更新" class="headerlink" title="控制Binding的方向及数据更新"></a>控制Binding的方向及数据更新</h3><p>控制Binding数据流向的属性是Mode，它的类型是BindingMode枚举。取值为TwoWay,OneWay,OnTime,OneWayToSource,Default.</p>
<p>控制更新的属性UpdateSourceTrigger.枚举为PropertyChanged,LostFocus,Explicit,Default.</p>
<h3 id="没有Path的binding"><a href="#没有Path的binding" class="headerlink" title="没有Path的binding"></a>没有Path的binding</h3><p>如果Binding源本身就是数据且不需要path来指明，如string,int等基本类型。那么就可以把Path设定为.  xaml中可以不写.   C#中必须写. 0</p>
<p><code>Text=&quot;{Binding Source={StaticResource ResourceKey=myString}}&quot;</code> </p>
<p><code>Text=&quot;{Binding ., Source={StaticResource ResourceKey=myString}}</code></p>
<h3 id="为Binding指定源-Source-的几种方法"><a href="#为Binding指定源-Source-的几种方法" class="headerlink" title="为Binding指定源(Source)的几种方法"></a>为Binding指定源(Source)的几种方法</h3><p>常见的办法有</p>
<ul>
<li>把普通CLR单个对象指定为Source</li>
<li>把普通CLR集合类型对象指定为Source，包括数组、List<t>、ObservableCollection&lt;&gt; 。</t></li>
<li>ADO.NET数据对象指定为Source:DataTable和DataView等对象</li>
<li>用XmlDataProvider把XML数据指定为Source :</li>
<li>把依赖对象(Dependency Object)指定为Source:即可以成目标也可以成源。可以形成Binding链。</li>
<li>把容器的DataContext指定为Source，设置Path而不设置Source，让Binding自己去找Source。</li>
<li>通过ElementName指定Source：</li>
<li>通过Binding的RelativeSource属性相对地指定Source：控件关注自己的和内部元素的某个值。</li>
<li>把ObjectDataProvider对象指定为Source：</li>
<li>把LINQ检索得到的数据对象作为Bingding的源。</li>
</ul>
<h3 id="没有Source的Binding-使用DataContext作为Binding源"><a href="#没有Source的Binding-使用DataContext作为Binding源" class="headerlink" title="没有Source的Binding__使用DataContext作为Binding源"></a>没有Source的Binding__使用DataContext作为Binding源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Student</span><br><span class="line">&#123;</span><br><span class="line">    public int Id&#123;get;set;&#125;</span><br><span class="line">    public String Name&#123;get;set;&#125;</span><br><span class="line">    public int Age&#123;get;set;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;StackPanel.DataContext&gt;</span><br><span class="line">            &lt;local:Student Id=&quot;6&quot; Age=&quot;29&quot; Name=&quot;Tim&quot;&gt;&lt;/local:Student&gt;</span><br><span class="line">        &lt;/StackPanel.DataContext&gt;</span><br><span class="line">        &lt;Grid&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Path=Id&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Path=Name&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Path=Age&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Id&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Name&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding Age&#125;&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<p>结合前面的Source本身为数据时，path可以写成”.”。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;StackPanel.DataContext&gt;</span><br><span class="line">            &lt;sys:String&gt;Hello HerWorld!&lt;/sys:String&gt;</span><br><span class="line">        &lt;/StackPanel.DataContext&gt;</span><br><span class="line">        &lt;Grid&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;TextBox Text=&quot;&#123;Binding .&#125;&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<p>因为DataContext是依赖属性，当你没有为控件的某个依赖属性赋值时，该控件会把自己容器的属性值“借过来”当作自己的，也就是属性值可以沿某些UI元素树向下传递。</p>
<p>实际工作用法</p>
<ol>
<li>当UI上的多个控件都使用Binding关注同一个对象时</li>
<li>当作为Source的对象不能被直接访问的时候–</li>
</ol>
<h3 id="使用集合对象作为列表控件的ItemsSource"><a href="#使用集合对象作为列表控件的ItemsSource" class="headerlink" title="使用集合对象作为列表控件的ItemsSource"></a>使用集合对象作为列表控件的ItemsSource</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel x:Name=&quot;StackPanel&quot; Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;Student ID:&quot; FontWeight=&quot;Bold&quot; Margin=&quot;5&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;TextBlock&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;Student List&quot; FontWeight=&quot;Bold&quot; Margin=&quot;5&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">        &lt;ListBox x:Name=&quot;ListBoxStudent&quot; Height=&quot;110&quot; Margin=&quot;5&quot;&gt;&lt;/ListBox&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public List()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            List&lt;Student&gt; stuList = new List&lt;Student&gt;()</span><br><span class="line">            &#123;</span><br><span class="line">                new Student()&#123;Id=0,Name = &quot;Tim&quot;,Age=29&#125;,</span><br><span class="line">                new Student()&#123;Id=1,Name =&quot;Tom&quot;,Age=28 &#125;,</span><br><span class="line">                new Student()&#123;Id=2,Name = &quot;Kyle&quot;,Age=27&#125;,</span><br><span class="line">                new Student()&#123;Id=3,Name = &quot;Tony&quot;,Age=26&#125;,</span><br><span class="line">                new Student()&#123;Id=4,Name = &quot;Vina&quot;,Age=25&#125;,</span><br><span class="line">                new Student()&#123;Id=5,Name = &quot;Mike&quot;,Age=24&#125;,</span><br><span class="line">            &#125;;</span><br><span class="line">            ListBoxStudent.ItemsSource = stuList;</span><br><span class="line">            ListBoxStudent.DisplayMemberPath = &quot;Name&quot;;</span><br><span class="line"></span><br><span class="line">            Binding binding = new Binding(&quot;SelectedItem.Id&quot;)&#123;Source=this.ListBoxStudent&#125;;</span><br><span class="line">            TextBlock.SetBinding(TextBox.TextProperty, binding);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p><code>this.ListBoxStudent.DisplayMemberPath=&quot;Name&quot;</code>赋值后，ListBox在获得ItemsSource的时候就会创建等量的ListBoxItem 并且以DisplayMemberPath的属性值Path创建Binding，Binding的目标是ListBoxItem的内容插件</p>
<p>这个创建Binding的过程是在DisplayerMemberTemplateSelector类的SelectTemplate方法里完成的。这个方法的定义格式如下</p>
<p><code>public override DataTemplate SelectTemplate(object item,DependencyObject container){}</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Binding binding = new Binding();</span><br><span class="line">binding.Path = new PropertyPath(_displayMemberPath);</span><br><span class="line">bingding.StringFormat=_stringFormat;</span><br><span class="line">text.SetBinding(TextBlock.TextProperty,binding);</span><br></pre></td></tr></table></figure>
<p>显式设置DataTemplate的例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;ListBox x:Name=&quot;ListBoxStudent&quot; Height=&quot;110&quot; Margin=&quot;5&quot;&gt;</span><br><span class="line">            &lt;ListBox.ItemTemplate&gt;</span><br><span class="line">                &lt;DataTemplate&gt;</span><br><span class="line">                    &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                        &lt;TextBlock Text=&quot;&#123;Binding Path=Id&#125;&quot; Width=&quot;30&quot;/&gt;</span><br><span class="line">                        &lt;TextBlock Text=&quot;&#123;Binding Path=Name&#125;&quot; Width=&quot;60&quot;/&gt;</span><br><span class="line">                        &lt;TextBlock Text=&quot;&#123;Binding Path=Age&#125;&quot; Width=&quot;30&quot;/&gt;</span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                &lt;/DataTemplate&gt;</span><br><span class="line">            &lt;/ListBox.ItemTemplate&gt;</span><br><span class="line">        &lt;/ListBox&gt;</span><br></pre></td></tr></table></figure>
<p>Note:使用集合时一般考虑用ObservableCollection&lt;&gt;，它实现了InotifyCollectionChanged和INotifyPropertyChange接口，能把集合的变化立即通知显示它的列表控件。</p>
<h3 id="使用ADO-NET对象作为Binding源"><a href="#使用ADO-NET对象作为Binding源" class="headerlink" title="使用ADO.NET对象作为Binding源"></a>使用ADO.NET对象作为Binding源</h3><p>DataTable。。。Skip</p>
<hr>
<h3 id="使用XML数据作为Binding的源"><a href="#使用XML数据作为Binding的源" class="headerlink" title="使用XML数据作为Binding的源"></a>使用XML数据作为Binding的源</h3><p>.NET Framework提供了两套处理XML数据的类库：</p>
<ul>
<li>符合DOM(Document Object Modle,文档对象模型)标准的类库：包括XmlDocument、XmlElement、XmlAttribute等类。中规中矩。</li>
<li>以LINQ(Language-Intergrated Query,语言集成查询)为基础的类库：包括XDocument、XElement、XNode、XAttribute等类。方便</li>
</ul>
<p>Note:当使用XML数据作为Binding的Source时我们将使用XPath属性而不是Path来指定数据来源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private void ButtonClick(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            XmlDocument doc= new XmlDocument();</span><br><span class="line">            doc.Load(@&quot;C:\C\xml\RawData.xml&quot;);</span><br><span class="line">            XmlDataProvider xdp = new XmlDataProvider();</span><br><span class="line">            xdp.Document = doc;</span><br><span class="line">            //XmlDataProvider xdp1= new XmlDataProvider();</span><br><span class="line">            //xdp1.Source= new Uri(@&quot;C:\C\xml\RawData.xml&quot;);</span><br><span class="line">            xdp.XPath = @&quot;/StudentList/Student&quot;;</span><br><span class="line">            this.listViewStudents.DataContext = xdp;</span><br><span class="line">            listViewStudents.SetBinding(ListView.ItemsSourceProperty, new Binding());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>使用@的是元素的Attribute，不加的是子集元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;XmlDataProvider x:Key=&quot;xdp&quot; XPath=&quot;FileSystem/Folder&quot;&gt;</span><br><span class="line">            &lt;x:XData&gt;</span><br><span class="line">                &lt;FileSystem xmlns=&quot;&quot;&gt;</span><br><span class="line">                    &lt;Folder Name=&quot;Books&quot;&gt;</span><br><span class="line">                        &lt;Folder Name=&quot;Programing&quot;&gt;</span><br><span class="line">                            &lt;Folder Name=&quot;Windows&quot;&gt;</span><br><span class="line">                                &lt;Folder Name=&quot;WPF&quot;&gt;&lt;/Folder&gt;</span><br><span class="line">                                &lt;Folder Name=&quot;MFC&quot;/&gt;</span><br><span class="line">                                &lt;Folder Name=&quot;Delphi&quot;/&gt;</span><br><span class="line">                            &lt;/Folder&gt;</span><br><span class="line">                        &lt;/Folder&gt;</span><br><span class="line">                        &lt;Folder Name=&quot;Tools&quot;&gt;</span><br><span class="line">                            &lt;Folder Name=&quot;Development&quot;/&gt;</span><br><span class="line">                            &lt;Folder Name=&quot;Designment&quot;/&gt;</span><br><span class="line">                            &lt;Folder Name=&quot;Players&quot;/&gt;</span><br><span class="line">                        &lt;/Folder&gt;</span><br><span class="line">                    &lt;/Folder&gt;</span><br><span class="line">                &lt;/FileSystem&gt;</span><br><span class="line">            &lt;/x:XData&gt;</span><br><span class="line">        &lt;/XmlDataProvider&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;/Window.Resources&gt;</span><br><span class="line">    &lt;Grid&gt;</span><br><span class="line">        &lt;TreeView ItemsSource=&quot;&#123;Binding Source=&#123;StaticResource xdp&#125;&#125;&quot;&gt;</span><br><span class="line">            &lt;TreeView.ItemTemplate&gt;</span><br><span class="line">                &lt;HierarchicalDataTemplate ItemsSource=&quot;&#123;Binding XPath=Folder&#125;&quot;&gt;</span><br><span class="line">                    &lt;TextBlock Text=&quot;&#123;Binding XPath=@Name&#125;&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                &lt;/HierarchicalDataTemplate&gt;</span><br><span class="line">            &lt;/TreeView.ItemTemplate&gt;</span><br><span class="line">        &lt;/TreeView&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<h3 id="使用LINQ检索结果作为Binding的源"><a href="#使用LINQ检索结果作为Binding的源" class="headerlink" title="使用LINQ检索结果作为Binding的源"></a>使用LINQ检索结果作为Binding的源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;ListView x:Name=&quot;listViewStudents&quot; Height=&quot;143&quot; Margin=&quot;3&quot;&gt;</span><br><span class="line">            &lt;ListView.View&gt;</span><br><span class="line">                &lt;GridView&gt;</span><br><span class="line">                    &lt;GridViewColumn Header=&quot;Id&quot; Width=&quot;60&quot; DisplayMemberBinding=&quot;&#123;Binding Id&#125;&quot;&gt;&lt;/GridViewColumn&gt;</span><br><span class="line">                    &lt;GridViewColumn Header=&quot;Name&quot; Width=&quot;100&quot; DisplayMemberBinding=&quot;&#123;Binding Name&#125;&quot;&gt;&lt;/GridViewColumn&gt;</span><br><span class="line">                    &lt;GridViewColumn Header=&quot;Age&quot; Width=&quot;80&quot; DisplayMemberBinding=&quot;&#123;Binding Age&#125;&quot;&gt;&lt;/GridViewColumn&gt;</span><br><span class="line">                &lt;/GridView&gt;</span><br><span class="line">            &lt;/ListView.View&gt;</span><br><span class="line">        &lt;/ListView&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private void ButtonClick(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Student&gt; stuList = new List&lt;Student&gt;()</span><br><span class="line">            &#123;</span><br><span class="line">                new Student()&#123;Id=0,Name = &quot;Tim&quot;,Age=29&#125;,</span><br><span class="line">                new Student()&#123;Id=1,Name =&quot;Tom&quot;,Age=28 &#125;,</span><br><span class="line">                new Student()&#123;Id=2,Name = &quot;Kyle&quot;,Age=27&#125;,</span><br><span class="line">                new Student()&#123;Id=3,Name = &quot;Tony&quot;,Age=26&#125;,</span><br><span class="line">                new Student()&#123;Id=4,Name = &quot;Vina&quot;,Age=25&#125;,</span><br><span class="line">                new Student()&#123;Id=5,Name = &quot;Mike&quot;,Age=24&#125;,</span><br><span class="line">            &#125;;</span><br><span class="line">            this.listViewStudents.ItemsSource = from stu in stuList where stu.Name.StartsWith(&quot;T&quot;) select stu;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>如果是xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">XDocument xdoc= XDocument.Load(@"C:\C\xml\RawData01.xml");</span><br><span class="line">            listViewStudents.ItemsSource = from element in xdoc.Descendants("Student")</span><br><span class="line">                where element.Attribute("Name").Value.StartsWith("T")</span><br><span class="line">                select new Student()</span><br><span class="line">                &#123;</span><br><span class="line">                    Id = int.Parse(element.Attribute("Id").Value),</span><br><span class="line">                    Name = element.Attribute("Name").Value,</span><br><span class="line">                    Age = int.Parse(element.Attribute("Age").Value)</span><br><span class="line">                &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="使用ObjectDataProvider对象作为Source"><a href="#使用ObjectDataProvider对象作为Source" class="headerlink" title="使用ObjectDataProvider对象作为Source"></a>使用ObjectDataProvider对象作为Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Background=&quot;Gray&quot;&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBoxArg1&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBoxArg2&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBoxResult&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public ODPBook()</span><br><span class="line">       &#123;</span><br><span class="line">           InitializeComponent();</span><br><span class="line">           SetBinding();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       private void SetBinding()</span><br><span class="line">       &#123;</span><br><span class="line">           ObjectDataProvider odp= new ObjectDataProvider();</span><br><span class="line">           odp.ObjectInstance= new Calculator();</span><br><span class="line">           odp.MethodName = &quot;Add&quot;;</span><br><span class="line">           odp.MethodParameters.Add(&quot;0&quot;);</span><br><span class="line">           odp.MethodParameters.Add(&quot;0&quot;);</span><br><span class="line"></span><br><span class="line">           Binding bindingToArg1 = new Binding(&quot;MethodParameters[0]&quot;)</span><br><span class="line">           &#123;</span><br><span class="line">               Source = odp,</span><br><span class="line">               BindsDirectlyToSource = true,</span><br><span class="line">               UpdateSourceTrigger = UpdateSourceTrigger.PropertyChanged</span><br><span class="line">           &#125;;</span><br><span class="line"></span><br><span class="line">           Binding bindingToArg2 = new Binding(&quot;MethodParameters[1]&quot;)</span><br><span class="line">           &#123;</span><br><span class="line">               Source = odp,</span><br><span class="line">               BindsDirectlyToSource = true,</span><br><span class="line">               UpdateSourceTrigger = UpdateSourceTrigger.PropertyChanged</span><br><span class="line">           &#125;;</span><br><span class="line"></span><br><span class="line">           Binding bindingToResult = new Binding(&quot;.&quot;)&#123;Source = odp&#125;;</span><br><span class="line"></span><br><span class="line">           textBoxArg1.SetBinding(TextBox.TextProperty, bindingToArg1);</span><br><span class="line">           textBoxArg2.SetBinding(TextBox.TextProperty, bindingToArg2);</span><br><span class="line">           textBoxResult.SetBinding(TextBox.TextProperty, bindingToResult);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>Something Skip</p>
<h3 id="6-3-12-使用Binding的RelativeSource"><a href="#6-3-12-使用Binding的RelativeSource" class="headerlink" title="6.3.12 使用Binding的RelativeSource"></a>6.3.12 使用Binding的RelativeSource</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid x:Name=&quot;g1&quot; Background=&quot;Red&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">        &lt;DockPanel x:Name=&quot;d1&quot; Background=&quot;Orange&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">            &lt;Grid x:Name=&quot;g2&quot; Background=&quot;Yellow&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">                &lt;DockPanel x:Name=&quot;d2&quot; Background=&quot;LawnGreen&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">                    &lt;TextBox x:Name=&quot;TextBox&quot; FontSize=&quot;24&quot; Margin=&quot;10&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;/DockPanel&gt;</span><br><span class="line">            &lt;/Grid&gt;            </span><br><span class="line">        &lt;/DockPanel&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>把TextBox的Text属性关联到外层容器的Name属性上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public RelativeSourceHer()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            RelativeSource rs = new RelativeSource(RelativeSourceMode.FindAncestor);</span><br><span class="line">            rs.AncestorLevel = 1;</span><br><span class="line">            rs.AncestorType = typeof(Grid);</span><br><span class="line">            Binding binding = new Binding(&quot;Name&quot;)&#123;RelativeSource = rs&#125;;</span><br><span class="line">            TextBox.SetBinding(TextBox.TextProperty, binding);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>或者XAML中插入等效代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Text=&quot;&#123;Binding RelativeSource=&#123;RelativeSource FindAncestor, AncestorType=</span><br><span class="line">                        &#123;x:Type Grid&#125;,AncestorLevel=1&#125;,Path=Name&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>其中AncestorLevel属性指的是以Binding目标控件为起点的层级偏移量–d2的偏移量是1，g2的偏移量是2，依次类推。AncestorType属性告诉Binding寻找哪个类型的对象作为自己的源，不是这个类型的对象会被跳过。同理修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Text=&quot;&#123;Binding RelativeSource=&#123;RelativeSource FindAncestor, AncestorType=</span><br><span class="line">                        &#123;x:Type DockPanel&#125;,AncestorLevel=2&#125;,Path=Name</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Text=&quot;&#123;Binding RelativeSource=&#123;RelativeSource Self&#125;,Path=Name&#125;</span><br></pre></td></tr></table></figure>
<p>RelativeSource类的Mode属性的类型是RelativeSourceMode枚举，它的取值有：PreviousData、TemplateParent、Self和FindAncestor。RelativeSource类还有3个静态属性PreviousData、TemplateParent、Self。实际上这三静态属性就是创建一个RelativeSource实例、把实例的Mode属性设置为相应的值，然后返回这个实例。</p>
<p>例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public static RelativeSource Self</span><br><span class="line">&#123;</span><br><span class="line">    get</span><br><span class="line">    &#123;</span><br><span class="line">		if(s_self==null)</span><br><span class="line">		&#123; s_self = new RelativeSource(RelativeSourceMode.Self);&#125;</span><br><span class="line">		return s_self;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常用于 DataTemplate</p>
<ul>
<li>PreviousData</li>
<li>TemplateParent</li>
<li>Self</li>
</ul>
<h2 id="Binding对数据的转换与校验"><a href="#Binding对数据的转换与校验" class="headerlink" title="Binding对数据的转换与校验"></a>Binding对数据的转换与校验</h2><p>Source与Target之间的桥梁，可以设置安检。而且还可以提供变脸器（转换器Converter）让你通过。</p>
<h3 id="Binding的数据校验"><a href="#Binding的数据校验" class="headerlink" title="Binding的数据校验"></a>Binding的数据校验</h3><p>Binding的ValidationRules属性类型是Collection<validationrule>,从它的名称和数据类型可知可以设置多个数据校验条件，每个条件是一个ValidationRule类型对象。ValidationRule类是个抽象类，在使用的时候需要创建它的派生类并且实现它的Validate方法。该方法的返回值是ValidationResult类型对象，如果校验通过，就把ValidationResult对象的IsValid属性设为True，反之，则设置为false并为其ErrorContent属性设置一个合适的消息内容。</validationrule></p>
<p>Slider：0~100</p>
<p>xaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox&quot; Margin=&quot;5&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">        &lt;Slider x:Name=&quot;slider&quot; Minimum=&quot;-10&quot; Maximum=&quot;110&quot; Margin=&quot;5&quot; &gt;&lt;/Slider&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public SliderCheck()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            Binding binding = new Binding(&quot;Value&quot;)&#123;Source = this.slider&#125;;</span><br><span class="line">            binding.UpdateSourceTrigger = UpdateSourceTrigger.PropertyChanged;</span><br><span class="line">            RangeValidationRule rvr = new RangeValidationRule();</span><br><span class="line">            binding.ValidationRules.Add(rvr);</span><br><span class="line">            textBox.SetBinding(TextBox.TextProperty, binding);</span><br><span class="line">        &#125;</span><br><span class="line">        public class RangeValidationRule : ValidationRule</span><br><span class="line">        &#123;</span><br><span class="line">            public override ValidationResult Validate(object value, System.Globalization.CultureInfo cultureInfo)</span><br><span class="line">            &#123;</span><br><span class="line">                double d = 0;</span><br><span class="line">                if (double.TryParse(value.ToString(), out d))</span><br><span class="line">                &#123;</span><br><span class="line">                    if (d &gt;= 0 &amp;&amp; d &lt;= 100)</span><br><span class="line">                    &#123;</span><br><span class="line">                        return new ValidationResult(true, null);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return new ValidationResult(false, &quot;Validation Failed!&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>Binding校验默认来自Source的数据总是正确的，例如在Target  Slider里设置-10，上述方法不会报错。</p>
<p>所以当Source的数据有可能出现问题时，将校验条件的ValidatesOnTargetUpdated属性设置为True。</p>
<p><code>rvr.ValidatesOnTargetUpdated = true;</code></p>
<p>Route Event提示ToolTip失败提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RangeValidationRule rvr = new RangeValidationRule();</span><br><span class="line">            rvr.ValidatesOnTargetUpdated = true;</span><br><span class="line">            binding.ValidationRules.Add(rvr);</span><br><span class="line">            binding.NotifyOnValidationError = true;</span><br><span class="line">            textBox.SetBinding(TextBox.TextProperty, binding);</span><br><span class="line">            textBox.AddHandler(Validation.ErrorEvent,new RoutedEventHandler(this.ValidationError));</span><br></pre></td></tr></table></figure>
<p>事件处理器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void ValidationError(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            if (Validation.GetErrors(textBox).Count&gt;0)</span><br><span class="line">            &#123;</span><br><span class="line">                this.textBox.ToolTip = Validation.GetErrors(textBox)[0].ErrorContent.ToString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Binding的数据转换"><a href="#Binding的数据转换" class="headerlink" title="Binding的数据转换"></a>Binding的数据转换</h3><p>之前的Double和String 居然可以在C#这种强类型语言中转换自如。</p>
<p>那是因为Binding的另外一个机制 Data Convert，当Source端Path所关联的数据与Target端目标属性类型不一样的时候，可以添加转换器。上面提到的自动做了，但是有时需要自己做：</p>
<ul>
<li>Source里数据是Y、N和X三个值，UI对应CheckBox控件，需要把这三个值映射为它的IsChecked属性。</li>
<li>当TextBox里已经输入了文字时用于登陆的Button才出现，String类型与Visibility或者bool之间的转换</li>
<li>Source是Male或者Female（string或者枚举），UI上对应的是Image控件，需要转成Uri</li>
</ul>
<p>自己动手写Converter，创建一个类实现IValueConverter接口。定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface IValueConverter</span><br><span class="line">&#123;</span><br><span class="line">    object Convert(object value,Type targetType,object parameter,CultureInfo culture);</span><br><span class="line">    object ConvertBack(object value,Type targetType,object parameter,CultureInfo culture);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数据从Source流向Target时，Convert被调用，反之调用ConvertBack。第二个参数可以命名为outputType，确定方法的返回类型，第三个参数把额外的信息传入方法，如果需要多个信息可以把信息放入一个集合。Binding的Mode属性  OneWay 和TwoWay 影响到ConvertBack是否会被调用。</p>
<p>Converter实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;local:CategoryToSourceConverter x:Key=&quot;cts&quot;&gt;&lt;/local:CategoryToSourceConverter&gt;</span><br><span class="line">        &lt;local:StateToNullableBoolConverter x:Key=&quot;stnb&quot;&gt;&lt;/local:StateToNullableBoolConverter&gt;</span><br><span class="line">    &lt;/Window.Resources&gt;</span><br><span class="line">    &lt;StackPanel Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;ListBox x:Name=&quot;listBoxPlane&quot; Height=&quot;160&quot; Margin=&quot;5&quot;&gt;</span><br><span class="line">            &lt;ListBox.ItemTemplate&gt;</span><br><span class="line">                &lt;DataTemplate&gt;</span><br><span class="line">                    &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                        &lt;Image Width=&quot;20&quot; Height=&quot;20&quot; Source=&quot;&#123;Binding Path=Category,Converter=&#123;StaticResource cts&#125;&#125;&quot;/&gt;</span><br><span class="line">                        &lt;TextBlock Text=&quot;&#123;Binding Path=Name&#125;&quot; Width=&quot;60&quot; Margin=&quot;80,0&quot;/&gt;</span><br><span class="line">                        &lt;CheckBox IsThreeState=&quot;True&quot; IsChecked=&quot;&#123;Binding Path=State,Converter=&#123;StaticResource stnb&#125;&#125;&quot;/&gt;</span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                &lt;/DataTemplate&gt;</span><br><span class="line">            &lt;/ListBox.ItemTemplate&gt;</span><br><span class="line">        &lt;/ListBox&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;buttonLoad&quot; Content=&quot;Load&quot; Height=&quot;25&quot; Margin=&quot;5,0&quot; Click=&quot;buttonLoad_Click&quot;&gt;&lt;/Button&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;buttonSave&quot; Content=&quot;Save&quot; Height=&quot;25&quot; Margin=&quot;5,0&quot; Click=&quot;buttonSave_Click&quot;&gt;&lt;/Button&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">public partial class ConvertHer : Window</span><br><span class="line">    &#123;</span><br><span class="line">        public ConvertHer()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void buttonLoad_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Plane&gt; planeList = new List&lt;Plane&gt;()</span><br><span class="line">            &#123;</span><br><span class="line">                new Plane()&#123;Category =Category.Boomer,Name = &quot;B-1&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Boomer,Name = &quot;B-2&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Fighter,Name = &quot;F-22&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Fighter,Name = &quot;Su-47&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Boomer,Name = &quot;B-52&quot;,State = State.Unknown&#125;,</span><br><span class="line">                new Plane()&#123;Category =Category.Fighter,Name = &quot;J-10&quot;,State = State.Unknown&#125;,</span><br><span class="line">            &#125;;</span><br><span class="line">            this.listBoxPlane.ItemsSource = planeList;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void buttonSave_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            StringBuilder sb = new StringBuilder();</span><br><span class="line">            foreach (Plane plane in listBoxPlane.Items)</span><br><span class="line">            &#123;</span><br><span class="line">                sb.AppendLine(string.Format(&quot;Category=&#123;0&#125;,Name=&#123;1&#125;,State=&#123;2&#125;&quot;, plane.Category, plane.Name,</span><br><span class="line">                    plane.State));</span><br><span class="line">            &#125;</span><br><span class="line">            File.WriteAllText(@&quot;C:\C\xml\PlaneLIst.txt&quot;, sb.ToString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class CategoryToSourceConverter : IValueConverter</span><br><span class="line">    &#123;</span><br><span class="line">        public object Convert(object value, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            Category c = (Category) value;</span><br><span class="line">            switch (c)</span><br><span class="line">            &#123;</span><br><span class="line">                    case Category.Boomer:</span><br><span class="line">                        return @&quot;\Icons\boomer.png&quot;;</span><br><span class="line">                    case Category.Fighter:</span><br><span class="line">                        return @&quot;\Icons\fighter.png&quot;;</span><br><span class="line">                default:</span><br><span class="line">                    return null;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public object ConvertBack(object value, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new NotImplementedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class StateToNullableBoolConverter : IValueConverter</span><br><span class="line">    &#123;</span><br><span class="line">        public object Convert(object value, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            State s = (State) value;</span><br><span class="line">            switch (s)</span><br><span class="line">            &#123;</span><br><span class="line">                case State.Locked:</span><br><span class="line">                    return false;</span><br><span class="line">                    case State.Available:</span><br><span class="line">                        return true;</span><br><span class="line">                    case State.Unknown:</span><br><span class="line">                default:</span><br><span class="line">                        return null;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public object ConvertBack(object value, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            bool? nb = (bool?) value;</span><br><span class="line">            switch (nb)</span><br><span class="line">            &#123;</span><br><span class="line">                case true:</span><br><span class="line">                    return State.Available;</span><br><span class="line">                case false:</span><br><span class="line">                    return State.Locked;</span><br><span class="line">                case null:</span><br><span class="line">                    return State.Unknown;</span><br><span class="line">                default:</span><br><span class="line">                    return State.Unknown;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public enum Category</span><br><span class="line">    &#123;</span><br><span class="line">        Boomer,</span><br><span class="line">        Fighter</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public enum State</span><br><span class="line">    &#123;</span><br><span class="line">        Available,</span><br><span class="line">        Locked,</span><br><span class="line">        Unknown</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class Plane</span><br><span class="line">    &#123;</span><br><span class="line">        public Category Category &#123; get; set; &#125;</span><br><span class="line">        public  string Name &#123; get; set; &#125;</span><br><span class="line">        public  State  State &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="MultiBinding"><a href="#MultiBinding" class="headerlink" title="MultiBinding"></a>MultiBinding</h2><p>multiBinding与Binding一样均以BindingBase为基类，凡是能使用Binding对象的场合就可以使用MultiBinding。它具有一个名为Binding的属性，其类型是Collection<bindingbase>.</bindingbase></p>
<p>考虑这么一个需求，有一个用于新用户注册的UI，包含四个TextBox和一个Button。</p>
<ul>
<li>第一 二个TextBox输入用户名，要求内容一致</li>
<li>第三 四个TextBox输入E-Mail，要求内容一致</li>
<li>上述符合时Button可用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Background=&quot;LightBlue&quot;&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox1&quot; Height=&quot;23&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox2&quot; Height=&quot;23&quot; Margin=&quot;5,0&quot;/&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox3&quot; Height=&quot;23&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBox4&quot; Height=&quot;23&quot; Margin=&quot;5,0&quot;/&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;button1&quot; Content=&quot;Submit&quot; Width=&quot;80&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;button2&quot; Content=&quot;Submit&quot; Width=&quot;80&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public MultiBindingHer()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            this.SetMultiBinding();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void SetMultiBinding()</span><br><span class="line">        &#123;</span><br><span class="line">            Binding b1= new Binding(&quot;Text&quot;)&#123;Source = textBox1&#125;;</span><br><span class="line">            Binding b2 = new Binding(&quot;Text&quot;) &#123; Source = textBox2 &#125;;</span><br><span class="line">            Binding b3 = new Binding(&quot;Text&quot;) &#123; Source = textBox3 &#125;;</span><br><span class="line">            Binding b4 = new Binding(&quot;Text&quot;) &#123; Source = textBox4 &#125;;</span><br><span class="line"></span><br><span class="line">            MultiBinding mb = new MultiBinding()&#123;Mode=BindingMode.OneWay&#125;;</span><br><span class="line">            mb.Bindings.Add(b1);</span><br><span class="line">            mb.Bindings.Add(b2);</span><br><span class="line">            mb.Bindings.Add(b3);</span><br><span class="line">            mb.Bindings.Add(b4);</span><br><span class="line">            mb.Converter = new LogonMultiBindingConverter();</span><br><span class="line">            button1.SetBinding(Button.IsEnabledProperty,mb);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public class LogonMultiBindingConverter : IMultiValueConverter</span><br><span class="line">        &#123;</span><br><span class="line">            public object Convert(object[] values, Type outputType, object parameter, CultureInfo culture)</span><br><span class="line">            &#123;</span><br><span class="line">                if (!values.Cast&lt;String&gt;().Any(text=&gt;string.IsNullOrEmpty(text))</span><br><span class="line">                    &amp;&amp;values[0].ToString()==values[1].ToString()</span><br><span class="line">                    &amp;&amp;values[2].ToString()==values[3].ToString())</span><br><span class="line">                &#123;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public object[] ConvertBack(object value, Type[] outputTypes, object parameter, CultureInfo culture)</span><br><span class="line">            &#123;</span><br><span class="line">                throw new NotImplementedException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>总结：SetMultiBinding()  实现MutiBindingConverter()</p>
<h1 id="Attributes-讲属性"><a href="#Attributes-讲属性" class="headerlink" title="Attributes 讲属性"></a>Attributes 讲属性</h1><h2 id="7-1-属性的来龙去脉"><a href="#7-1-属性的来龙去脉" class="headerlink" title="7.1 属性的来龙去脉"></a>7.1 属性的来龙去脉</h2><p>C#规定 对类有意义的字段和方法使用static关键字修饰，称为静态成员，通过.访问</p>
<p>对类的实例有意义的字段和方法不加static，称为非静态成员或实例成员。</p>
<p>直接写字段暴露在外太不安全</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class Human&#123;public int age;&#125;</span><br></pre></td></tr></table></figure>
<p>于是聪明的程序源改写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Human</span><br><span class="line">        &#123;</span><br><span class="line">            private int age;</span><br><span class="line"></span><br><span class="line">            public void SetAge(int value)</span><br><span class="line">            &#123;</span><br><span class="line">                if (value&gt;=0 &amp;&amp; value&lt;=100)</span><br><span class="line">                &#123;</span><br><span class="line">                    age = value;</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    throw new OverflowException(&quot;Age overflow&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            public int GetAge()</span><br><span class="line">            &#123;</span><br><span class="line">                return age;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>.NET Framework推出时，微软更进一步把 GEt/Set合并成了属性。简短了代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class Human</span><br><span class="line">        &#123;</span><br><span class="line">            private int age;</span><br><span class="line">            public int Age</span><br><span class="line">            &#123;</span><br><span class="line">                get &#123; return age; &#125;</span><br><span class="line">                set</span><br><span class="line">                &#123;</span><br><span class="line">                    if (value&gt;=0&amp;&amp;value&lt;=100)</span><br><span class="line">                    &#123;</span><br><span class="line">                        this.age = value;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        throw  new OverflowException(&quot;Age overflow&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>.NET Framework推出时，微软更进一步把 GEt/Set合并成了属性。简短了代码,不失阅读性。这种属性又称为CLR属性（Common Language Runtime）。可以说CLR属性是private字段的安全访问包装，也可以说一个private字段在后台支持（back）一个CLR属性。</p>
<p>Note：CLR属性会占更多内存吗？属性的编译结果是两个方法！再多实例方法也只有一个Copy。</p>
<h2 id="依赖属性"><a href="#依赖属性" class="headerlink" title="依赖属性"></a>依赖属性</h2><ul>
<li>节省实例对内存的开销</li>
<li>属性值可以通过Binding依赖在其他对象上</li>
</ul>
<h3 id="7-2-1-依赖属性对内存的使用方式"><a href="#7-2-1-依赖属性对内存的使用方式" class="headerlink" title="7.2.1 依赖属性对内存的使用方式"></a>7.2.1 依赖属性对内存的使用方式</h3><p>思考，TextBox有138个属性，假设每个CLR属性包装一个4字节的字段，如果程序运行创建了一个10列1000行的TextBox列表，那么将占用4<em>138</em>10*1000=5.26M内存，怎么避免呢</p>
<p>用得着就带着，用不着就不带</p>
<p>WPF允许对象在被创建时不包含用于存储数据的空间（字段占用的空间）、只保留在需要用到数据时获取默认值、借用其他对象数据或实时分配空间的能力–这种对象就是依赖对象(Dependency Object),这种能力依靠依赖属性来实现。</p>
<p>依赖对象的概念被DependencyObject类实现。依赖属性的概念由DependencyProperty类实现。DependencyObject具有GetValue和SetValue两个方法。</p>
<p>DependencyProperty必须以DependencObject为宿主，因此，想自定义，宿主一定是DependencyObject的派生类。DependecyProperty实例的声明特点很鲜明–引用变量由public static readonly三个修饰符修饰，实例并非使用new操作符得到而是使用DependencyProperty.Register方法生成。代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class Student:DependencyObject</span><br><span class="line">&#123;</span><br><span class="line">	public static readonly DependencyProperty NameProperty=</span><br><span class="line">		DependencyProperty.Register(&quot;Name&quot;,typeof(string),typeof(Student));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3个参数</p>
<ol>
<li>此依赖属性back哪个CLR属性</li>
<li>此依赖属性存储什么类型的值，依赖属性的注册属性</li>
<li>依赖属性宿主类型，注册关联到哪个类型上。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">private Student stu;</span><br><span class="line">        public Dp()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            stu=new Student();</span><br><span class="line">            Binding binding= new Binding(&quot;Text&quot;)&#123;Source = textBox1&#125;;</span><br><span class="line">            BindingOperations.SetBinding(stu, Student.NameProperty, binding);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void ButtonClick(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Student stu= new Student();</span><br><span class="line">            stu.SetValue(Student.NameProperty,textBox1.Text);</span><br><span class="line">            textBox2.Text = (string) stu.GetValue(Student.NameProperty);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public class Student : DependencyObject</span><br><span class="line">        &#123;</span><br><span class="line">            public static readonly DependencyProperty NameProperty =</span><br><span class="line">                DependencyProperty.Register(&quot;Name&quot;, typeof(string), typeof(Student));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void ButtonClick1(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(stu.GetValue(Student.NameProperty).ToString());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>FrameworkElement类的SetBinding方法并不神秘，仅仅对BindingOperations的SetBinding方法做了一个简单的封装，代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public clas FrameworkElemnt:UIElement</span><br><span class="line">&#123;</span><br><span class="line">	public BindingExpressionBase SetBinding(DependencyProperty dp,BindingBase binding)</span><br><span class="line">    &#123;</span><br><span class="line">    	return BindingOperations.SetBinding(this,dp,binding);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Get,Set显得太过麻烦，于是添加一个CLR属性包装器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Student : DependencyObject</span><br><span class="line">        &#123;            </span><br><span class="line">            public String Name</span><br><span class="line">            &#123;</span><br><span class="line">                get &#123; return (string) GetValue(NameProperty); &#125;</span><br><span class="line">                set &#123; SetValue(NameProperty,value);&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            public static readonly DependencyProperty NameProperty =</span><br><span class="line">                DependencyProperty.Register(&quot;Name&quot;, typeof(string), typeof(Student));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>有了它就可以像普通属性一样访问依赖属性了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private void Button_Click(object sender,RoutedEventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    Student stu = new Student();</span><br><span class="line">    stu.Name=this.textBox1.Text;</span><br><span class="line">    this.textBox2.Text=stu.Name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note:propdp可以自动生成依赖属性</p>
<p>第四个参数：DefaultMetadata的作用是向依赖属性的调用者提供一些基本信息，包括：</p>
<ul>
<li>CoerceValueCallback 依赖属性值被强制改变时此委托会被调用，此委托可以关联一个影响函数</li>
<li>DefaultValue：依赖属性未被显式赋值时，</li>
<li>IsSealed：控制PropertyMetadata属性值是否可以更改</li>
<li>PropertyChangeCallback：依赖属性值被改变之后此委托调用，可以关联一个影响函数</li>
</ul>
<p>Note：依赖属性的DefaultMetadata只能通过Register方法的第四个参数进行赋值，而且一旦赋值就不能改变。如果想用新的替换，需要使用DependencyProperty.OverrideMetadata方法。</p>
<p>DependencyProperty被注册到了哪儿</p>
<p><code>private static Hashtable PropertyFromName= new Hashtable();</code></p>
<p>创建一个DependencyProperty实例并且用它的CLR属性名和宿主类型名生成hashcode，最后把hashcode和DependencyProperty实例作为Key—Value对存入全局的、名为PropertyFromName的Hashtable中。最后生成的DependencyProperty实例被当作返回值交还：</p>
<p>return dp；</p>
<p>并且DependencyProperty的GetHashCode方法被重写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public override int GetHashCode()</span><br><span class="line">&#123;</span><br><span class="line">    return GlobalIndex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WPF对依赖属性的读取优先级</p>
<ol>
<li>WPF属性系统强制值</li>
<li>由动画过程控制的值</li>
<li>本地变量值</li>
<li>上级元素Template设置的值</li>
<li>11</li>
<li>11</li>
<li>11</li>
<li>11</li>
<li>11</li>
<li>–</li>
<li></li>
</ol>
<h2 id="7-3-附加属性"><a href="#7-3-附加属性" class="headerlink" title="7.3 附加属性"></a>7.3 附加属性</h2><p>附加属性的作用是让属性与数据类型解耦,让数据类型的设计更加灵活。</p>
<p>比如<code>&lt;Button Content=&quot;OK&quot; Grid.Column=&quot;1&quot; Grid.Row=&quot;1&quot;</code></p>
<h1 id="说事件"><a href="#说事件" class="headerlink" title="说事件"></a>说事件</h1><p>事件系统在WPF中升级为了Routed Event，衍生出了命令传递机制。降低了耦合度。</p>
<h2 id="近观树形结构"><a href="#近观树形结构" class="headerlink" title="近观树形结构"></a>近观树形结构</h2><p>Route ：起点和终点间有若干个中转站，从起点出发后经过每个中转站时要做出选择，最终以正确的路径到达终点。</p>
<p>你可以把WPF的路由事件看成是一只小蚂蚁，它可以从树的基部向顶部（或者反向）目标爬行，每如果一个树枝的分岔点就会把消息带给这个分岔点。</p>
<p>WPF树：</p>
<p>Logical Tree：完全由布局组件和控件构成，查找用LogicalTreeHelper类的static方法，详见msdn</p>
<p>Visual Tree：如果把树叶在放大镜下看，也像树一样，控件本身也是由Visual类的更细微的可视化组件组成的树。用VisualTreeHelper类的static方法。</p>
<p>Routed Event是沿着Visual Tree传递的。</p>
<h2 id="事件的来龙去脉"><a href="#事件的来龙去脉" class="headerlink" title="事件的来龙去脉"></a>事件的来龙去脉</h2><p>事件的前身是Message。Windows是消息驱动的操作系统，程序也遵照这个机制运行。消息本身就是一条数据，这条数据里面记载着消息的类别，必要的时候还记载一些消息参数。比如，当你在窗体上按下鼠标左键，一条WM_LBUTTONDOWN的消息就被生成并且加入到Windows待处理的消息队列中–大部分情况下WIndows的消息队列里不会有太多的消息在排队、消息会立刻被处理。如果你的计算机很慢并且很忙，那么这条消息就要等会才被处理，此为操作系统延迟。然后窗体用自己的算法进行处理。</p>
<p>此为消息出发算法逻辑的过程。</p>
<p>时间过去，微软把消息机制封装成了更容易让人理解的事件模型。3个关键点</p>
<ul>
<li>事件的拥有者：消息的发送者。事件的宿主可以在默写条件下激发它拥有哦的事件，即事件被触发。事件被触发则消息被发送。</li>
<li>事件的响应者：即消息的接收者、处理者。使用事件处理器Event Handler对事件做出响应。</li>
<li>事件的订阅关系：事件的拥有者可以随时激发事件，但是事件发生后会不会得到响应要看有没有事件的响应者，或者说要看这个事件是否被关注。如果对象A关注对象B的某个事件是否发生，则称A订阅了B的事件。更进一步讲，事件实际上是一个使用event 关键字修饰的委托Delegate类型成员变量，事件处理器则是一个函数。说A订阅了B的事件，本质上是让B.Event与A.EventHandler关联起来。所谓事件激发就是B.Event被调用，这时，与其关联的A.EventHandler就被调用。</li>
</ul>
<p><img src="/images/001.png" alt="001"></p>
<p>这种传统的CLR事件模型，因为CLR事件本质上是一个用event关键字修饰的委托实例，我们暂且模仿CLR属性</p>
<p>的说法，把CLR事件定义为一个委托类型实例的包装器或者说有一个委托类型实例在backing一个CLR事件。</p>
<p>Windows Form项目中的一个button，可以认识事件模型的关键部分：</p>
<ul>
<li><p>事件的拥有者：myButton</p>
</li>
<li><p>事件：myButton.Click</p>
</li>
<li><p>事件的响应者:窗体本身</p>
</li>
<li><p>事件处理器：this.myButton_Click</p>
</li>
<li><p>订阅关系:</p>
<p><code>this.myButton.Click+= new System.EventHandler(this.myButton_Click);</code></p>
<p>如果实现如下方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private void myButton_Click(object sender,EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    if(sender is Button)</span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox.Show((sender as Button).Name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>运行后会显示myButton。说明在CLR事件模型中，事件的拥有者就是消息的发送者sender。</p>
<p>弊端：</p>
<ul>
<li>每对消息是“发送-响应”关系，必须是建立显式的点对点订阅关系</li>
<li>事件的宿主必须能够直接访问事件的响应者，不然无法建立订阅关系。</li>
</ul>
<p>路由事件就很好的解决了上述问题。</p>
<h2 id="路由事件Routed-Event"><a href="#路由事件Routed-Event" class="headerlink" title="路由事件Routed Event"></a>路由事件Routed Event</h2><p>直接事件激发：发送者直接将消息通过事件订阅交给事件响应者，事件响应者使用其事件处理器方法对事件的发生做出响应、驱动程序逻辑按客户需求运行。</p>
<p>路由事件激发：事件的拥有者和事件响应者之间没有直接显式的订阅关系，事件的拥有者只负责激发事件，事件的响应者则安装有事件侦听器，当它被单击后大喊一声我被单击了，这样一个Button.Click事件就开始在Visual Tree中传播，当事件经过某个节点时如果这个节点没有安装用于侦听Button.Click事件的耳朵，那么它会无视这个事件，让它继续传播，如果安装了，它的事件处理器就会被调用（任何一个传来的Button.Click事件都会被侦听到，例如在StackPanel上的Button.Click 能侦听其内所有button的事件），在事件处理器内程序员可以查看路由事件原始的出发点是哪个控件、上一站是哪里，还可以决定事件传递到此还是可以继续传递，像烽火台一样的传递策略。</p>
<p>传统的事件在WPF也是可以用的。</p>
<h3 id="8-3-1-内置路由事件"><a href="#8-3-1-内置路由事件" class="headerlink" title="8.3.1 内置路由事件"></a>8.3.1 内置路由事件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid x:Name=&quot;gridRoot&quot; Background=&quot;Lime&quot;&gt;</span><br><span class="line">        &lt;Grid x:Name=&quot;gridA&quot; Margin=&quot;10&quot; Background=&quot;Blue&quot;&gt;</span><br><span class="line">            &lt;Grid.ColumnDefinitions&gt;</span><br><span class="line">                &lt;ColumnDefinition/&gt;</span><br><span class="line">                &lt;ColumnDefinition/&gt;</span><br><span class="line">            &lt;/Grid.ColumnDefinitions&gt;</span><br><span class="line">            &lt;Canvas x:Name=&quot;canvasLeft&quot; Grid.Column=&quot;0&quot; Background=&quot;Red&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">                &lt;Button x:Name=&quot;buttonLeft&quot; Content=&quot;Left&quot; Width=&quot;40&quot; Height=&quot;100&quot; Margin=&quot;10&quot; </span><br><span class="line">                        &gt;&lt;/Button&gt;</span><br><span class="line">            &lt;/Canvas&gt;</span><br><span class="line">            &lt;Canvas x:Name=&quot;canvasRight&quot; Grid.Column=&quot;1&quot; Background=&quot;Yellow&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">                &lt;Button x:Name=&quot;buttonRight&quot; Content=&quot;Right&quot; Width=&quot;40&quot; Height=&quot;100&quot; Margin=&quot;10&quot;&gt;&lt;/Button&gt;</span><br><span class="line">            &lt;/Canvas&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>单击buttonLeft时，事件沿着buttonLeft-&gt;canvasLeft-&gt;GridA-&gt;gridRoot-&gt;Window向上传递。</p>
<p>由于没有安装侦听器，所以无响应</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public RoutedLogicalTree()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            this.gridRoot.AddHandler(Button.ClickEvent,new RoutedEventHandler(this.ButtonClicked));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>可以如上添加。</p>
<p>AddHandler方法源自UIElement类，也就是说，所有UI控件都具有这个方法。AddHandler方法第一个参数是Button.ClickEvent而不是Button.Click。原来,WPF事件系统也使用了与属性系统类似的“静态字段-&gt;包装器(Wrapper)”的策略。</p>
<p>路由事件本身是一个RoutedEvent类型的静态成员变量(Button.ClickEvent),Button还有一个与之对应的Click事件(CLR包装)专门用于对外界暴露这个事件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private void ButtonClicked(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show((e.OriginalSource as FrameworkElement).Name);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:因为路由事件的消息是从内部一层一层传递出来并且由gridRoot元素将事件消息交给ButtonClicked方法来处理，所以传入ButtonClicked方法的参数sender实际上是gridRoot而不是被单击的Button，解决方法是使用e.OriginalSource，再使用as/is操作符或者强制类型转换。</p>
</blockquote>
<p>或者可以在grid上添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid x:Name=&quot;gridRoot&quot; Background=&quot;Lime&quot; Button.Click=&quot;ButtonClicked&quot;&gt;</span><br><span class="line">	...</span><br><span class="line">&lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>但是这里编辑器不会有提示，只能自己认真小心写啦</p>
<p>但是如果你是用ButtonBase.Click就可以有提示。 道理很简单，因为ClickEvent这个路由事件是ButtonBase类的静态成员变量(Button类继承获得它),而XAML编辑器只认得包含ClickEvent字段定义的类。</p>
<h3 id="8-3-2-自定义Routed-Event"><a href="#8-3-2-自定义Routed-Event" class="headerlink" title="8.3.2 自定义Routed Event"></a>8.3.2 自定义Routed Event</h3><p>步骤:</p>
<ol>
<li>声明并注册路由事件</li>
<li>为路由事件添加CLR事件包装</li>
<li>创建可以激发路由事件的方法</li>
</ol>
<p>定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public abstract clas ButtonBase:ContentControl,ICommandSource</span><br><span class="line">&#123;</span><br><span class="line">	//声明并注册路由事件</span><br><span class="line">	public static readonly RoutedEvent ClickEvent=/*注册路由事件*/</span><br><span class="line">	//为路由事件添加CLR事件包装器</span><br><span class="line">	public event RoutedEventHandler ClickEvent</span><br><span class="line">	&#123;</span><br><span class="line">		add&#123;this.AddHandler(ClickEvent,value);&#125;</span><br><span class="line">		remove&#123;this.RemoveHandler(ClickEvent,value);&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	//激发路由事件的方法。此方法在用户单击鼠标时会被Windows系统调用</span><br><span class="line">	protected virtual void OnClick()</span><br><span class="line">	&#123;</span><br><span class="line">		RoutedEventArgs newEvent = new RoutedEventArgs(ButtonBase.ClickEvent,this);</span><br><span class="line">		this.RaiseEvent(newEvent);</span><br><span class="line">	&#125;</span><br><span class="line">	//...</span><br><span class="line">		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CLR事件包装器让路由事件暴露得像一个传统的直接事件，可以用+= 和-=，代码格式换成了add和remove。</p>
<p>激发路由事件，首先创建需要让事件携带的消息（RoutedEventArgs类的实例）并且让它与路由事件关联，然后调用元素的RaiseEvent方法(继承自UIElement类)把事件发送出去。这与传统事件的方法不同，传统事件激发是通过调用CLR的Invoke方法实现的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public static readonly RoutedEvent ClickEvent= EventManager.RegisterRoutedEvent</span><br><span class="line">(&quot;Click&quot;,RoutingStrategy.Bubble,typeof(RoutedEventHandler),typeof(ButtonBase));</span><br></pre></td></tr></table></figure>
<p>参数说明:</p>
<ol>
<li>string,路由事件的名称，尽量和RoutedEvent变量的前缀一致</li>
<li>路由策略<ul>
<li>Buttle,冒泡式</li>
<li>Tunnel，隧道式</li>
<li>Direct，直达式，模仿CLR直接事件</li>
</ul>
</li>
<li>指定事件处理器的类型</li>
<li>指定路由事件的宿主类型。</li>
</ol>
<p>下面动手创建一个路由事件，包含事件发生的时间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class  ReportTimeEventArgs : RoutedEventArgs</span><br><span class="line">&#123;</span><br><span class="line">    public ReportTimeEventArgs(RoutedEvent routedEvent, object source)</span><br><span class="line">        : base(routedEvent, source) &#123; &#125;</span><br><span class="line">    public DateTime ClickTime &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class TimeButton : Button</span><br><span class="line">&#123;</span><br><span class="line">    public static readonly RoutedEvent ReportTimeEvent = EventManager.RegisterRoutedEvent(</span><br><span class="line">        &quot;ReportTime&quot;, RoutingStrategy.Bubble, typeof(EventHandler&lt;ReportTimeEventArgs&gt;), typeof(TimeButton));</span><br><span class="line">    //CLR事件包装器</span><br><span class="line">    public event RoutedEventHandler ReportTime</span><br><span class="line">    &#123;</span><br><span class="line">        add &#123; this.AddHandler(ReportTimeEvent, value); &#125;</span><br><span class="line">        remove &#123; this.RemoveHandler(ReportTimeEvent, value); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override void OnClick()</span><br><span class="line">    &#123;</span><br><span class="line">        base.OnClick();</span><br><span class="line"></span><br><span class="line">        ReportTimeEventArgs args = new ReportTimeEventArgs(ReportTimeEvent, this);</span><br><span class="line">        args.ClickTime = DateTime.Now;</span><br><span class="line">        this.RaiseEvent(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  Title=&quot;HerCustomRoutedEvent&quot; x:Name=&quot;window1&quot; Height=&quot;350&quot; Width=&quot;300&quot;</span><br><span class="line">    local:TimeButton.ReportTime=&quot;ReportTimeHandler&quot;&gt;</span><br><span class="line">&lt;Grid x:Name=&quot;gird_1&quot; local:TimeButton.ReportTime=&quot;ReportTimeHandler&quot;  &gt;</span><br><span class="line">    &lt;Grid x:Name=&quot;grid_2&quot; local:TimeButton.ReportTime=&quot;ReportTimeHandler&quot;&gt;</span><br><span class="line">        &lt;Grid x:Name=&quot;grid_3&quot; local:TimeButton.ReportTime=&quot;ReportTimeHandler&quot;&gt;</span><br><span class="line">            &lt;StackPanel x:Name=&quot;stackPanel_1&quot; local:TimeButton.ReportTime=&quot;ReportTimeHandler&quot;&gt;</span><br><span class="line">                &lt;ListBox x:Name=&quot;listBox&quot;/&gt;</span><br><span class="line">                &lt;local:TimeButton x:Name=&quot;timeButton&quot; Width=&quot;80&quot; Height=&quot;80&quot; Content=&quot;SeeTime&quot;</span><br><span class="line">                                  local:TimeButton.ReportTime=&quot;ReportTimeHandler&quot;&gt;&lt;/local:TimeButton&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line"></span><br><span class="line">&lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private void ReportTimeHandler(object sender, ReportTimeEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            FrameworkElement element= sender as FrameworkElement;</span><br><span class="line">            string timeStr = e.ClickTime.ToLongTimeString();</span><br><span class="line">            string content = string.Format(&quot;&#123;0&#125; To &#123;1&#125; &quot;, timeStr, element.Name);</span><br><span class="line">            this.listBox.Items.Add(content);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>如果在方法中加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (element==this.grid_2)</span><br><span class="line">            &#123;</span><br><span class="line">                e.Handled = true;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>那么就会在grid_2断掉</p>
<blockquote>
<p>Note：路由事件将程序中的组件进一步解耦</p>
<ul>
<li>很多类的事件都是路由事件，如TextBox类的TextChanged事件，Binding类的SourceUpdate事件等，所以在用到这些类时要发挥想象力</li>
<li>也不要滥用路由事件，事件该结束就Handled了，不要惹麻烦</li>
</ul>
</blockquote>
<h3 id="8-3-3-RoutedEventArgs的Source与OriginalSource"><a href="#8-3-3-RoutedEventArgs的Source与OriginalSource" class="headerlink" title="8.3.3 RoutedEventArgs的Source与OriginalSource"></a>8.3.3 RoutedEventArgs的Source与OriginalSource</h3><p>说路由事件在VisualTree上传递，本意是说”路由事件的消息在VisualTree上传递”，而路由事件的消息则包含在RoutedEventArgs实例中。</p>
<p>RoutedEventArgs两个属性</p>
<ul>
<li>Source：LogicalTree上的消息源头</li>
<li>OriginalSource：VisualTree上的消息源头</li>
</ul>
<p>先创建一个UserControl，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;UserControl x:Class=&quot;RoutedEventH.HerUserControl&quot;</span><br><span class="line">             xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot; </span><br><span class="line">             xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot; </span><br><span class="line">             xmlns:local=&quot;clr-namespace:RoutedEventH&quot;</span><br><span class="line">             mc:Ignorable=&quot;d&quot; </span><br><span class="line">             d:DesignHeight=&quot;90&quot; d:DesignWidth=&quot;90&quot;&gt;</span><br><span class="line">    &lt;Border BorderBrush=&quot;Orange&quot; BorderThickness=&quot;3&quot; CornerRadius=&quot;5&quot;&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;innerButton&quot; Width=&quot;80&quot; Height=&quot;80&quot; Content=&quot;OK&quot;&gt;&lt;/Button&gt;</span><br><span class="line">    &lt;/Border&gt;</span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure>
<p>然后添加到主窗体中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid&gt;</span><br><span class="line">        &lt;local:HerUserControl x:Name=&quot;herUserControl&quot; Margin=&quot;10&quot;&gt;&lt;/local:HerUserControl&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>后台</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public SourceAndOriginalSource()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            this.AddHandler(Button.ClickEvent,new RoutedEventHandler(this.Button_Click));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void Button_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            string strOriginSource = string.Format(&quot;VisualTree start point: &#123;0&#125;, type is &#123;1&#125; &quot;,</span><br><span class="line">                (e.OriginalSource as FrameworkElement).Name, e.OriginalSource.GetType().Name);</span><br><span class="line">            string strSource = string.Format(&quot;LogicalTree start point:&#123;0&#125;,tpye  is &#123;1&#125; &quot;,</span><br><span class="line">                (e.Source as FrameworkElement).Name, e.Source.GetType().Name);</span><br><span class="line">            MessageBox.Show(strOriginSource + &quot;\r\n&quot; + strSource);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-3-4-附加事件Attached-Event"><a href="#8-3-4-附加事件Attached-Event" class="headerlink" title="8.3.4 附加事件Attached Event"></a>8.3.4 附加事件Attached Event</h3><p>哪些类有附加事件</p>
<ul>
<li>Binding类：SourceUpdated事件、TargetUpdated事件</li>
<li>Mouse类：MouseEnter、MouseLeave、MouseDown、MouseUp</li>
<li>Keyboard类：KeyDown、KeyUp</li>
</ul>
<p>对比一下那些拥有路由事件的类，如Button、Slider、TextBox…发现什么问题了吗</p>
<p>路由事件的宿主都是拥有可视化实体的界面元素</p>
<p>附加事件不具有显示在用户界面上的能力</p>
<p>设想实现：</p>
<p>设计一个Student类，如果Student实例的Name属性值发生了变化，就激发一个路由事件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid x:Name=&quot;gridMain&quot; &gt;</span><br><span class="line">        &lt;Button x:Name=&quot;button1&quot; Content=&quot;OK&quot; Width=&quot;80&quot; Height=&quot;80&quot; Click=&quot;Button_Click&quot;/&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">public partial class AttachedEventH : Window</span><br><span class="line">    &#123;</span><br><span class="line">        public AttachedEventH()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            //this.gridMain.AddHandler(</span><br><span class="line">            //    Student.NameChangedEvent, new RoutedEventHandler(this.StudentNameChangeHandler));</span><br><span class="line">            Student.AddNameChangedHandler(</span><br><span class="line">                this.gridMain,</span><br><span class="line">                new RoutedEventHandler(this.StudentNameChangeHandler)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        public class Student</span><br><span class="line">        &#123;</span><br><span class="line">            public static readonly RoutedEvent NameChangedEvent = EventManager.RegisterRoutedEvent</span><br><span class="line">                (&quot;NameChanged&quot;, RoutingStrategy.Bubble, typeof(RoutedEventHandler), typeof(Student));</span><br><span class="line"></span><br><span class="line">            public static void AddNameChangedHandler(DependencyObject d, RoutedEventHandler h)</span><br><span class="line">            &#123;</span><br><span class="line">                UIElement e = d as UIElement;</span><br><span class="line">                if (e!=null)</span><br><span class="line">                &#123;</span><br><span class="line">                    e.AddHandler(Student.NameChangedEvent, h);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public static void RemoveNameChangedHandler(DependencyObject d, RoutedEventHandler h)</span><br><span class="line">            &#123;</span><br><span class="line">                UIElement e = d as UIElement;</span><br><span class="line">                if (e!=null)</span><br><span class="line">                &#123;</span><br><span class="line">                    e.RemoveHandler(Student.NameChangedEvent, h);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public int Id &#123; get; set; &#125;</span><br><span class="line">            public string Name &#123; get; set; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void Button_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Student stu = new Student() &#123;Id = 101, Name = &quot;Tim&quot;&#125;;</span><br><span class="line">            stu.Name = &quot;Tom&quot;;</span><br><span class="line">            RoutedEventArgs arg = new RoutedEventArgs(Student.NameChangedEvent, stu);</span><br><span class="line">            this.button1.RaiseEvent(arg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void StudentNameChangeHandler(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show((e.OriginalSource as Student).Id.ToString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>自定义的类并非派生自UIElement，因此不具备AddHandler和RemoveHandler这两个方法，所以不能使用CLR属性作为包装器，规定：</p>
<ul>
<li>为目标UI元素添加附加事件侦听器的包装器是一个名为Add*Handler的public static 方法，星号代表事件名称。此方法接收两个参数，一个参数是事件的侦听者，类型为DependencyObject，另外一个是事件的处理器（RoutedEventHandler委托类型）</li>
<li>解除UI元素对附加事件侦听的包装器是名为Remove*Handler的public static 方法。</li>
</ul>
<blockquote>
<p>Note:</p>
<p>第一，像Button.Click这些路由事件，因为事件的宿主是界面元素、本身就是UI树上的一个节点，所以路由事件路由时的第一站就是事件的激发者。附加事件宿主不是UIElement的派生类，所以不能出现在UI树上的节点，而且附加事件的激发是借助UI元素实现的，因此，附加事件路由的第一站是激发它的元素。</p>
<p>第二，实际上很少把附加事件定义在Student这种与业务逻辑相关的类中，一般都是定义在像Binding、Mouse、Keyboard这种全局的Helper类中。如果需要业务逻辑对象能发出路由事件怎么办？Binding，</p>
<p>如果程序架构设计得好，那么业务逻辑一定会使用Binding与元素关联，。。。。</p>
</blockquote>
<h1 id="命令-Command"><a href="#命令-Command" class="headerlink" title="命令 Command"></a>命令 Command</h1><h2 id="9-1-命令系统的基本元素与关系"><a href="#9-1-命令系统的基本元素与关系" class="headerlink" title="9.1 命令系统的基本元素与关系"></a>9.1 命令系统的基本元素与关系</h2><h3 id="9-1-1-命令系统的基本元素"><a href="#9-1-1-命令系统的基本元素" class="headerlink" title="9.1.1 命令系统的基本元素"></a>9.1.1 命令系统的基本元素</h3><p>要素：</p>
<ul>
<li>Command： 实现了ICommand接口的类，使用多的是RoutedCommand类和自定义的</li>
<li>Command Source：命令的发送者，实现了ICommandSource接口的类，例如Button、MenuItem、ListBoxItem等</li>
<li>Command Target：命令目标必须实现IInputElement接口的类</li>
<li>Command Binding：判断和后续工作等</li>
</ul>
<h3 id="9-1-2-基本元素之间的关系"><a href="#9-1-2-基本元素之间的关系" class="headerlink" title="9.1.2 基本元素之间的关系"></a>9.1.2 基本元素之间的关系</h3><p>命令的使用：</p>
<ol>
<li>创建命令类</li>
<li>声明命令实例</li>
<li>指定命令的源</li>
<li>指定命令目标</li>
<li>设置命令关联</li>
</ol>
<p>命令目标如果被瞄上，会不停地发送可路由的Preview-CanExecute和CanExecute附加事件，命令目标的PreviewCanExecute、CanExecute、PreviewExecuted和Executed事件都是附加事件，Preview-CanExecute和CanExecute执行时机不由程序员控制，很容易出bug，务必小心。</p>
<h3 id="9-1-3-小试命令"><a href="#9-1-3-小试命令" class="headerlink" title="9.1.3 小试命令"></a>9.1.3 小试命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel x:Name=&quot;stackPanel&quot;&gt;</span><br><span class="line">        &lt;Button x:Name=&quot;button1&quot; Content=&quot;Send Command&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">        &lt;TextBox x:Name=&quot;textBoxA&quot; Margin=&quot;5,0&quot; Height=&quot;100&quot;/&gt;</span><br><span class="line">&lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public partial class FirstCommand : Window</span><br><span class="line">    &#123;</span><br><span class="line">        public FirstCommand()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            InitializeCommand();</span><br><span class="line">        &#125;</span><br><span class="line">        //声明定义命令</span><br><span class="line">        private RoutedCommand clearCmd = new RoutedCommand(&quot;Clear&quot;, typeof(FirstCommand));</span><br><span class="line"></span><br><span class="line">        private void InitializeCommand()</span><br><span class="line">        &#123;</span><br><span class="line">            //把命令赋值给命令源（发送者）并且指定快捷键</span><br><span class="line">            this.button1.Command = this.clearCmd;</span><br><span class="line">            this.clearCmd.InputGestures.Add(new KeyGesture(Key.C, ModifierKeys.Alt));</span><br><span class="line"></span><br><span class="line">            //指定命令目标</span><br><span class="line">            this.button1.CommandTarget = this.textBoxA;</span><br><span class="line">            //创建命令关联</span><br><span class="line">            CommandBinding cb = new CommandBinding();</span><br><span class="line">            cb.Command = this.clearCmd; //只关注与clearCmd相关的事件</span><br><span class="line">            cb.CanExecute += new CanExecuteRoutedEventHandler(cb_CanExecute);</span><br><span class="line">            cb.Executed += new ExecutedRoutedEventHandler(cb_Executed);</span><br><span class="line"></span><br><span class="line">            //把命令关联安置在外围控件上</span><br><span class="line">            this.stackPanel.CommandBindings.Add(cb);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //当探测命令是否可以执行时，此方法被调用</span><br><span class="line">        void cb_CanExecute(object sender, CanExecuteRoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            if (string.IsNullOrEmpty(this.textBoxA.Text))</span><br><span class="line">            &#123;</span><br><span class="line">                e.CanExecute = false;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">                e.CanExecute = true;</span><br><span class="line">            //避免继续向上</span><br><span class="line">            e.Handled = true;</span><br><span class="line">        &#125;</span><br><span class="line">        //当命令送达目标后，此方法被调用</span><br><span class="line">        void cb_Executed(object sender, ExecutedRoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            this.textBoxA.Clear();</span><br><span class="line">            //避免继续向上传</span><br><span class="line">            e.Handled = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note:</p>
<ol>
<li>使用命令可以少写些代码</li>
<li>RoutedCommand是一个与业务逻辑无关的类，清空操作是CommandBinding做的</li>
<li>CanExecute事件记得Handled</li>
<li>CommandBinding设置在目标的外围控件上</li>
</ol>
</blockquote>
<h3 id="9-1-4-WPF-命令库"><a href="#9-1-4-WPF-命令库" class="headerlink" title="9.1.4 WPF 命令库"></a>9.1.4 WPF 命令库</h3><ul>
<li>ApplicationCommands</li>
<li>ComponentCommands</li>
<li>NavigationCommands</li>
<li>MediaCommands</li>
<li>EditingCommands</li>
</ul>
<p>他们都是静态类，以单例模式暴露出来</p>
<h3 id="9-1-5-命令参数"><a href="#9-1-5-命令参数" class="headerlink" title="9.1.5 命令参数"></a>9.1.5 命令参数</h3><p>使用CommandParameter区别命令的对象</p>
<p>CommandParameter属性来自ICommandSource接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Title=&quot;命令参数&quot; Height=&quot;240&quot; Width=&quot;400&quot; Background=&quot;LightBlue&quot; WindowStyle=&quot;ToolWindow&quot;&gt;</span><br><span class="line">&lt;Grid Margin=&quot;6&quot;&gt;</span><br><span class="line">    &lt;Grid.RowDefinitions&gt;</span><br><span class="line">        &lt;RowDefinition Height=&quot;24&quot;/&gt;</span><br><span class="line">        &lt;RowDefinition Height=&quot;4&quot;/&gt;</span><br><span class="line">        &lt;RowDefinition Height=&quot;24&quot;/&gt;</span><br><span class="line">        &lt;RowDefinition Height=&quot;4&quot;/&gt;</span><br><span class="line">        &lt;RowDefinition Height=&quot;24&quot;/&gt;</span><br><span class="line">        &lt;RowDefinition Height=&quot;4&quot;/&gt;</span><br><span class="line">        &lt;RowDefinition Height=&quot;*&quot;/&gt;</span><br><span class="line">    &lt;/Grid.RowDefinitions&gt;</span><br><span class="line">    &lt;!--命令和命令参数--&gt;</span><br><span class="line">    &lt;TextBlock Text=&quot;Name:&quot; VerticalAlignment=&quot;Center&quot; HorizontalAlignment=&quot;Left&quot; Grid.Row=&quot;0&quot;/&gt;</span><br><span class="line">    &lt;TextBox x:Name=&quot;nameTextBox&quot; Margin=&quot;60,0,0,0&quot; Grid.Row=&quot;0&quot;/&gt;</span><br><span class="line">    &lt;Button Content=&quot;New Teacher&quot; Command=&quot;New&quot; CommandParameter=&quot;Teacher&quot; Grid.Row=&quot;2&quot;/&gt;</span><br><span class="line">    &lt;Button Content=&quot;New Student&quot; Command=&quot;New&quot; CommandParameter=&quot;Student&quot; Grid.Row=&quot;4&quot;/&gt;</span><br><span class="line">    &lt;ListBox x:Name=&quot;listBoxNewItems&quot; Grid.Row=&quot;6&quot;/&gt;</span><br><span class="line">&lt;/Grid&gt;</span><br><span class="line">&lt;Window.CommandBindings&gt;</span><br><span class="line">    &lt;CommandBinding Command=&quot;New&quot; CanExecute=&quot;New_CanExecute&quot; Executed=&quot;New_Executed&quot;/&gt;</span><br><span class="line">&lt;/Window.CommandBindings&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public partial class 命令参数 : Window</span><br><span class="line">    &#123;</span><br><span class="line">        public 命令参数()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void New_CanExecute(object sender, CanExecuteRoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            if (string.IsNullOrEmpty(this.nameTextBox.Text))</span><br><span class="line">            &#123;</span><br><span class="line">                e.CanExecute = false;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">                e.CanExecute = true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void New_Executed(object sender, ExecutedRoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            string name = this.nameTextBox.Text;</span><br><span class="line">            if (e.Parameter.ToString() == &quot;Teacher&quot;)</span><br><span class="line">                this.listBoxNewItems.Items.Add(string.Format(&quot;New Teacher:&#123;0&#125;, 学而不厌。&quot;, name));</span><br><span class="line">            if (e.Parameter.ToString() == &quot;Student&quot;)</span><br><span class="line">                this.listBoxNewItems.Items.Add(string.Format(&quot;New Student:&#123;0&#125;, 好好学习。&quot;, name));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-1-6-命令与Binding的结合"><a href="#9-1-6-命令与Binding的结合" class="headerlink" title="9.1.6 命令与Binding的结合"></a>9.1.6 命令与Binding的结合</h3><p>？？？</p>
<h2 id="9-2-近观命令"><a href="#9-2-近观命令" class="headerlink" title="9.2 近观命令"></a>9.2 近观命令</h2><h3 id="9-2-1-ICommand接口和RoutedCommand"><a href="#9-2-1-ICommand接口和RoutedCommand" class="headerlink" title="9.2.1 ICommand接口和RoutedCommand"></a>9.2.1 ICommand接口和RoutedCommand</h3><p>ICommand Interface：包含两个方法和一个事件</p>
<ul>
<li>Execute方法</li>
<li>CanExecute方法</li>
<li>CanExecuteChanged事件</li>
</ul>
<p>RoutedCommand类与命令相关的源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class RoutedCommand : ICommand</span><br><span class="line">&#123;</span><br><span class="line">    //由ICommand继承而来，仅供内部使用</span><br><span class="line">    private void ICommand.Execute(object parameter)</span><br><span class="line">    &#123;</span><br><span class="line">        Execute(parameter, FilterInputElement(Keyboard.FocusedElement));</span><br><span class="line">    &#125;</span><br><span class="line">    //新定义的方法，可由外部调用</span><br><span class="line">    public void Execute(object parameter, IInputelement target)</span><br><span class="line">    &#123;</span><br><span class="line">        //命令目标为空，选定当前具有焦点的控件作为目标</span><br><span class="line">        if (target == null)</span><br><span class="line">        &#123;</span><br><span class="line">            target = FilterInputElement(Keyboard.FocusedElement);</span><br><span class="line">        &#125;</span><br><span class="line">        //真正执行命令的逻辑</span><br><span class="line">        ExcuteImpl(parameter, target, false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private bool ExecuteImpl(object parameter, IInputElement target, bool userInitiated)</span><br><span class="line">    &#123;</span><br><span class="line">        UIElement targetUIElement = target as UIElement;</span><br><span class="line">		ExecutedRoutedEventArgs args = new ExecutedRoutedEventArgs(this,parameter);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>skip。。。。</p>
<p>ButtonBase的OnClick方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class BattonBase:ContentControl,ICommandSource</span><br><span class="line">&#123;</span><br><span class="line">	//激发Click路由事件，然后发送命令</span><br><span class="line">	protected virtual void OnClick()</span><br><span class="line">	&#123;</span><br><span class="line">		RoutedEventArgs newEvent = new RoutedEventArgs(ButtonBase.ClickEvent,this);</span><br><span class="line">		RaiseEvent(newEvent);</span><br><span class="line">		//调用内部类CommandHelpers的ExecuteCommandSource方法</span><br><span class="line">		MS.Internal.Commands.CommandHelpers.ExecuteCommandSource(this);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这节每看懂</p>
<h3 id="9-2-2-自定义Command"><a href="#9-2-2-自定义Command" class="headerlink" title="9.2.2 自定义Command"></a>9.2.2 自定义Command</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel&gt;</span><br><span class="line">        &lt;local:MyCommandSource  x:Name=&quot;ctrlClear&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">            &lt;TextBlock Text=&quot;Clear&quot; FontSize=&quot;16&quot; TextAlignment=&quot;Center&quot; Background=&quot;LightGreen&quot; Width=&quot;80&quot;/&gt;</span><br><span class="line">        &lt;/local:MyCommandSource&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;local:MiniView x:Name=&quot;miniView&quot;/&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">namespace CommandHer</span><br><span class="line">&#123;</span><br><span class="line">    using System;</span><br><span class="line">    using System.Windows;</span><br><span class="line">    using System.Windows.Controls;</span><br><span class="line">    using System.Windows.Input;</span><br><span class="line"></span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// CustomHerCommand.xaml 的交互逻辑</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    public partial class CustomHerCommand : Window</span><br><span class="line">    &#123;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// Initializes a new instance of the &lt;see cref=&quot;CustomHerCommand&quot;/&gt; class.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public CustomHerCommand()</span><br><span class="line">        &#123;</span><br><span class="line">            this.InitializeComponent();</span><br><span class="line">            ClearCommand clearCmd = new ClearCommand();</span><br><span class="line">            this.ctrlClear.Command = clearCmd;</span><br><span class="line">            this.ctrlClear.CommandTarget = this.miniView;</span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class MyCommandSource : UserControl, ICommandSource</span><br><span class="line">    &#123;</span><br><span class="line">        public ICommand Command &#123; get; set; &#125;</span><br><span class="line">        public object CommandParameter &#123; get; set; &#125;</span><br><span class="line">        public IInputElement CommandTarget &#123; get; set; &#125;</span><br><span class="line">        protected override void OnMouseLeftButtonDown(MouseButtonEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">            base.OnMouseLeftButtonDown(e);</span><br><span class="line">            if (this.CommandTarget != null)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;LeftButtonDown______________&quot;);</span><br><span class="line">                this.Command.Execute(this.CommandTarget);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// The clear command.Custom command</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    public class ClearCommand : ICommand</span><br><span class="line">    &#123;</span><br><span class="line">        // 当命令可执行状态发生改变时，应当被激发</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// The can execute changed.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public event EventHandler CanExecuteChanged;</span><br><span class="line"></span><br><span class="line">        // 用于判断命令是否可以执行</span><br><span class="line">        public bool CanExecute(object parameter)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new NotImplementedException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 命令执行，带有与业务相关的Clear逻辑</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// The execute.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;parameter&quot;&gt;</span><br><span class="line">        /// The parameter.</span><br><span class="line">        /// &lt;/param&gt;</span><br><span class="line">        public void Execute(object parameter)</span><br><span class="line">        &#123;</span><br><span class="line">            IView view = parameter as IView;</span><br><span class="line">            Console.WriteLine(&quot;222&quot;);</span><br><span class="line">            if (view != null)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;333&quot;);</span><br><span class="line">                view.Clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public interface IView</span><br><span class="line">        &#123;</span><br><span class="line">            bool IsChanged &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">            void SetBinding();</span><br><span class="line"></span><br><span class="line">            void Refresh();</span><br><span class="line"></span><br><span class="line">            void Clear();</span><br><span class="line"></span><br><span class="line">            void Save();</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义的组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Border CornerRadius=&quot;5&quot; BorderBrush=&quot;LawnGreen&quot; BorderThickness=&quot;2&quot;&gt;</span><br><span class="line">       &lt;StackPanel&gt;</span><br><span class="line">           &lt;TextBox x:Name=&quot;textBox1&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">           &lt;TextBox x:Name=&quot;textBox2&quot; Margin=&quot;5,0&quot;/&gt;</span><br><span class="line">           &lt;TextBox x:Name=&quot;textBox3&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">           &lt;TextBox x:Name=&quot;textBox4&quot; Margin=&quot;5,0&quot;/&gt;</span><br><span class="line">       &lt;/StackPanel&gt;</span><br><span class="line">   &lt;/Border&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// --------------------------------------------------------------------------------------------------------------------</span><br><span class="line">// &lt;copyright file=&quot;MiniView.xaml.cs&quot; company=&quot;Neuracle&quot;&gt;</span><br><span class="line">//   sdf</span><br><span class="line">// &lt;/copyright&gt;</span><br><span class="line">// &lt;summary&gt;</span><br><span class="line">//   MiniView.xaml 的交互逻辑</span><br><span class="line">// &lt;/summary&gt;</span><br><span class="line">// --------------------------------------------------------------------------------------------------------------------</span><br><span class="line">namespace CommandHer</span><br><span class="line">&#123;</span><br><span class="line">    using System.Windows.Controls;</span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// MiniView.xaml 的交互逻辑</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    public partial class MiniView : UserControl,ClearCommand.IView</span><br><span class="line">    &#123;</span><br><span class="line">        public MiniView()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line">        public bool IsChanged &#123; get; set; &#125;</span><br><span class="line">        public void SetBinding() &#123; &#125;</span><br><span class="line">        public void Refresh() &#123; &#125;</span><br><span class="line">        public void Save() &#123; &#125;</span><br><span class="line">        public void Clear()</span><br><span class="line">        &#123;</span><br><span class="line">            this.textBox1.Clear();</span><br><span class="line">            this.textBox2.Clear();</span><br><span class="line">            this.textBox3.Clear();</span><br><span class="line">            this.textBox4.Clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h1><h2 id="10-1-对象级资源的定义与查找"><a href="#10-1-对象级资源的定义与查找" class="headerlink" title="10.1 对象级资源的定义与查找"></a>10.1 对象级资源的定义与查找</h2><p>最简单的Resource</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;ResourceDictionary&gt;</span><br><span class="line">            &lt;sys:String x:Key=&quot;str&quot;&gt;</span><br><span class="line">                Passion is Lip</span><br><span class="line">            &lt;/sys:String&gt;</span><br><span class="line">            &lt;sys:Double x:Key=&quot;dbl&quot;&gt;3.1415926&lt;/sys:Double&gt;</span><br><span class="line">        &lt;/ResourceDictionary&gt;</span><br><span class="line">    &lt;/Window.Resources&gt;</span><br><span class="line">    &lt;Grid&gt;</span><br><span class="line">        &lt;StackPanel Background=&quot;AntiqueWhite&quot;&gt;</span><br><span class="line">            &lt;TextBlock Text=&quot;&#123;StaticResource str&#125;&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>简写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;sys:String x:Key=&quot;str&quot;&gt;</span><br><span class="line">            Passion is LIp</span><br><span class="line">        &lt;/sys:String&gt;</span><br><span class="line">    &lt;/Window.Resources&gt;</span><br><span class="line">    &lt;Grid&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;&#123;StaticResource str&#125;&quot; Margin=&quot;5&quot;/&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>
<p>在检索资源时，先查找控件自己的Resources属性，如果没有会沿着逻辑树向上一直查找到最顶层容器，如果连最顶层容器都没有这个资源，程序就会去查找Application.Resources 程序的顶级资源。</p>
<p>代码中查找</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private void Window_Loaded(object sender,RoutedEventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    string text=(string)this.FindResource(&quot;str&quot;);</span><br><span class="line">    this.textBlock1.Text=text;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private void Window_L(object sender,RoutedEventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    string text =(string)this.Resources[&quot;str&quot;];</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-2-Static-Dynamic-Resources"><a href="#10-2-Static-Dynamic-Resources" class="headerlink" title="10.2 Static Dynamic Resources"></a>10.2 Static Dynamic Resources</h2><p>Static：运行时不变用Static</p>
<p>Dynamic：运行时改变用Dynamic</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">        &lt;TextBlock x:Key=&quot;res1&quot; Text=&quot;Psmyfish&quot;/&gt;</span><br><span class="line">        &lt;TextBlock x:Key=&quot;res2&quot; Text=&quot;Psmyfish&quot;/&gt;</span><br><span class="line">    &lt;/Window.Resources&gt;</span><br><span class="line">    &lt;StackPanel&gt;</span><br><span class="line">        &lt;Button Margin=&quot;5,5,5,0&quot; Content=&quot;&#123;StaticResource res1&#125;&quot;/&gt;</span><br><span class="line">        &lt;Button Margin=&quot;5,5,5,0&quot; Content=&quot;&#123;DynamicResource res2&#125;&quot;/&gt;</span><br><span class="line">        &lt;Button Margin=&quot;5,5,5,0&quot; Content=&quot;Update&quot; Click=&quot;Button_Click&quot;/&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private void Button_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            this.Resources[&quot;res1&quot;] = new TextBlock() &#123; Text = &quot;LoveLoda&quot; &#125;;</span><br><span class="line">            this.Resources[&quot;res2&quot;] = new TextBlock() &#123; Text = &quot;LoveLoda&quot; &#125;;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>##10.3 向程序添加二进制资源</p>
<p>资源词典里的资源:WPF资源  对象资源</p>
<p>程序内嵌资源:程序集资源  二进制资源</p>
<p>下面是添加Properties中的Resources.resx资源文件的，这个是方便本地化。记得把它的Access Modifier改成public</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window x:Class=&quot;ResourceHer.resx&quot;</span><br><span class="line">        xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:prop=&quot;clr-namespace:ResourceHer.Properties&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        xmlns:local=&quot;clr-namespace:ResourceHer&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot;</span><br><span class="line">        Title=&quot;resx&quot; Width=&quot;240&quot; Height=&quot;120&quot;&gt;</span><br><span class="line">    &lt;Grid Margin=&quot;5&quot;&gt;</span><br><span class="line">        &lt;Grid.ColumnDefinitions&gt;</span><br><span class="line">            &lt;ColumnDefinition Width=&quot;Auto&quot;/&gt;</span><br><span class="line">            &lt;ColumnDefinition Width=&quot;4&quot;/&gt;</span><br><span class="line">            &lt;ColumnDefinition Width=&quot;*&quot;/&gt;</span><br><span class="line">        &lt;/Grid.ColumnDefinitions&gt;</span><br><span class="line">        &lt;Grid.RowDefinitions&gt;</span><br><span class="line">            &lt;RowDefinition Height=&quot;23&quot;/&gt;</span><br><span class="line">            &lt;RowDefinition Height=&quot;4&quot;/&gt;</span><br><span class="line">            &lt;RowDefinition Height=&quot;23&quot;/&gt;</span><br><span class="line">        &lt;/Grid.RowDefinitions&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;&#123;x:Static prop:Resources.UserName&#125;&quot;/&gt;</span><br><span class="line">        &lt;TextBlock x:Name=&quot;textBlockPassword&quot; Grid.Row=&quot;2&quot;/&gt;</span><br><span class="line">        &lt;TextBox BorderBrush=&quot;Black&quot; Grid.Column=&quot;2&quot;/&gt;</span><br><span class="line">        &lt;TextBox BorderBrush=&quot;Red&quot; Grid.Column=&quot;2&quot; Grid.Row=&quot;2&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public resx()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            this.textBlockPassword.Text = Properties.Resources.Password;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>加其他资源记得改BuildAction属性为Resource</p>
<h2 id="10-4-使用Pack-URI路径访问二进制资源"><a href="#10-4-使用Pack-URI路径访问二进制资源" class="headerlink" title="10.4 使用Pack URI路径访问二进制资源"></a>10.4 使用Pack URI路径访问二进制资源</h2><p>格式</p>
<p><code>pack://application,,,[/程序集名称;][可选版本号;][文件夹名称/]文件名称</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Image x:Name=&quot;ImageBg&quot; Source=&quot;Resources/Images/Rafale.jpg&quot; Stretch=&quot;Fill&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Image x:Name=&quot;ImageBg&quot; </span><br><span class="line">       Source=&quot;pack://application:,,,/Resources/Images/Rafale.jpg&quot;</span><br><span class="line">       Stretch=&quot;Fill&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight c"><figcaption><span>#</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">InitializeComponent();</span><br><span class="line">Uri imgUri=<span class="keyword">new</span> Uri(@<span class="string">"Resources/Images/Rafale.jpg"</span>,UriKind.Relative);</span><br><span class="line"><span class="keyword">this</span>.ImageBg.Source=<span class="keyword">new</span> BitmapImage(imgUri);</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Uri imgUri= new Uri</span><br><span class="line">(@&quot;pack://application:,,,/Resources/Images/Rafale.jpg&quot;,UriKind.Absolute);</span><br></pre></td></tr></table></figure>
<h1 id="11-Template"><a href="#11-Template" class="headerlink" title="11 Template"></a>11 Template</h1><p>强</p>
<h2 id="11-1-模板的内涵"><a href="#11-1-模板的内涵" class="headerlink" title="11.1 模板的内涵"></a>11.1 模板的内涵</h2><p>引入模板，微软将数据和算法的“内容”与“形式”解耦了。</p>
<p>Template：</p>
<ul>
<li>ControlTemplate</li>
<li>DataTemplate</li>
</ul>
<h2 id="11-2-数据的外衣-DataTemplate"><a href="#11-2-数据的外衣-DataTemplate" class="headerlink" title="11.2 数据的外衣 DataTemplate"></a>11.2 数据的外衣 DataTemplate</h2><p>DataTemplate:常用于</p>
<ul>
<li>ContentContro的ContentTemplate属性，给其内容穿衣服</li>
<li>ItemsControls的ItemTemplate属性，给ItemsControl的数据条目穿衣服</li>
<li>GridViewColumn的CellTemplate属性，给单元格里的数据穿衣服</li>
</ul>
<p>类定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">// --------------------------------------------------------------------------------------------------------------------</span><br><span class="line">// &lt;copyright file=&quot;Car.cs&quot; company=&quot;ss&quot;&gt;</span><br><span class="line">//   ss</span><br><span class="line">// &lt;/copyright&gt;</span><br><span class="line">// &lt;summary&gt;</span><br><span class="line">//   Defines the Car type.</span><br><span class="line">// &lt;/summary&gt;</span><br><span class="line">// --------------------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">namespace TemplateHer</span><br><span class="line">&#123;</span><br><span class="line">    using System;</span><br><span class="line">    using System.Globalization;</span><br><span class="line">    using System.Windows.Data;</span><br><span class="line">    using System.Windows.Media.Imaging;</span><br><span class="line"></span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// The car.</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    public class Car</span><br><span class="line">    &#123;</span><br><span class="line">        public string Automaker &#123; get; set; &#125;</span><br><span class="line">        public string Name &#123; get; set; &#125;</span><br><span class="line">        public string Year &#123; get; set; &#125;</span><br><span class="line">        public string TopSpeed &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class AutomakerToLogoPathConverter : IValueConverter</span><br><span class="line">    &#123;</span><br><span class="line">        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            string uriStr = string.Format(@&quot;/Resources/&#123;0&#125;.png&quot;, (string)value);</span><br><span class="line">            return new BitmapImage(new Uri(uriStr, UriKind.Relative));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new NotImplementedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class NameToPhotoPathConverter : IValueConverter</span><br><span class="line">    &#123;</span><br><span class="line">        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            string uriStr = string.Format(@&quot;/Resources/&#123;0&#125;.jpg&quot;, (string)value);</span><br><span class="line">            return new BitmapImage(new Uri(uriStr, UriKind.Relative));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new NotImplementedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">       &lt;local:AutomakerToLogoPathConverter x:Key=&quot;a2l&quot;/&gt;</span><br><span class="line">       &lt;local:NameToPhotoPathConverter x:Key=&quot;n2p&quot;/&gt;</span><br><span class="line">       &lt;DataTemplate x:Key=&quot;carDetailViewTemplate&quot;&gt;</span><br><span class="line">           &lt;Border BorderBrush=&quot;Black&quot; BorderThickness=&quot;1&quot; CornerRadius=&quot;6&quot;&gt;</span><br><span class="line">               &lt;StackPanel Margin=&quot;5&quot;&gt;</span><br><span class="line">                   &lt;Image Width=&quot;400&quot; Height=&quot;250&quot;</span><br><span class="line">                          Source=&quot;&#123;Binding Name,Converter=&#123;StaticResource n2p&#125;&#125;&quot;/&gt;</span><br><span class="line">                   &lt;StackPanel Orientation=&quot;Horizontal&quot; Margin=&quot;5,0&quot;&gt;</span><br><span class="line">                       &lt;TextBlock Text=&quot;Name:&quot; FontWeight=&quot;Bold&quot; FontSize=&quot;20&quot;/&gt;</span><br><span class="line">                       &lt;TextBlock Text=&quot;&#123;Binding Name&#125;&quot; FontSize=&quot;20&quot; Margin=&quot;5,0&quot;/&gt;</span><br><span class="line">                   &lt;/StackPanel&gt;</span><br><span class="line">                   &lt;StackPanel Orientation=&quot;Horizontal&quot; Margin=&quot;5,0&quot;&gt;</span><br><span class="line">                       &lt;TextBlock Text=&quot;Automaker:&quot; FontWeight=&quot;Bold&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                       &lt;TextBlock Text=&quot;Year:&quot; FontWeight=&quot;Bold&quot;/&gt;</span><br><span class="line">                       &lt;TextBlock Text=&quot;&#123;Binding Year&#125;&quot; Margin=&quot;5,0&quot;/&gt;</span><br><span class="line">                       &lt;TextBlock Text=&quot;TopSpeed:&quot; FontWeight=&quot;Bold&quot;/&gt;</span><br><span class="line">                       &lt;TextBlock Text=&quot;&#123;Binding TopSpeed&#125;&quot; Margin=&quot;5,0&quot;/&gt;</span><br><span class="line">                   &lt;/StackPanel&gt;</span><br><span class="line">               &lt;/StackPanel&gt;</span><br><span class="line">           &lt;/Border&gt;</span><br><span class="line">       &lt;/DataTemplate&gt;</span><br><span class="line"></span><br><span class="line">       &lt;DataTemplate x:Key=&quot;carListItemViewTemplate&quot;&gt;</span><br><span class="line">           &lt;Grid Margin=&quot;2&quot;&gt;</span><br><span class="line">               &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                   &lt;Image Source=&quot;&#123;Binding Automaker,Converter=&#123;StaticResource a2l&#125;&#125;&quot;</span><br><span class="line">                          Grid.RowSpan=&quot;3&quot; Width=&quot;64&quot; Height=&quot;64&quot;/&gt;</span><br><span class="line">                   &lt;StackPanel Margin=&quot;5,10&quot;&gt;</span><br><span class="line">                       &lt;TextBlock Text=&quot;&#123;Binding Name&#125;&quot; FontSize=&quot;16&quot; FontWeight=&quot;Bold&quot;/&gt;</span><br><span class="line">                       &lt;TextBlock Text=&quot;&#123;Binding Year&#125;&quot; FontSize=&quot;14&quot;/&gt;</span><br><span class="line">                   &lt;/StackPanel&gt;</span><br><span class="line">               &lt;/StackPanel&gt;</span><br><span class="line">           &lt;/Grid&gt;</span><br><span class="line">       &lt;/DataTemplate&gt;</span><br><span class="line">   &lt;/Window.Resources&gt;</span><br><span class="line">   &lt;StackPanel Orientation=&quot;Horizontal&quot; Margin=&quot;5&quot;&gt;</span><br><span class="line">       &lt;UserControl ContentTemplate=&quot;&#123;StaticResource carDetailViewTemplate&#125;&quot;</span><br><span class="line">                    Content=&quot;&#123;Binding SelectedItem,ElementName=listBoxCars&#125;&quot;/&gt;</span><br><span class="line">       &lt;ListBox x:Name=&quot;listBoxCars&quot; Width=&quot;180&quot; Margin=&quot;5,0&quot;</span><br><span class="line">                ItemTemplate=&quot;&#123;StaticResource carListItemViewTemplate&#125;&quot;/&gt;</span><br><span class="line">   &lt;/StackPanel&gt;</span><br></pre></td></tr></table></figure>
<p>后台</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public CarHerDataSource()</span><br><span class="line">        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            InitialCarList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void InitialCarList()</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Car&gt; carList = new List&lt;Car&gt;()</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        new Car()&#123;Automaker=&quot;纸片人老婆&quot;,Name=&quot;刀女人&quot;,Year=&quot;1990&quot;,TopSpeed=&quot;320&quot;&#125;,</span><br><span class="line">                                        new Car()&#123;Automaker=&quot;纸片人老婆&quot;,Name=&quot;困女子&quot;,Year=&quot;2990&quot;,TopSpeed=&quot;350&quot;&#125;,</span><br><span class="line">                                        new Car()&#123;Automaker=&quot;纸片人老婆&quot;,Name=&quot;妹女儿&quot;,Year=&quot;2000&quot;,TopSpeed=&quot;325&quot;&#125;,</span><br><span class="line">                                        new Car()&#123;Automaker=&quot;纸片人老婆&quot;,Name=&quot;音女郎&quot;,Year=&quot;2010&quot;,TopSpeed=&quot;356&quot;&#125;,</span><br><span class="line">                                    &#125;;</span><br><span class="line">            this.listBoxCars.ItemsSource = carList;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="11-3-控件的外衣-ControlTemplate"><a href="#11-3-控件的外衣-ControlTemplate" class="headerlink" title="11.3 控件的外衣 ControlTemplate"></a>11.3 控件的外衣 ControlTemplate</h2><p>披着羊皮的🐺</p>
<blockquote>
<p>Note</p>
<p>两大勇武之地：</p>
<ul>
<li>提升用户体验</li>
<li>ControlTemplate，程序员与设计师可以并行工作</li>
</ul>
</blockquote>
<h3 id="11-3-1-庖丁解控件"><a href="#11-3-1-庖丁解控件" class="headerlink" title="11.3.1 庖丁解控件"></a>11.3.1 庖丁解控件</h3><p>用了下Blend解开TextBox，很好玩</p>
<h3 id="11-3-2-ItemsControl的PanelTemplate"><a href="#11-3-2-ItemsControl的PanelTemplate" class="headerlink" title="11.3.2 ItemsControl的PanelTemplate"></a>11.3.2 ItemsControl的PanelTemplate</h3><p>### </p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/22/WPF-Control-Templates/" rel="next" title="WPF-Control Templates">
                <i class="fa fa-chevron-left"></i> WPF-Control Templates
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/06/29/WPF-Web-Review/" rel="prev" title="WPF-Web-Review">
                WPF-Web-Review <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Psmyfish</p>
              <p class="site-description motion-element" itemprop="description">Some fish in the rain,some fish in the sun.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#TypeConverter"><span class="nav-number">1.</span> <span class="nav-text">TypeConverter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#属性标签"><span class="nav-number">2.</span> <span class="nav-text">属性标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#标签扩展"><span class="nav-number">3.</span> <span class="nav-text">标签扩展</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事件处理器与代码后置"><span class="nav-number">4.</span> <span class="nav-text">事件处理器与代码后置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#导入程序集和引用其中的命名空间"><span class="nav-number">5.</span> <span class="nav-text">导入程序集和引用其中的命名空间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XAML的注释"><span class="nav-number">6.</span> <span class="nav-text">XAML的注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#名称空间的由来和作用"><span class="nav-number">7.</span> <span class="nav-text">名称空间的由来和作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x名称空间里都有什么"><span class="nav-number">8.</span> <span class="nav-text">x名称空间里都有什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x-Class"><span class="nav-number">9.</span> <span class="nav-text">x:Class</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x-ClassModifier"><span class="nav-number">10.</span> <span class="nav-text">x:ClassModifier</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x-Name"><span class="nav-number">11.</span> <span class="nav-text">x:Name</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x-FieldModifier"><span class="nav-number">12.</span> <span class="nav-text">x:FieldModifier</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#控件与布局"><span class="nav-number"></span> <span class="nav-text">控件与布局</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Binding"><span class="nav-number"></span> <span class="nav-text">Binding</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-Binding在WPF中的地位"><span class="nav-number">1.</span> <span class="nav-text">Data Binding在WPF中的地位</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#控制Binding的方向及数据更新"><span class="nav-number">1.1.</span> <span class="nav-text">控制Binding的方向及数据更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#没有Path的binding"><span class="nav-number">1.2.</span> <span class="nav-text">没有Path的binding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为Binding指定源-Source-的几种方法"><span class="nav-number">1.3.</span> <span class="nav-text">为Binding指定源(Source)的几种方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#没有Source的Binding-使用DataContext作为Binding源"><span class="nav-number">1.4.</span> <span class="nav-text">没有Source的Binding__使用DataContext作为Binding源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用集合对象作为列表控件的ItemsSource"><span class="nav-number">1.5.</span> <span class="nav-text">使用集合对象作为列表控件的ItemsSource</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用ADO-NET对象作为Binding源"><span class="nav-number">1.6.</span> <span class="nav-text">使用ADO.NET对象作为Binding源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用XML数据作为Binding的源"><span class="nav-number">1.7.</span> <span class="nav-text">使用XML数据作为Binding的源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用LINQ检索结果作为Binding的源"><span class="nav-number">1.8.</span> <span class="nav-text">使用LINQ检索结果作为Binding的源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用ObjectDataProvider对象作为Source"><span class="nav-number">1.9.</span> <span class="nav-text">使用ObjectDataProvider对象作为Source</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-12-使用Binding的RelativeSource"><span class="nav-number">1.10.</span> <span class="nav-text">6.3.12 使用Binding的RelativeSource</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Binding对数据的转换与校验"><span class="nav-number">2.</span> <span class="nav-text">Binding对数据的转换与校验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding的数据校验"><span class="nav-number">2.1.</span> <span class="nav-text">Binding的数据校验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binding的数据转换"><span class="nav-number">2.2.</span> <span class="nav-text">Binding的数据转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MultiBinding"><span class="nav-number">3.</span> <span class="nav-text">MultiBinding</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Attributes-讲属性"><span class="nav-number"></span> <span class="nav-text">Attributes 讲属性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-属性的来龙去脉"><span class="nav-number">1.</span> <span class="nav-text">7.1 属性的来龙去脉</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖属性"><span class="nav-number">2.</span> <span class="nav-text">依赖属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-1-依赖属性对内存的使用方式"><span class="nav-number">2.1.</span> <span class="nav-text">7.2.1 依赖属性对内存的使用方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-附加属性"><span class="nav-number">3.</span> <span class="nav-text">7.3 附加属性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#说事件"><span class="nav-number"></span> <span class="nav-text">说事件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#近观树形结构"><span class="nav-number">1.</span> <span class="nav-text">近观树形结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事件的来龙去脉"><span class="nav-number">2.</span> <span class="nav-text">事件的来龙去脉</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由事件Routed-Event"><span class="nav-number">3.</span> <span class="nav-text">路由事件Routed Event</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-1-内置路由事件"><span class="nav-number">3.1.</span> <span class="nav-text">8.3.1 内置路由事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-2-自定义Routed-Event"><span class="nav-number">3.2.</span> <span class="nav-text">8.3.2 自定义Routed Event</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-3-RoutedEventArgs的Source与OriginalSource"><span class="nav-number">3.3.</span> <span class="nav-text">8.3.3 RoutedEventArgs的Source与OriginalSource</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-4-附加事件Attached-Event"><span class="nav-number">3.4.</span> <span class="nav-text">8.3.4 附加事件Attached Event</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#命令-Command"><span class="nav-number"></span> <span class="nav-text">命令 Command</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-命令系统的基本元素与关系"><span class="nav-number">1.</span> <span class="nav-text">9.1 命令系统的基本元素与关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-1-命令系统的基本元素"><span class="nav-number">1.1.</span> <span class="nav-text">9.1.1 命令系统的基本元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-2-基本元素之间的关系"><span class="nav-number">1.2.</span> <span class="nav-text">9.1.2 基本元素之间的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-3-小试命令"><span class="nav-number">1.3.</span> <span class="nav-text">9.1.3 小试命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-4-WPF-命令库"><span class="nav-number">1.4.</span> <span class="nav-text">9.1.4 WPF 命令库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-5-命令参数"><span class="nav-number">1.5.</span> <span class="nav-text">9.1.5 命令参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-6-命令与Binding的结合"><span class="nav-number">1.6.</span> <span class="nav-text">9.1.6 命令与Binding的结合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-近观命令"><span class="nav-number">2.</span> <span class="nav-text">9.2 近观命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-1-ICommand接口和RoutedCommand"><span class="nav-number">2.1.</span> <span class="nav-text">9.2.1 ICommand接口和RoutedCommand</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-2-自定义Command"><span class="nav-number">2.2.</span> <span class="nav-text">9.2.2 自定义Command</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Resources"><span class="nav-number"></span> <span class="nav-text">Resources</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-对象级资源的定义与查找"><span class="nav-number">1.</span> <span class="nav-text">10.1 对象级资源的定义与查找</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-Static-Dynamic-Resources"><span class="nav-number">2.</span> <span class="nav-text">10.2 Static Dynamic Resources</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-4-使用Pack-URI路径访问二进制资源"><span class="nav-number">3.</span> <span class="nav-text">10.4 使用Pack URI路径访问二进制资源</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-Template"><span class="nav-number"></span> <span class="nav-text">11 Template</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-1-模板的内涵"><span class="nav-number">1.</span> <span class="nav-text">11.1 模板的内涵</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-2-数据的外衣-DataTemplate"><span class="nav-number">2.</span> <span class="nav-text">11.2 数据的外衣 DataTemplate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-3-控件的外衣-ControlTemplate"><span class="nav-number">3.</span> <span class="nav-text">11.3 控件的外衣 ControlTemplate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-1-庖丁解控件"><span class="nav-number">3.1.</span> <span class="nav-text">11.3.1 庖丁解控件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-2-ItemsControl的PanelTemplate"><span class="nav-number">3.2.</span> <span class="nav-text">11.3.2 ItemsControl的PanelTemplate</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Psmyfish</span>

  
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
