<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Fish, PP" />










<meta name="description" content="C# in Depth">
<meta name="keywords" content="Nice body">
<meta property="og:type" content="article">
<meta property="og:title" content="C# in Depth">
<meta property="og:url" content="http://yoursite.com/2018/06/30/C-in-Depth/index.html">
<meta property="og:site_name" content="Psmyfish">
<meta property="og:description" content="C# in Depth">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/images/002.png">
<meta property="og:image" content="http://yoursite.com/images/003.png">
<meta property="og:image" content="c:/Users/Neuracle/Documents/我的坚果云/Learn/Learn%20EveryDay/RawPic/a003.png">
<meta property="og:updated_time" content="2019-01-03T10:13:21.150Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C# in Depth">
<meta name="twitter:description" content="C# in Depth">
<meta name="twitter:image" content="http://yoursite.com/images/002.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/06/30/C-in-Depth/"/>





  <title>C# in Depth | Psmyfish</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
<a href="https://github.com/psmyfish" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Psmyfish</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">what is this fish?</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/30/C-in-Depth/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Psmyfish">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Psmyfish">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">C# in Depth</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-30T14:22:39+08:00">
                2018-06-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C#</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="C-in-Depth"><a href="#C-in-Depth" class="headerlink" title="C# in Depth"></a>C# in Depth</h1><a id="more"></a>
<h2 id="The-changing-face-of-C-development"><a href="#The-changing-face-of-C-development" class="headerlink" title="The changing face of C# development"></a>The changing face of C# development</h2><h3 id="1-1-Starting-with-a-simple-data-type"><a href="#1-1-Starting-with-a-simple-data-type" class="headerlink" title="1.1 Starting with a simple data type"></a>1.1 Starting with a simple data type</h3><h4 id="1-1-1-The-Product-type-in-C-1"><a href="#1-1-1-The-Product-type-in-C-1" class="headerlink" title="1.1.1 The Product type in C#1"></a>1.1.1 The Product type in C#1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.ComponentModel;</span><br><span class="line"></span><br><span class="line">namespace Chapter01.CSharp1</span><br><span class="line">&#123;</span><br><span class="line">    [Description(&quot;Listing 1.01&quot;)]</span><br><span class="line">    public class Product</span><br><span class="line">    &#123;</span><br><span class="line">        string name;</span><br><span class="line">        public string Name</span><br><span class="line">        &#123;</span><br><span class="line">            get &#123; return name; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        decimal price;</span><br><span class="line">        public decimal Price</span><br><span class="line">        &#123;</span><br><span class="line">            get &#123; return price; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Product(string name, decimal price)</span><br><span class="line">        &#123;</span><br><span class="line">            this.name = name;</span><br><span class="line">            this.price = price;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static ArrayList GetSampleProducts()</span><br><span class="line">        &#123;</span><br><span class="line">            ArrayList list = new ArrayList();</span><br><span class="line">            list.Add(new Product(&quot;West Side Story&quot;, 9.99m));</span><br><span class="line">            list.Add(new Product(&quot;Assassins&quot;, 14.99m));</span><br><span class="line">            list.Add(new Product(&quot;Frogs&quot;, 13.99m));</span><br><span class="line">            list.Add(new Product(&quot;Sweeney Todd&quot;, 10.99m));</span><br><span class="line">            return list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public override string ToString()</span><br><span class="line">        &#123;</span><br><span class="line">            return string.Format(&quot;&#123;0&#125;: &#123;1&#125;&quot;, name, price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-1-2-Strongly-typed-collections-in-C-2"><a href="#1-1-2-Strongly-typed-collections-in-C-2" class="headerlink" title="1.1.2 Strongly typed collections in C#2"></a>1.1.2 Strongly typed collections in C#2</h4><p>The most important change in C# 2: generics</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">// --------------------------------------------------------------------------------------------------------------------</span><br><span class="line">// &lt;copyright file=&quot;TheProductType.cs&quot; company=&quot;psmyfish.top&quot;&gt;</span><br><span class="line">//   pp</span><br><span class="line">// &lt;/copyright&gt;</span><br><span class="line">// &lt;summary&gt;</span><br><span class="line">//   Defines the TheProductType type.</span><br><span class="line">// &lt;/summary&gt;</span><br><span class="line">// --------------------------------------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">namespace C01</span><br><span class="line">&#123;</span><br><span class="line">    using System.Collections;</span><br><span class="line">    using System.Collections.Generic;</span><br><span class="line">    using System.ComponentModel;</span><br><span class="line"></span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// The the product type.</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    [Description(&quot;Listing 1.01&quot;)]</span><br><span class="line">    public class Product</span><br><span class="line">    &#123;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// The name.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private string name;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// Gets the name.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public string Name</span><br><span class="line">        &#123;</span><br><span class="line">            get</span><br><span class="line">            &#123;</span><br><span class="line">                return name;</span><br><span class="line">            &#125;</span><br><span class="line">            private set</span><br><span class="line">            &#123;</span><br><span class="line">                name = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// The price.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private decimal price;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// Gets the price.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public decimal Price</span><br><span class="line">        &#123;</span><br><span class="line">            get</span><br><span class="line">            &#123;</span><br><span class="line">                return price;</span><br><span class="line">            &#125;</span><br><span class="line">            private set</span><br><span class="line">            &#123;</span><br><span class="line">                price = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// Initializes a new instance of the &lt;see cref=&quot;Product&quot;/&gt; class.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;name&quot;&gt;</span><br><span class="line">        /// The name.</span><br><span class="line">        /// &lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;price&quot;&gt;</span><br><span class="line">        /// The price.</span><br><span class="line">        /// &lt;/param&gt;</span><br><span class="line">        public Product(string name, decimal price)</span><br><span class="line">        &#123;</span><br><span class="line">            Name = name;</span><br><span class="line">            Price = price;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// The get sample products.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;returns&gt;</span><br><span class="line">        /// The &lt;see cref=&quot;ArrayList&quot;/&gt;.</span><br><span class="line">        /// &lt;/returns&gt;</span><br><span class="line">        public static List&lt;Product&gt; GetSampleProducts()</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Product&gt; list = new List&lt;Product&gt;();             </span><br><span class="line">            list.Add(new Product(&quot;West Side Story&quot;, 9.99m));</span><br><span class="line">            list.Add(new Product(&quot;Assassins&quot;, 14.99m));</span><br><span class="line">            list.Add(new Product(&quot;Frogs&quot;, 13.99m));</span><br><span class="line">            list.Add(new Product(&quot;Sweeney Todd&quot;, 10.99m));</span><br><span class="line">            return list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// The to string.</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;returns&gt;</span><br><span class="line">        /// The &lt;see cref=&quot;string&quot;/&gt;.</span><br><span class="line">        /// &lt;/returns&gt;</span><br><span class="line">        public override string ToString()</span><br><span class="line">        &#123;</span><br><span class="line">            return string.Format(&quot;&#123;0&#125;:&#123;1&#125;&quot;, name, price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-1-3-Automatically-implemented-properties-in-C-3"><a href="#1-1-3-Automatically-implemented-properties-in-C-3" class="headerlink" title="1.1.3 Automatically implemented properties in C#3"></a>1.1.3 Automatically implemented properties in C#3</h4><p>The automatically implemented properties and simplified initialization shown in the following listing are relatively trivial.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">namespace C01</span><br><span class="line">&#123;</span><br><span class="line">    using System.Collections.Generic;</span><br><span class="line"></span><br><span class="line">    class Product</span><br><span class="line">    &#123;</span><br><span class="line">        public string Name &#123; get; private set; &#125;</span><br><span class="line">        public decimal Price &#123; get; private set; &#125;</span><br><span class="line"></span><br><span class="line">        public Product(string name, decimal price)</span><br><span class="line">        &#123;</span><br><span class="line">            Name = name;</span><br><span class="line">            Price = price;</span><br><span class="line">        &#125;</span><br><span class="line">        Product() &#123; &#125;</span><br><span class="line"></span><br><span class="line">        public static List&lt;Product&gt; GetSampleProducts()</span><br><span class="line">        &#123;</span><br><span class="line">            return new List&lt;Product&gt;</span><br><span class="line">                       &#123;</span><br><span class="line">                           new Product &#123; Name = &quot;West&quot;, Price = 9.99m &#125;,</span><br><span class="line">                           new Product &#123; Name = &quot;Assassins&quot;, Price = 14.99m &#125;,</span><br><span class="line">                           new Product &#123; Name = &quot;Frogs&quot;, Price = 13.99m &#125;,</span><br><span class="line">                           new Product &#123; Name = &quot;Sweeney Todd&quot;, Price = 10.99m &#125;</span><br><span class="line">                       &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public override string ToString()</span><br><span class="line">        &#123;</span><br><span class="line">            return string.Format(&quot;&#123;0&#125;,&#123;1&#125;&quot;, Name, Price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-1-4-Name-arguments-in-C-4"><a href="#1-1-4-Name-arguments-in-C-4" class="headerlink" title="1.1.4 Name arguments in C# 4"></a>1.1.4 Name arguments in C# 4</h4><p>This gives you the clarity of C# 3 initializers without  the mutability.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections.Generic;</span><br><span class="line"></span><br><span class="line">    class Product</span><br><span class="line">    &#123;</span><br><span class="line">        readonly string name;</span><br><span class="line">        public string Name &#123; get&#123; return name; &#125; &#125;</span><br><span class="line"></span><br><span class="line">        private readonly decimal price;</span><br><span class="line">        public decimal Price &#123; get&#123; return price; &#125; &#125;</span><br><span class="line"></span><br><span class="line">        public Product(string name, decimal price)</span><br><span class="line">        &#123;</span><br><span class="line">            this.name = name;</span><br><span class="line">            this.price = price;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static List&lt;Product&gt; GetSampleProducts()</span><br><span class="line">        &#123;</span><br><span class="line">            return new List&lt;Product&gt;</span><br><span class="line">                       &#123;</span><br><span class="line">                           new Product(name: &quot;West&quot;, price: 9.99m),</span><br><span class="line">                           new Product(name:&quot;Assassins&quot;, price: 14.99m),</span><br><span class="line">                           new Product(name:&quot;Frogs&quot;, price: 13.99m),</span><br><span class="line">                           new Product(name:&quot;Sweeney Todd&quot;, price: 10.99m)</span><br><span class="line">                       &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public override string ToString()</span><br><span class="line">        &#123;</span><br><span class="line">            return string.Format(&quot;&#123;0&#125;,&#123;1&#125;&quot;, Name, Price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Here is the summarizes.</p>
<p><img src="/images/002.png" alt="001"></p>
<h3 id="1-2-Sorting-and-filtering"><a href="#1-2-Sorting-and-filtering" class="headerlink" title="1.2 Sorting and filtering"></a>1.2 Sorting and filtering</h3><h4 id="1-2-1-Sorting-products-by-name"><a href="#1-2-1-Sorting-products-by-name" class="headerlink" title="1.2.1 Sorting products by name"></a>1.2.1 Sorting products by name</h4><p>if you use this</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">    using System.Collections;</span><br><span class="line">    using System.ComponentModel;</span><br><span class="line"></span><br><span class="line">    [Description(&quot;Listing 1.05&quot;)]</span><br><span class="line">    class ArrayListSort</span><br><span class="line">    &#123;</span><br><span class="line">        class ProductNameComparer : IComparer</span><br><span class="line">        &#123;</span><br><span class="line">            public int Compare(object x, object y)</span><br><span class="line">            &#123;</span><br><span class="line">                Product first = (Product)x;</span><br><span class="line">                Product second = (Product)y;</span><br><span class="line">                return first.Name.CompareTo(second.Name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            ArrayList products = Product.GetSampleProducts();</span><br><span class="line">            products.Sort(new ProductNameComparer());</span><br><span class="line">            foreach (Product product in products)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(product);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Casts are used but you cant ensure that you are right.The <code>(Product)</code> &amp; cw(product) have a chance to go bang.</p>
<p>But if you use Generic as the only change.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[Description(&quot;Listing 1.05&quot;)]</span><br><span class="line">    class ArrayListSort</span><br><span class="line">    &#123;</span><br><span class="line">        class ProductNameComparer : IComparer&lt;Product&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            public int Compare(Product x,Product y)</span><br><span class="line">            &#123;</span><br><span class="line">                return x.Name.CompareTo(y.Name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">            products.Sort(new ProductNameComparer());</span><br><span class="line">            foreach (Product product in products)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(product);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>The following listing shows how to do precisely this,telling the Sort method how to compare two products using a delegate.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class ArrayListSort</span><br><span class="line">    &#123;</span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">            products.Sort(delegate(Product x, Product y) </span><br><span class="line">            &#123; return x.Name.CompareTo(y.Name); &#125;);</span><br><span class="line">            foreach (Product product in products)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(product);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Behold the lack  of  the ProductNameComparer type.</p>
<blockquote>
<p>Listing 1.8 Sorting using Comparison<product> from a lambda expression</product></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">products.Sort((x,y)=&gt;x.Name.CompareTo(y.Name));</span><br></pre></td></tr></table></figure>
<p>There is more, though: with C# 3, you can sasily print out the names in order without modifying the original list of products.The next listing shows this using the OrderBy method.</p>
<blockquote>
<p>Listing 1.9 Ordering a List<product> using an extension method(C# 3)</product></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">foreach (Product product in products.OrderBy(p =&gt;p.Name))</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You’re able to call the OrderBy method due to the presence of an extension method.</p>
<p><img src="/images/003.png" alt="003"></p>
<h4 id="1-2-2-Querying-collections"><a href="#1-2-2-Querying-collections" class="headerlink" title="1.2.2 Querying collections"></a>1.2.2 Querying collections</h4><p>Your next task is to find all the elements of the list that match a certain criterion- in particular ,those with a price greater than $10.</p>
<blockquote>
<p>Listing 1.10 Looping,testing,printing out( C# 1)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ArrayList products= Product.GetSampleProducts();</span><br><span class="line">foreach(Product product in products)</span><br><span class="line">&#123;</span><br><span class="line">    if(product.Price&gt;10m)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The following listing demonstrates how C#2 lets you flatten things out a bit.</p>
<blockquote>
<p>Listing 1.11 Separating testing from printing (C# 2)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">            Predicate&lt;Product&gt; test = delegate(Product p) &#123; return p.Price &gt; 10m; &#125;;</span><br><span class="line">            List&lt;Product&gt; matches = products.FindAll(test);</span><br><span class="line">            Action&lt;Product&gt; print = Console.WriteLine;</span><br><span class="line">            matches.ForEach(print);</span><br></pre></td></tr></table></figure>
<p>The print variable initialization uses another new C# 2 feature called <strong>method group conversions </strong>that make it easier to create delegates from existing methods.</p>
<blockquote>
<p>Listing 1.12 Separating testing from printing redux(C# 2)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">            products.FindAll(delegate(Product p) &#123; return p.Price &gt; 10; &#125;).</span><br><span class="line">                ForEach(Console.WriteLine);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Listing 1.13 Testing with a lambda expression(C# 3)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">foreach(Product product in products.Where(p=&gt;p.Price&gt;10))</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-1-Representing-an-unknown-price"><a href="#1-3-1-Representing-an-unknown-price" class="headerlink" title="1.3.1 Representing an unknown price"></a>1.3.1 Representing an unknown price</h4><p>.NET 2.0 makes matters a lot simpler by introducing the Nullable<t> structure, and C# 2 provides some additional syntactic sugar that lets you change the property declaration to this block of code:</t></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">decimal?price;</span><br><span class="line">public decimal?Price</span><br><span class="line">&#123;</span><br><span class="line">	get&#123;return price;&#125;</span><br><span class="line">	private set &#123;price= value;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Listing 1.14 Displaying products with an unknown price(C# 3)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">foreach(Product product in products.Where(p=&gt;p.Price==null))</span><br><span class="line">&#123;</span><br><span class="line">    cw(product.Name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>the C# 2 code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">products.FindAll(delegate(Product p)&#123;return p.Price==null;&#125;).ForEach(Console.WriteLine);</span><br></pre></td></tr></table></figure>
<h4 id="1-3-2-Optional-parameters-and-default-values"><a href="#1-3-2-Optional-parameters-and-default-values" class="headerlink" title="1.3.2 Optional parameters and default values"></a>1.3.2 Optional parameters and default values</h4><p>optional parameters </p>
<p>let’s suppose that most of the products dont have prices. It would be nice to be able to initialize a product like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Product p = new Product(&quot;Unreleased product&quot;);</span><br></pre></td></tr></table></figure>
<p>C#4 allows your to declare a default value for the price parameter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public Product(string name,decimal? price=null)</span><br><span class="line">&#123;</span><br><span class="line">	this.name=name;</span><br><span class="line">	this.price= price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-Introducing-LINQ"><a href="#1-4-Introducing-LINQ" class="headerlink" title="1.4 Introducing LINQ"></a>1.4 Introducing LINQ</h3><h4 id="1-4-1-Query-expressions-and-in-process-queries"><a href="#1-4-1-Query-expressions-and-in-process-queries" class="headerlink" title="1.4.1 Query expressions and in-process queries"></a>1.4.1 Query expressions and in-process queries</h4><blockquote>
<p>Listing 1.15 First steps with query expressions:filtering acollection</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">            var filtered = from Product p in products</span><br><span class="line">                           where p.Price &gt; 10</span><br><span class="line">                           select p;</span><br><span class="line">            foreach (Product product in filtered)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(product);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Listing 1.16</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Product&gt; products = Product.GetSampleProducts();</span><br><span class="line">List&lt;Supplier&gt; suppliers = Supplier.GetSampleSuppliers();</span><br><span class="line">            var filtered = from p in products</span><br><span class="line">                           join s in suppliers</span><br><span class="line">                           on p.SupplierID equals s.SupplierID</span><br><span class="line">                           where p.Price &gt; 10</span><br><span class="line">                           orderby s.Name, p.Name</span><br><span class="line">                           select new &#123; SupplierName = s.Name, ProductName = p.Name &#125;;</span><br><span class="line">            foreach (var v in filtered)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;Supplier=&#123;0&#125;,Product=&#123;1&#125;&quot;, v.SupplierName, v.ProductName);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Listing 1.19</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.Office.Interop.Excel;</span><br><span class="line">var app = new Application &#123; Visible = false &#125;;</span><br><span class="line">            Workbook workbook = app.Workbooks.Add();</span><br><span class="line">            Worksheet worksheet = app.ActiveSheet;</span><br><span class="line">            int row = 1;</span><br><span class="line">            foreach (var product in Product.GetSampleProducts()</span><br><span class="line">                                           .Where(p =&gt; p.Price != null))</span><br><span class="line">            &#123;</span><br><span class="line">                worksheet.Cells[row, 1].Value = product.Name;</span><br><span class="line">                worksheet.Cells[row, 2].Value = product.Price;</span><br><span class="line">                row++;</span><br><span class="line">            &#125;</span><br><span class="line">            workbook.SaveAs(Filename: &quot;demo.xls&quot;,</span><br><span class="line">                            FileFormat: XlFileFormat.xlWorkbookNormal);</span><br><span class="line">            app.Application.Quit();</span><br></pre></td></tr></table></figure>
<h2 id="Core-foundations-building-on-C-1"><a href="#Core-foundations-building-on-C-1" class="headerlink" title="Core foundations:building on C#1"></a>Core foundations:building on C#1</h2><h3 id="2-1-Delegates"><a href="#2-1-Delegates" class="headerlink" title="2.1 Delegates"></a>2.1 Delegates</h3><p>委托不需要直接指定一个要执行的行为，而是将这个行为用某种方式“包含”在一个对象中。。这个对象可以像其他任何对象那样使用。在该对象中，可以执行封装的操作。</p>
<p>可以选择将委托类型看作只定义了一个方法的接口，将委托的实例看做实现了哪一个接口的一个对象。</p>
<h4 id="2-1-1-A-recipe-for-simple-delegates"><a href="#2-1-1-A-recipe-for-simple-delegates" class="headerlink" title="2.1.1 A recipe for simple delegates"></a>2.1.1 A recipe for simple delegates</h4><p>委托成立条件</p>
<ul>
<li>The delegate type needs to be declared.</li>
<li>The code to be executed must be contained in a method</li>
<li>A delegate instance must be created</li>
<li>The delegate instance must be invoked.</li>
</ul>
<p>声明：<code>delegate void StringProcessor(string input)</code></p>
<p>Note：区分委托类型和 委托实例</p>
<p>创建一个StringProcessor实例的两个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">StringProcessor proc1,proc2;</span><br><span class="line">proc1= new StringProcessor(StaticMethods.PrintString);</span><br><span class="line">InstanceMethods instance = new InstanceMethods();</span><br><span class="line">proc2 = new StringProcessor(instance.PrintString);</span><br></pre></td></tr></table></figure>
<p><strong>调用委托实例</strong></p>
<p>void Invoke(string input)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">using System;;</span><br><span class="line">delegate void StringProcessor(string input);</span><br><span class="line">class Person&#123;</span><br><span class="line">	string name;</span><br><span class="line">	public Person(string name)&#123;this.name=name;&#125;</span><br><span class="line">	public void Say(string message)</span><br><span class="line">	&#123;</span><br><span class="line">		Console.WriteLine(&quot;&#123;0&#125; says:&#123;1&#125;&quot;,name,message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Background</span><br><span class="line">&#123;</span><br><span class="line">	public static void Note(string note)</span><br><span class="line">	&#123;</span><br><span class="line">		Console.WriteLine(&quot;(&#123;0&#125;)&quot;,note);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">class SimpleDelegateUse</span><br><span class="line">&#123;</span><br><span class="line">	static void Main()</span><br><span class="line">	&#123;</span><br><span class="line">		Person jon= new Person(&quot;Jon&quot;);</span><br><span class="line">		Person tom = new Person(&quot;Tom&quot;);</span><br><span class="line">		StringProcessor jonsVoice,tomsVoice,backgrond;</span><br><span class="line">		jonsVoice = new StringProcessor(jon.Say);</span><br><span class="line">		tomsVoice = new StringProcessor(tom.Say);</span><br><span class="line">		backgrond = new StringProcessor(Background.Note);</span><br><span class="line">		jonsVoice(&quot;Hello,son.&quot;);</span><br><span class="line">		tomsVoice.Invoke(&quot;Hello,Daddy!&quot;);</span><br><span class="line">		backgrond(&quot;An airplane flied past.&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-2-Combining-and-removing-delegates"><a href="#2-1-2-Combining-and-removing-delegates" class="headerlink" title="2.1.2 Combining and removing delegates"></a>2.1.2 Combining and removing delegates</h4><p>委托实例的调用列表i（invocation list）System.Delegate类型的静态方法Combine 和Remove。</p>
<blockquote>
<p>Note:委托是不易变的 创建了委托实例后，有关它的一切就不能改变。这样一来就可以安全地传递委托实例的引用。委托和string是一样的。Delegate.Combine 和String.Concat很像。如果把null和委托实例合并到一起，null将被视为带有空调用列表的一个委托</p>
</blockquote>
<p>Delegate.Combine很少显式调用，一般用+ 和+=</p>
<p>Invoke 的返回值是最后一个操作的返回值</p>
<p>如果中间有异常，会立刻“传播”</p>
<h4 id="2-1-3-A-brief-diversion-into-events"><a href="#2-1-3-A-brief-diversion-into-events" class="headerlink" title="2.1.3 A brief diversion into events"></a>2.1.3 A brief diversion into events</h4><p>事件不是委托类型的字段。对于一个纯粹的事件，你所能做的就是订阅（add） 和取消订阅(remove).</p>
<h4 id="2-1-4-Summary-of-delegates"><a href="#2-1-4-Summary-of-delegates" class="headerlink" title="2.1.4 Summary of delegates"></a>2.1.4 Summary of delegates</h4><ul>
<li>委托封装了包含特殊返回类型和一组参数的行为，类似包含单一方法的接口</li>
<li>委托类型声明中所描述的类型签名决定了哪个方法可以用于创建委托实例，同时决定了调用的签名</li>
<li>为了创建委托实例，需要一个方法以及（对于实例方法来说）调用方法的目标</li>
<li>委托实例是不易变的</li>
<li>每个委托实例都包含一个调用列表– 一个操作列表</li>
<li>委托实例可以合并到一起，也可以从一个委托实例中删除另一个</li>
<li>事件不是委托实例–只是成对的add/remove方法（类似于属性的取值方法/赋值方法）</li>
</ul>
<h3 id="2-2-Type-system-characteristics"><a href="#2-2-Type-system-characteristics" class="headerlink" title="2.2  Type system characteristics"></a>2.2  Type system characteristics</h3><p>现在被称为的强/弱、安全/不安全、静态/动态语言的特征</p>
<h4 id="2-2-1-C-’s-place-in-the-world-of-type-systems"><a href="#2-2-1-C-’s-place-in-the-world-of-type-systems" class="headerlink" title="2.2.1 C#’s place in the world of type systems"></a>2.2.1 C#’s place in the world of type systems</h4><p> <strong>C# 1’s type system is static ,explicit and safe.</strong></p>
<p>很多书和文章将C#描述成强类型的语言，实际都是指它是一种静态类型的语言</p>
<h5 id="STATIC-TYPING-VERSUS-DYNAMIC-TYPING"><a href="#STATIC-TYPING-VERSUS-DYNAMIC-TYPING" class="headerlink" title="STATIC TYPING VERSUS DYNAMIC TYPING"></a>STATIC TYPING VERSUS DYNAMIC TYPING</h5><p>看这个强制生效的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">object o =&quot;hello&quot;;</span><br><span class="line">Console.WriteLine(o.Length);</span><br><span class="line">object o =&quot;hello&quot;;</span><br><span class="line">Console.WriteLine(((String)o).Length);</span><br></pre></td></tr></table></figure>
<p>可以说o的静态类型为System.Object.</p>
<p>动态类型的实质是变量中含有值，但是那些值并不限于特定的类型，所以编译器不能执行相同形式的检查。</p>
<p>对一个动态语言 可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">o=&quot;hello&quot;;</span><br><span class="line">Console.WriteLine(o.Length);</span><br><span class="line">o= new string[]&#123;&quot;hi&quot;,&quot;there&quot;&#125;;</span><br><span class="line">Console.WriteLine(o.Length);</span><br></pre></td></tr></table></figure>
<h5 id="EXPLICIT-TYPING-VERSUS-IMPLICIT-TYPING"><a href="#EXPLICIT-TYPING-VERSUS-IMPLICIT-TYPING" class="headerlink" title="EXPLICIT TYPING VERSUS IMPLICIT TYPING"></a>EXPLICIT TYPING VERSUS IMPLICIT TYPING</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var s=&quot;hello&quot;</span><br><span class="line">var x=s.Length;</span><br><span class="line">var twiceX=x*2;</span><br></pre></td></tr></table></figure>
<p>这在C#1中是不行的</p>
<h5 id="TYPE-SAFE-VERSUS-TYPE-UNSAFE"><a href="#TYPE-SAFE-VERSUS-TYPE-UNSAFE" class="headerlink" title="TYPE-SAFE VERSUS TYPE-UNSAFE"></a>TYPE-SAFE VERSUS TYPE-UNSAFE</h5><p>C 例子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span>**argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *first_arg= argv[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> *first_arg_as_int =(<span class="keyword">int</span> *)first_arg;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,*first_arg_as_int);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-When-is-C-1’s-type-ststem-not-rich-enough"><a href="#2-2-2-When-is-C-1’s-type-ststem-not-rich-enough" class="headerlink" title="2.2.2 When is C# 1’s type ststem not rich enough?"></a>2.2.2 When is C# 1’s type ststem not rich enough?</h4><p>?:skier:</p>
<ol>
<li>集合，强和弱</li>
<li>缺乏协变的返回类型</li>
</ol>
<h4 id="2-2-3-Summary-of-type-system-characteristics"><a href="#2-2-3-Summary-of-type-system-characteristics" class="headerlink" title="2.2.3 Summary of type system characteristics"></a>2.2.3 Summary of type system characteristics</h4><ul>
<li>C#1 是静态类型的–编译器知道你能使用哪些成员</li>
<li>C#1 是显式的–必须告诉编译器变量具有什么 类型</li>
<li>C#1 是安全的–除非存在真实的转换关系，否则不能将一种类型当作另外一种类型</li>
<li>静态类型仍然不允许一个集合称为强类型的 字符串列表 或者 整数列表  除非针对不同的元素使用大量的重复代码</li>
<li>方法覆盖和接口实现不允许协变性和逆变性</li>
</ul>
<h2 id="2-3-Value-types-and-reference-types"><a href="#2-3-Value-types-and-reference-types" class="headerlink" title="2.3 Value types and reference types"></a>2.3 Value types and reference types</h2><h4 id="2-3-1-Values-and-references-in-the-real-world"><a href="#2-3-1-Values-and-references-in-the-real-world" class="headerlink" title="2.3.1 Values and references in the real world"></a>2.3.1 Values and references in the real world</h4><p>读报纸和读网页，对应的值类型和引用类型的区别</p>
<p>类是引用类型  而结构是值类型</p>
<p>特殊情况：</p>
<ul>
<li>数组类型是引用类型</li>
<li>枚举是值类型</li>
<li>委托类型是引用类型</li>
<li>接口类型是引用类型</li>
</ul>
<h4 id="2-3-2-Value-and-reference-type-fundamentals"><a href="#2-3-2-Value-and-reference-type-fundamentals" class="headerlink" title="2.3.2 Value and reference type fundamentals"></a>2.3.2 Value and reference type fundamentals</h4><p>变量的值在它声明时的位置存储。局部变量的值总是存储在栈中stack。实例变量的值总是存储在实例本身存储的地方。引用类型实例（对象）总是存储在堆中heap，静态变量也是</p>
<h4 id="2-3-3-Dispelling-myths"><a href="#2-3-3-Dispelling-myths" class="headerlink" title="2.3.3 Dispelling myths"></a>2.3.3 Dispelling myths</h4><p>误区1：“结构是轻量级的类”</p>
<h4 id="2-3-4-Boxing-and-unboxing"><a href="#2-3-4-Boxing-and-unboxing" class="headerlink" title="2.3.4 Boxing and unboxing"></a>2.3.4 Boxing and unboxing</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int i=5;</span><br><span class="line">object o =i;</span><br><span class="line">int j =(int)o;</span><br></pre></td></tr></table></figure>
<p>第二句装箱 第三局拆箱</p>
<p>装拆都不会改变原始值</p>
<p>将值作为接口表达式时也会装箱</p>
<p><code>IComparable x=5;</code></p>
<h4 id="2-3-5-值类型和引用类型小结"><a href="#2-3-5-值类型和引用类型小结" class="headerlink" title="2.3.5 值类型和引用类型小结"></a>2.3.5 值类型和引用类型小结</h4><ul>
<li>对于引用类型的表达式，它的值是一个引用，而非对象</li>
<li>引用就像URL-是允许你访问真实信息的一小片数据</li>
<li>对于值类型的表达式，他的值就是实际的数据</li>
<li>有时，值类型比引用类型更有效，有时恰好相反</li>
<li>引用类型的对象总是在堆上，值类型的值既可能在堆上 也可能在栈上</li>
<li>引用类型作为方法参数使用时，参数默认是以值传递 方式来传递的–但值本身是一个引用</li>
<li>值类型的值会在需要引用类型的行为时被装箱；拆箱是相反的过程。</li>
</ul>
<h3 id="2-4-C-1之外-构建于坚实基础之上的新特性"><a href="#2-4-C-1之外-构建于坚实基础之上的新特性" class="headerlink" title="2.4 C#1之外:构建于坚实基础之上的新特性"></a>2.4 C#1之外:构建于坚实基础之上的新特性</h3><h4 id="2-4-1-与委托有关的特性"><a href="#2-4-1-与委托有关的特性" class="headerlink" title="2.4.1 与委托有关的特性"></a>2.4.1 与委托有关的特性</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">static void HandleDemoEvent(object sender,EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    System.Console.WriteLine(&quot;Handled by HandleDemoEvent&quot;);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">EventHandler handler;</span><br><span class="line">handler = new EventHandler(HandleDemoEvent);</span><br><span class="line">handler(null, EventArgs.Empty);</span><br><span class="line"></span><br><span class="line">handler= HandleDemoEvent;</span><br><span class="line">    handler(null, EventArgs.Empty);</span><br><span class="line">handler = delegate(object sender,EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">    Console.WriteLine(&quot;Handled anonymously:&quot;);</span><br><span class="line">&#125;;</span><br><span class="line">handler(null,EventArgs.Empty);</span><br><span class="line">handler=delegate</span><br><span class="line">&#123;</span><br><span class="line">	Console.WriteLine(&quot;handled anonymously again&quot;);</span><br><span class="line">&#125;;</span><br><span class="line">handler(null,EventArgs.Empty);</span><br><span class="line">MouseEventHandler mouseHandler = HandleDemoEvent;</span><br><span class="line">mouseHandler(null,new MouseEventArgs(MouseButtons.None,0,0,0,0));</span><br></pre></td></tr></table></figure>
<p>Lambda表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;int ,int,string &gt; func =(x,y)=&gt;(x*y).ToString();</span><br><span class="line">Console.WriteLine(func(5,20));</span><br></pre></td></tr></table></figure>
<p>###2.4.2 Features related to the type system</p>
<p>匿名类型和隐式类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var jon = new &#123;Name =&quot;Jon&quot;,Age = 31&#125;;</span><br><span class="line">var tom = new &#123;Name =&quot;Tom&quot;,Age =4&#125;;</span><br><span class="line">Console.WriteLine(&quot;&#123;0&#125; is &#123;1&#125;&quot;,jon.Name,jon.Age);</span><br><span class="line">Console.WriteLine(&quot;&#123;0&#125; is &#123;1&#125;&quot;,tom.Name,tom.Age);</span><br></pre></td></tr></table></figure>
<p>C#4中的动态类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dynamic o =&quot;hello&quot;;</span><br><span class="line">Console.WriteLine(o.Length);</span><br><span class="line">o = new String[] &#123;&quot;hi&quot;,&quot;there&quot;&#125;;</span><br><span class="line">Console.WriteLine(o.Length);</span><br></pre></td></tr></table></figure>
<h4 id="2-4-2-Features-related-to-value-types"><a href="#2-4-2-Features-related-to-value-types" class="headerlink" title="2.4.2 Features related to value types"></a>2.4.2 Features related to value types</h4><ul>
<li>泛型</li>
<li>可空类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int? x= null;</span><br><span class="line">x =  5;</span><br><span class="line">if(x!=null)</span><br><span class="line">&#123;</span><br><span class="line">	int y = x.value;</span><br><span class="line">	Console.WriteLine(y);</span><br><span class="line">&#125;</span><br><span class="line">int z = x??10;</span><br></pre></td></tr></table></figure>
<p>###2.5 Summary </p>
<h2 id="3-Parameterized-typing-with-generics"><a href="#3-Parameterized-typing-with-generics" class="headerlink" title="3  Parameterized typing with generics"></a>3  Parameterized typing with generics</h2><h3 id="3-1-why-generics-are-necessary"><a href="#3-1-why-generics-are-necessary" class="headerlink" title="3.1 why generics are necessary"></a>3.1 why generics are necessary</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">static Dictionary&lt;string,int&gt; CountWords(string text)</span><br><span class="line">&#123;</span><br><span class="line">	Dictionary&lt;string,int&gt; frequencies;</span><br><span class="line">	frequencies = new Dictionary&lt;string,int&gt;();</span><br><span class="line">	string[] words = Regex.Split(text,@&quot;\W+&quot;);</span><br><span class="line">	foreach(string word in words)</span><br><span class="line">	&#123;</span><br><span class="line">		if(frequencies.ContainsKey(word))</span><br><span class="line">		&#123;</span><br><span class="line">			frequencies[word]++;</span><br><span class="line">		&#125;</span><br><span class="line">		else</span><br><span class="line">			frequencies[word]=1;</span><br><span class="line">	&#125;</span><br><span class="line">	return frequencies;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">string text = @&quot;Do you like green eggs and ham?</span><br><span class="line">				I do not like them,Sam-I-am.</span><br><span class="line">				I do not like green eggs and ham.&quot;;</span><br><span class="line">Dictionary&lt;string ,int&gt; frequencies= CountWords(text);</span><br><span class="line">foreach(KeyValuePair&lt;string,int&gt; entry in frequencies)</span><br><span class="line">&#123;</span><br><span class="line">	string word = entry.Key;</span><br><span class="line">	int frequency = entry.Value;</span><br><span class="line">	Console.WriteLine (&quot;&#123;0&#125;:&#123;1&#125;&quot;,word,frequency);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-2-Generic-types-and-type-parameters"><a href="#3-2-2-Generic-types-and-type-parameters" class="headerlink" title="3.2.2  Generic types and type parameters"></a>3.2.2  Generic types and type parameters</h4><p>泛型有两种形式: 泛型类型和泛型方法,两者都是表示API的基本方法.</p>
<p>类型参数是真实类型的占位符,真实的类型来替代他们,称为类型实参.</p>
<table>
<thead>
<tr>
<th>泛型类型中的方法签名</th>
<th>类型参数被替换之后的方法签名</th>
</tr>
</thead>
<tbody>
<tr>
<td>void Add(TKey key,TValue value)</td>
<td>void Add(string Key,int value)</td>
</tr>
<tr>
<td>TValue this[TKey key]{get;set;}</td>
<td>int this[string key]{get;set;}</td>
</tr>
<tr>
<td>bool ContainsValue(TValue value)</td>
<td>bool ContainsValue(int value)</td>
</tr>
<tr>
<td>bool ContainsKey(TKey key)</td>
<td>bool ContainsKey(string key)</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h4 id="3-2-3-Generic-methods-and-reading-generic-declarations"><a href="#3-2-3-Generic-methods-and-reading-generic-declarations" class="headerlink" title="3.2.3 Generic methods and reading generic declarations"></a>3.2.3 Generic methods and reading generic declarations</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">static double TakeSquareRoot(int x)</span><br><span class="line">&#123;</span><br><span class="line">	return Math.Sqrt(x);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">List&lt;int&gt; integers = new List&lt;int&gt;();</span><br><span class="line">integers.Add(1);</span><br><span class="line">integers.Add(2);</span><br><span class="line">integers.Add(3);</span><br><span class="line">integers.Add(4);</span><br><span class="line">Converter&lt;int,double&gt; converter = TakeSquareRoot;</span><br><span class="line">List&lt;double&gt; doubles;</span><br><span class="line">doubles = integers.ConvertAll&lt;double&gt;(converter);</span><br><span class="line">foreach(double d in doubles)</span><br><span class="line">&#123;</span><br><span class="line">	Console.WriteLine(d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Listing 3.3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">static List&lt;T&gt; MakeList&lt;T&gt; (T first,T second)</span><br><span class="line">&#123;</span><br><span class="line">	List&lt;T&gt; list = new List&lt;T&gt;();</span><br><span class="line">	list.Add(first);</span><br><span class="line">	list.Add(second);</span><br><span class="line">	return list;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">List&lt;string&gt; list = MakeList&lt;string&gt;(&quot;Line 1&quot;,&quot;Line 2&quot;);</span><br><span class="line">foreach(string x in list)</span><br><span class="line">&#123;</span><br><span class="line">	Console.WriteLine(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###3.3 Beyond the basics </p>
<ul>
<li>type constraints</li>
<li>type inference</li>
</ul>
<h4 id="3-3-1-Type-constraints"><a href="#3-3-1-Type-constraints" class="headerlink" title="3.3.1 Type constraints"></a>3.3.1 Type constraints</h4><p><strong>REFERENCE TYPE CONSTRAINT</strong></p>
<p><code>struct RefSample&lt;T&gt; where T: class</code></p>
<p>Valid closed types using this declaration include</p>
<ul>
<li><code>RefSample&lt;IDisposable&gt;</code></li>
<li><code>RefSample&lt;string&gt;</code></li>
<li><code>RefSample&lt;int[]&gt;</code></li>
</ul>
<p>Invalid closed types include</p>
<ul>
<li><code>RefSample&lt;Guid&gt;</code></li>
<li><code>RefSample&lt;int&gt;</code></li>
</ul>
<p><strong>VALUE TYPE CONSTRAINTS</strong></p>
<p><code>class ValSample&lt;T&gt; where T:struct</code></p>
<p>Valid closed types include</p>
<ul>
<li><code>ValSample&lt;int&gt;</code></li>
<li><code>ValSample&lt;FileMode&gt;</code></li>
</ul>
<p>Invalid closed types include</p>
<ul>
<li><code>ValSample&lt;object&gt;</code></li>
<li><code>ValSample&lt;StringBuilder&gt;</code></li>
</ul>
<p><strong>CONSTRUCTOR TYPE CONSTRAINTS</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public T CreateInstance&lt;T&gt;() where T: new()</span><br><span class="line">&#123;</span><br><span class="line">    return new T();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Valid : <code>CreateInstance&lt;int&gt;()</code> <code>CreateInstance&lt;object&gt;</code></p>
<p><strong>CONVERSION TYPE CONSTRAINTS</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Sample&lt;T&gt; where T: Stream,</span><br><span class="line">						IEnumerable&lt;string&gt;,</span><br><span class="line">						IComparable&lt;int&gt;</span><br></pre></td></tr></table></figure>
<p>可以指定多个接口,但是只能指定一个类.</p>
<p><strong>COMBINING CONSTRAINTS</strong></p>
<p>Valid:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Sample&lt;T&gt; where T:class,IDisposable,new()</span><br><span class="line">class Sample&lt;T&gt; where T:struct,IDisposable</span><br><span class="line">class Sample&lt;T,U&gt; where T: class where U:struct,T</span><br><span class="line">class Sample&lt;T,U&gt; where T: Stream where U:IDisposable</span><br></pre></td></tr></table></figure>
<p>Invalid:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Sample&lt;T&gt; where T:class,struct</span><br><span class="line">    class Sample&lt;T&gt; where T: Stream,class</span><br><span class="line">        class Sample&lt;T,U&gt; where T:Stream,U:IDisposable</span><br></pre></td></tr></table></figure>
<h4 id="3-3-2-Type-inference-for-type-arguments-of-generic-methods"><a href="#3-3-2-Type-inference-for-type-arguments-of-generic-methods" class="headerlink" title="3.3.2 Type inference for type arguments of generic methods"></a>3.3.2 Type inference for type arguments of generic methods</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">static List&lt;T&gt; MakeList&lt;T&gt;(T first,T second)</span><br><span class="line">    ...</span><br><span class="line">List&lt;string&gt; list = MakeList&lt;string&gt;(&quot;Line 1&quot;,&quot;Line2&quot;);</span><br><span class="line">//we can write</span><br><span class="line">List&lt;string&gt; list = MakeList(&quot;Line 1&quot;,&quot;Line 2&quot;);</span><br></pre></td></tr></table></figure>
<h4 id="3-3-3-Implementing-generics"><a href="#3-3-3-Implementing-generics" class="headerlink" title="3.3.3 Implementing generics"></a>3.3.3 Implementing generics</h4><p><strong>DEFAULT VALUE EXPRESSIONS</strong></p>
<blockquote>
<p>listing 3.4 Comparing a given value to the default in a generic way</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">static int CompareToDefault&lt;T&gt; (T value) where T:IComparable&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">	return value.CompareTo(default(T));</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">Console.WriteLine(CompareToDefault(&quot;x&quot;));</span><br><span class="line">Console.WriteLine(CompareToDefault(10));</span><br><span class="line">Console.WriteLine(CompareToDefault(0));</span><br><span class="line">Console.WriteLine(CompareToDefault(-10));</span><br><span class="line">Console.WriteLine(CompareToDefault(DateTime.MinValue));</span><br></pre></td></tr></table></figure>
<p><strong>DIRECT COMPARISONS</strong></p>
<p>when a type parameter is unconstrained , you can use the == and != operators,but ony to compare a value of that type with null; you cant compare two values of type T with each other.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">static bool AreReferencesEqual&lt;T&gt;(T first ,T second) </span><br><span class="line">	where T: class</span><br><span class="line">	&#123;</span><br><span class="line">		return first == second;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">string name =&quot;Jon&quot;;</span><br><span class="line">string intro1 = &quot;my name is &quot;+ name;</span><br><span class="line">string intro2 = &quot;my name is &quot;+ name;</span><br><span class="line">Console.WriteLine(intro1==intro2);</span><br><span class="line">Console.WriteLine(AreReferencesEqual(intro1,intro2));</span><br></pre></td></tr></table></figure>
<p><strong>FULL COMPARISON EXAMPLE:REPRESENTING A PAIR OF VALUES</strong></p>
<blockquote>
<p>Listing 3.6 Generic class representing a pair of values</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line"></span><br><span class="line">namespace ConsoleApp1</span><br><span class="line">&#123;</span><br><span class="line">    public sealed class Pair&lt;T1,T2&gt;:IEquatable&lt;Pair&lt;T1,T2&gt;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        private static readonly IEqualityComparer&lt;T1&gt; FirstComparer =</span><br><span class="line">            EqualityComparer&lt;T1&gt;.Default;</span><br><span class="line">        private static readonly IEqualityComparer&lt;T2&gt; SecondComparer =</span><br><span class="line">            EqualityComparer&lt;T2&gt;.Default;</span><br><span class="line">        private readonly T1 first;</span><br><span class="line">        private readonly T2 second;</span><br><span class="line">        public Pair(T1 first ,T2 second)</span><br><span class="line">        &#123;</span><br><span class="line">            this.first = first;</span><br><span class="line">            this.second = second;</span><br><span class="line">        &#125;</span><br><span class="line">        public T1 First &#123; get &#123; return first; &#125; &#125;</span><br><span class="line">        public T2 Second &#123; get &#123; return second; &#125; &#125;</span><br><span class="line">        public bool Equals(Pair&lt;T1,T2&gt; other)</span><br><span class="line">        &#123;</span><br><span class="line">            return other != null &amp;&amp;</span><br><span class="line">                FirstComparer.Equals(this.First, other.First) &amp;&amp;</span><br><span class="line">                SecondComparer.Equals(this.Second, other.Second);</span><br><span class="line">        &#125;</span><br><span class="line">        public override bool Equals(object obj)</span><br><span class="line">        &#123;</span><br><span class="line">            return Equals(obj as Pair&lt;T1,T2&gt;);</span><br><span class="line">        &#125;</span><br><span class="line">        public override int GetHashCode()</span><br><span class="line">        &#123;</span><br><span class="line">            return FirstComparer.GetHashCode(first) * 37 +</span><br><span class="line">                SecondComparer.GetHashCode(second);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Pair</span><br><span class="line">    &#123;</span><br><span class="line">        public static Pair&lt;T1,T2&gt; Of&lt;T1,T2&gt;(T1 first ,T2 second)</span><br><span class="line">        &#123;</span><br><span class="line">            return new Pair&lt;T1, T2&gt;(first, second);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Program</span><br><span class="line">    &#123;</span><br><span class="line">        static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            Pair&lt;int, string&gt; pair = new Pair&lt;int, string&gt;(10, &quot;value&quot;);</span><br><span class="line">            Pair&lt;int, string&gt; pair1 = Pair.Of(10, &quot;value&quot;);</span><br><span class="line">            Console.WriteLine(pair.First);</span><br><span class="line">            Console.WriteLine(pair.Second);</span><br><span class="line">            Console.WriteLine(pair1.First);</span><br><span class="line">            Console.WriteLine(pair1.Second);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-Advanced-generics"><a href="#3-4-Advanced-generics" class="headerlink" title="3.4 Advanced generics"></a>3.4 Advanced generics</h3><h4 id="3-4-1-Static-fields-and-static-constructors"><a href="#3-4-1-Static-fields-and-static-constructors" class="headerlink" title="3.4.1 Static fields and static constructors"></a>3.4.1 Static fields and static constructors</h4><blockquote>
<p>Listing 3.8 Proof that different closed type s have different static fields</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class TypeWithField&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">	public static string field;</span><br><span class="line">	public static void PrintField()</span><br><span class="line">	&#123;</span><br><span class="line">		Console.WriteLine(field+&quot;:&quot;+typeof(T).Name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">TypeWithField&lt;int&gt;.field =&quot;First&quot;;</span><br><span class="line">TypeWithField&lt;string&gt;.field =&quot;second&quot;;</span><br><span class="line">TypeWithField&lt;DateTime&gt;.field =&quot;Third&quot;;</span><br><span class="line">TypeWithField&lt;int&gt;.PrintField();</span><br><span class="line">TypeWithField&lt;string&gt;.PrintField();</span><br><span class="line">TypeWithField&lt;DateTime&gt;.PrintField();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Listing 3.9 Static constructors with nested generic types</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class Outer&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">	public class Inner&lt;U,V&gt;</span><br><span class="line">	&#123;</span><br><span class="line">		static Inner()</span><br><span class="line">		&#123;</span><br><span class="line">			Console.WriteLine(&quot;Outer&lt;&#123;0&#125;&gt;.Inner&lt;&#123;1&#125;,&#123;2&#125;&gt;&quot;,</span><br><span class="line">							typeof(T).Name,</span><br><span class="line">							typeof(U).Name,</span><br><span class="line">							typeof(V).Name</span><br><span class="line">							);</span><br><span class="line">		&#125;</span><br><span class="line">		public static void DummyMethod()&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">Outer&lt;int&gt;.Inner&lt;string,DateTime&gt;.DummyMethod();</span><br><span class="line">Outer&lt;string&gt;.Inner&lt;int,int&gt;.DummyMethod();</span><br><span class="line">Outer&lt;object&gt;.Inner&lt;string,object&gt;.DummyMethod();</span><br><span class="line">Outer&lt;string&gt;.Inner&lt;string,object&gt;.DummyMethod();</span><br><span class="line">Outer&lt;object&gt;.Inner&lt;object,string&gt;.DummyMethod();</span><br><span class="line">Outer&lt;string&gt;.Inner&lt;int,int&gt;.DummyMethod();</span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-How-the-JIT-compiler-handles-generics"><a href="#3-4-2-How-the-JIT-compiler-handles-generics" class="headerlink" title="3.4.2 How the JIT compiler handles generics"></a>3.4.2 How the JIT compiler handles generics</h4><h4 id="3-4-3-Generic-iteration"><a href="#3-4-3-Generic-iteration" class="headerlink" title="3.4.3 Generic iteration"></a>3.4.3 Generic iteration</h4><blockquote>
<p>listing 3.10 A full generic iterator - of the numbers 0 to 9</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">class CountingEnumerable:IEnumerable&lt;int&gt;</span><br><span class="line">&#123;</span><br><span class="line">	public IEnumerator&lt;int&gt; GetEnumerator()</span><br><span class="line">	&#123;</span><br><span class="line">		return new CountingEnumerator();</span><br><span class="line">	&#125;</span><br><span class="line">	IEnumerator IEnumerable.GetEnumerator()</span><br><span class="line">	&#123;</span><br><span class="line">		return GetEnumerator();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">class CountingEnumerator:IEnumerator&lt;int&gt;</span><br><span class="line">&#123;</span><br><span class="line">	int current =-1;</span><br><span class="line">	public bool MoveNext()</span><br><span class="line">	&#123;</span><br><span class="line">		current++;</span><br><span class="line">		return current&lt;10;</span><br><span class="line">	&#125;</span><br><span class="line">	public int Current&#123;get&#123;return current;&#125;&#125;</span><br><span class="line">	object IEnumerator.Current&#123;get&#123;return Current;&#125;&#125;</span><br><span class="line">	public void Reset()</span><br><span class="line">	&#123;</span><br><span class="line">		current =-1;</span><br><span class="line">	&#125;</span><br><span class="line">	public void Dispose()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">CountingEnumerable counter = new CountingEnumerable();</span><br><span class="line">foreach(int x in counter)</span><br><span class="line">&#123;</span><br><span class="line">	Console.WriteLine(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-4-4-Reflection-and-generics"><a href="#3-4-4-Reflection-and-generics" class="headerlink" title="3.4.4 Reflection and generics"></a>3.4.4 Reflection and generics</h4><p><strong>USING TYPEOF WITH GENERIC TYPES</strong></p>
<blockquote>
<p>listing 3.11</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">static void DemonstrateTypeof&lt;X&gt;()</span><br><span class="line">&#123;</span><br><span class="line">	Console.WriteLine(typeof(X));</span><br><span class="line">	Console.WriteLine(typeof(List&lt;&gt;));</span><br><span class="line">	Console.WriteLine(typeof(Dictionary&lt;,&gt;));</span><br><span class="line">	Console.WriteLine(typeof(List&lt;X&gt;));</span><br><span class="line">	Console.WriteLine(typeof(Dictionary&lt;string,X&gt;));</span><br><span class="line">	Console.WriteLine(typeof(List&lt;long&gt;));</span><br><span class="line">	Console.WriteLine(typeof(Dictionary&lt;long,Guid&gt;));</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">DemonstrateTypeof&lt;int&gt;();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 3.12</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">string listTypeName=&quot;System.Collections.Generic.List`1&quot;;</span><br><span class="line">Type defByName =Type.GetType(listTypeName);</span><br><span class="line">Type closedByName = Type.GetType(listTypeName+&quot;[System.String]&quot;);</span><br><span class="line">Type closedByMethod = defByName.MakeGenericType(typeof(string));</span><br><span class="line">Type closedByTypeof = typeof(List&lt;string&gt;);</span><br><span class="line">Console.WriteLine (closedByMethod == closedByName);</span><br><span class="line">Console.WriteLine(closedByName==closedByTypeof);</span><br><span class="line"></span><br><span class="line">Type defByTypeof= typeof(List&lt;&gt;);</span><br><span class="line">Type defByMethod = closedByName.GetGenericTypeDefinition();</span><br><span class="line">Console.WriteLine(defByMethod==defByName);</span><br><span class="line">Console.WriteLine(defByName==defByTypeof);</span><br></pre></td></tr></table></figure>
<p>System.Type的属性和方法</p>
<p>有两个方法是最重要的GetGenericTypeDefinition和MakeGenericType(作用于泛型类型定义,返回一个已构造类型)</p>
<ol start="3">
<li>反射泛型方法</li>
</ol>
<p>通过反射来调用泛型方法</p>
<blockquote>
<p>Listing 3.13</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public static void PrintTypeParameter&lt;T&gt;()</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(typeof(T));</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">Type type = typeof(Snippet);</span><br><span class="line">MethodInfo definition = type.GetMethod(&quot;PrintTypeParameter&quot;);</span><br><span class="line">MethodInfo constructed = definition.MakeGenericMethod(typeof(string));</span><br><span class="line">constructed.Invoke(null,null);</span><br></pre></td></tr></table></figure>
<h3 id="3-5-Limitations-of-generics-in-C-and-other-languages"><a href="#3-5-Limitations-of-generics-in-C-and-other-languages" class="headerlink" title="3.5 Limitations of generics in C# and other languages"></a>3.5 Limitations of generics in C# and other languages</h3><h4 id="3-5-1-Lack-of-generic-variance"><a href="#3-5-1-Lack-of-generic-variance" class="headerlink" title="3.5.1 Lack of generic variance"></a>3.5.1 Lack of generic variance</h4><p>泛型是不变体</p>
<ol start="2">
<li>协变性在什么时候有用</li>
<li>没理解</li>
</ol>
<p>####3.5.4 comparison with C++ templates</p>
<h2 id="4-Saying-nothing-with-nullable-types"><a href="#4-Saying-nothing-with-nullable-types" class="headerlink" title="4 Saying nothing with nullable types"></a>4 Saying nothing with nullable types</h2><h3 id="4-1-What-do-you-do-when-you-just-dont-have-a-value"><a href="#4-1-What-do-you-do-when-you-just-dont-have-a-value" class="headerlink" title="4.1 What do you do when you  just dont have a value?"></a>4.1 What do you do when you  just dont have a value?</h3><h4 id="4-1-1-Why-value-type-variables-cant-be-null"><a href="#4-1-1-Why-value-type-variables-cant-be-null" class="headerlink" title="4.1.1 Why value type variables cant be null"></a>4.1.1 Why value type variables cant be null</h4><h4 id="4-1-2-Patterns-for-representing-null-values-in-C-1"><a href="#4-1-2-Patterns-for-representing-null-values-in-C-1" class="headerlink" title="4.1.2 Patterns for representing null values in C#1"></a>4.1.2 Patterns for representing null values in C#1</h4><h3 id="4-2-System-Nullable-lt-T-gt-and-System-Nullable"><a href="#4-2-System-Nullable-lt-T-gt-and-System-Nullable" class="headerlink" title="4.2 System.Nullable &lt;T&gt;and System.Nullable"></a>4.2 System.Nullable <code>&lt;T&gt;</code>and System.Nullable</h3><h4 id="4-2-1-Introduciong-Nullable-lt-T-gt"><a href="#4-2-1-Introduciong-Nullable-lt-T-gt" class="headerlink" title="4.2.1 Introduciong Nullable&lt;T&gt;"></a>4.2.1 Introduciong Nullable<code>&lt;T&gt;</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">static void Display(Nullable&lt;int&gt; x)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;HasValue: &#123;0&#125;&quot;,x.HasValue);</span><br><span class="line">            if (x.HasValue)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;Value: &#123;0&#125;&quot;,x.Value);</span><br><span class="line">                Console.WriteLine(&quot;Explicit conversion: &#123;0&#125; &quot;,(int)x);</span><br><span class="line">            &#125;</span><br><span class="line">            Console.WriteLine(&quot;GetValueOrDefault(): &#123;0&#125;&quot;,x.GetValueOrDefault());</span><br><span class="line">            Console.WriteLine(&quot;GetValueOrDefault(10) : &#123;0&#125;&quot;,x.GetValueOrDefault(10));</span><br><span class="line">            Console.WriteLine(&quot;ToString(*): \&quot;&#123;0&#125;\&quot;&quot;,x.ToString());</span><br><span class="line">            Console.WriteLine(&quot;GetHashCode(): &#123;0&#125; &quot;,x.GetHashCode());</span><br><span class="line">            Console.WriteLine();</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">Nullable&lt;int&gt; x = 5;</span><br><span class="line">x = new Nullable&lt;int&gt;(5);</span><br><span class="line">Console.WriteLine(&quot;Instance with value: &quot;);</span><br><span class="line">Display(x);</span><br><span class="line">x= new Nullable&lt;int&gt;();</span><br><span class="line">Console.WriteLine(&quot;Instance without value:&quot;);</span><br><span class="line">Display(x);</span><br></pre></td></tr></table></figure>
<h4 id="4-2-2-Boxing-Nullable-lt-T-gt-and-unboxing"><a href="#4-2-2-Boxing-Nullable-lt-T-gt-and-unboxing" class="headerlink" title="4.2.2 Boxing Nullable&lt;T&gt; and unboxing"></a>4.2.2 Boxing Nullable<code>&lt;T&gt;</code> and unboxing</h4><p>It is  important to remember that Nullable<code>&lt;T&gt;</code> is a struct —a value type.</p>
<h4 id="4-2-3-Equality-of-Nullable-lt-T-gt-instances"><a href="#4-2-3-Equality-of-Nullable-lt-T-gt-instances" class="headerlink" title="4.2.3 Equality of Nullable&lt;T&gt; instances"></a>4.2.3 Equality of Nullable<code>&lt;T&gt;</code> instances</h4><h4 id="4-2-4-Support-from-the-nongeneric-Nullable-class"><a href="#4-2-4-Support-from-the-nongeneric-Nullable-class" class="headerlink" title="4.2.4 Support from the nongeneric Nullable class"></a>4.2.4 Support from the nongeneric Nullable class</h4><h3 id="4-3-C-2’s-syntactic-sugar-for-nullable-types"><a href="#4-3-C-2’s-syntactic-sugar-for-nullable-types" class="headerlink" title="4.3 C# 2’s syntactic sugar for nullable types"></a>4.3 C# 2’s syntactic sugar for nullable types</h3><h4 id="4-3-1-The-modifier"><a href="#4-3-1-The-modifier" class="headerlink" title="4.3.1 The ? modifier"></a>4.3.1 The ? modifier</h4><blockquote>
<p>list4.2 same as 4.1</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int? nullable = 5;</span><br><span class="line">object boxed = nullable;</span><br><span class="line">Console.WriteLine(boxed.GetType());</span><br><span class="line"></span><br><span class="line">int normal = (int)boxed;</span><br><span class="line">Console.WriteLine(normal);</span><br><span class="line"></span><br><span class="line">nullable = new int?();</span><br><span class="line">boxed = nullable;</span><br><span class="line"></span><br><span class="line">Console.WriteLine(boxed==null);</span><br><span class="line"></span><br><span class="line">nullable = (int?)boxed;</span><br><span class="line">Console.WriteLine(nullable.HasValue);</span><br></pre></td></tr></table></figure>
<p> 强调一波 代码最终是要给人读的 所以可读性和规范化很重要</p>
<p>We’ll model a Person class where you need to know a person’s name,date of birth,and date of death.Some of those people may still be alive—in which case the date of death will be represented by null.Here is some code .</p>
<blockquote>
<p>Listing 4.4  Part of a Person class including calculation of age</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public TimeSpan get_Age()</span><br><span class="line">&#123;</span><br><span class="line">    if (!this.death.HasValue)</span><br><span class="line">    &#123;</span><br><span class="line">        return (TimeSpan) (DateTime.Now - this.birth);</span><br><span class="line">    &#125;</span><br><span class="line">    return (this.death.Value - this.birth);</span><br><span class="line">&#125;</span><br><span class="line">//这是IL</span><br><span class="line"> public class Person</span><br><span class="line">  &#123;</span><br><span class="line">      private DateTime  birth;</span><br><span class="line">      private DateTime? death;</span><br><span class="line">      private string name;</span><br><span class="line">      public TimeSpan Age</span><br><span class="line">        &#123;</span><br><span class="line">            get</span><br><span class="line">            &#123;</span><br><span class="line">                if (death == null)</span><br><span class="line">                &#123;</span><br><span class="line">                    return DateTime.Now - birth;</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    return death.Value - birth;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      public Person(string name, DateTime birth, DateTime? death)</span><br><span class="line">        &#123;</span><br><span class="line">            this.birth = birth;</span><br><span class="line">            this.death = death;</span><br><span class="line">            this.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">Person turing = new Person(&quot;Alan Turing&quot;, new DateTime(1912, 6, 23), new 	DateTime(1954, 4, 7));</span><br><span class="line">            Person knuth = new Person(&quot;Donald Knuth &quot;, new DateTime(1938, 1, 10), null);</span><br><span class="line">            Console.WriteLine(turing.Age);</span><br><span class="line">            Console.WriteLine(knuth.Age);</span><br></pre></td></tr></table></figure>
<h4 id="4-3-2-Assigning-and-comparing-with-null"><a href="#4-3-2-Assigning-and-comparing-with-null" class="headerlink" title="4.3.2 Assigning and comparing with null"></a>4.3.2 Assigning and comparing with null</h4><h4 id="4-3-3-Nullable-conversions-and-operators"><a href="#4-3-3-Nullable-conversions-and-operators" class="headerlink" title="4.3.3 Nullable conversions and operators"></a>4.3.3 Nullable conversions and operators</h4><pre><code>可空类型也是可以转换的
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int i=5;</span><br><span class="line">if(i==null)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;Never going to happen&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这玩意会发出警告,因为两者都存在一个到int?的隐式转换</p>
<h4 id="4-3-4-Nullable-logic"><a href="#4-3-4-Nullable-logic" class="headerlink" title="4.3.4 Nullable logic"></a>4.3.4 Nullable logic</h4><h4 id="4-3-5-Using-the-as-operator-with-nullable-types"><a href="#4-3-5-Using-the-as-operator-with-nullable-types" class="headerlink" title="4.3.5  Using the as operator with nullable types"></a>4.3.5  Using the as operator with nullable types</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">static void PrintValueAsInt32(object o)</span><br><span class="line">        &#123;</span><br><span class="line">            int? nullable = o as int?;</span><br><span class="line">            System.Console.WriteLine(nullable.HasValue? nullable.Value.ToString():&quot;null&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">			System.Console.WriteLine(&quot;null as:&quot;);</span><br><span class="line">            PrintValueAsInt32(5);</span><br><span class="line">            PrintValueAsInt32(&quot;some string&quot;);</span><br></pre></td></tr></table></figure>
<p>然而.net 4.5 以前is 和强制转换比 as快20倍</p>
<h4 id="4-3-6-The-null-coalescing-operator"><a href="#4-3-6-The-null-coalescing-operator" class="headerlink" title="4.3.6 The null coalescing operator"></a>4.3.6 The null coalescing operator</h4><p>空合并操作符 </p>
<p>这个二元操作符在对first??second求值时:</p>
<ol>
<li>对first进行求值</li>
<li>如果结果非空,则该结果就是整个表达式的结果</li>
<li>否则求second的值,其结果作为整个表达式的结果</li>
</ol>
<p>之前的死亡日期属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DateTime lastAlive = death??DateTime.Now</span><br><span class="line">return lastAlive-birth;</span><br></pre></td></tr></table></figure>
<p>涉及空值的时候就可以这么写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Address contact = user.COntractAddress;</span><br><span class="line">if(contact ==null)</span><br><span class="line">&#123;</span><br><span class="line">    contact = order.ShippingAddress;</span><br><span class="line">    if(contact ==null)</span><br><span class="line">    &#123;</span><br><span class="line">        contact = user.BillingAddress;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===&gt;</span><br><span class="line">Address contact = user.ContactAddress??</span><br><span class="line">    				order.ShippingAddress??</span><br><span class="line">    					user.BillingAddress;</span><br></pre></td></tr></table></figure>
<h3 id="4-4-Novel-uses-of-nullable-types"><a href="#4-4-Novel-uses-of-nullable-types" class="headerlink" title="4.4 Novel uses of nullable types"></a>4.4 Novel uses of nullable types</h3><h4 id="4-4-1-Tyeing-an-operation-without-using-output-parameter"><a href="#4-4-1-Tyeing-an-operation-without-using-output-parameter" class="headerlink" title="4.4.1 Tyeing an operation without using output parameter"></a>4.4.1 Tyeing an operation without using output parameter</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">static int? TryParse(string text)</span><br><span class="line">        &#123;</span><br><span class="line">            int ret;</span><br><span class="line">            if (int.TryParse(text, out ret))</span><br><span class="line">            &#123;</span><br><span class="line">                return ret;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">			int? parsed = TryParse(&quot;No valid&quot;);//(可空调用)</span><br><span class="line">            if (parsed != null)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;Parsed to &#123;0&#125;&quot;, parsed.Value);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;Countnt parse&quot;);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>后面的方法更为条理清晰</p>
<p>####4.4.2 Painless comparisons with the null coalescing operator</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public int Compare(Product first, Product second)</span><br><span class="line">        &#123;</span><br><span class="line">            return PC.ReferenceCompare(first, second) ?? PC.Compare(second.Popularity, first.Popularity)</span><br><span class="line">                   ?? PC.Compare(first.Price, second.Price) ?? PC.Compare(first.Name, second.Name) ?? 0;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-5-Summary"><a href="#4-5-Summary" class="headerlink" title="4.5 Summary"></a>4.5 Summary</h3><p>Nullable types solves a specific problem that only has somewhat ugly solutions before C#2.The delegate enhancements in C#2 act as a bridge between the familiarity of C#1 and the style of idiomatic C#3,which can often be raidcally different from earlier versions.</p>
<h2 id="5-Fast-tracked-delegates"><a href="#5-Fast-tracked-delegates" class="headerlink" title="5 Fast-tracked delegates"></a>5 Fast-tracked delegates</h2><h3 id="5-1-Saying-goodbye-to-awkward-delegate-syntax"><a href="#5-1-Saying-goodbye-to-awkward-delegate-syntax" class="headerlink" title="5.1 Saying goodbye to awkward delegate syntax"></a>5.1 Saying goodbye to awkward delegate syntax</h3><blockquote>
<p>list5.1 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">static void LogPlainEvent(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;LogPlain&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static void LogKeyEvent(object sender, KeyPressEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;LogKey&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static void LogMouseEvent(object sender, MouseEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;LogMouse&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    Button button = new Button();</span><br><span class="line">          button.Text = &quot;Click me&quot;;</span><br><span class="line">          button.Click += new EventHandler(LogPlainEvent);</span><br><span class="line">          button.KeyPress += new KeyPressEventHandler(LogKeyEvent);</span><br><span class="line">          button.MouseClick += new MouseEventHandler(LogMouseEvent);</span><br><span class="line"></span><br><span class="line">          Form form = new Form();</span><br><span class="line">          form.AutoSize = true;</span><br><span class="line">          form.Controls.Add(button);</span><br><span class="line">          Application.Run(form);</span><br></pre></td></tr></table></figure>
<h3 id="5-2-Method-group-conversions"><a href="#5-2-Method-group-conversions" class="headerlink" title="5.2 Method group conversions"></a>5.2 Method group conversions</h3><h3 id="5-3-Covariance-and-contravariance"><a href="#5-3-Covariance-and-contravariance" class="headerlink" title="5.3 Covariance and contravariance"></a>5.3 Covariance and contravariance</h3><blockquote>
<p>list5.2</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Button button = new Button();</span><br><span class="line">          button.Text = &quot;Click me&quot;;</span><br><span class="line">          button.Click += LogPlainEvent;</span><br><span class="line">          button.KeyPress += LogPlainEvent;</span><br><span class="line">          button.MouseClick += LogPlainEvent;</span><br><span class="line"></span><br><span class="line">          Form form = new Form();</span><br><span class="line">          form.AutoSize = true;</span><br><span class="line">          form.Controls.Add(button);</span><br><span class="line">          Application.Run(form);</span><br><span class="line">static void LogPlainEvent(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;LogPlain&quot;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-3-1-Contravariance-for-delegate-parameters"><a href="#5-3-1-Contravariance-for-delegate-parameters" class="headerlink" title="5.3.1 Contravariance for delegate parameters"></a>5.3.1 Contravariance for delegate parameters</h4><h4 id="5-3-2-Covariance-of-delegate-return-types"><a href="#5-3-2-Covariance-of-delegate-return-types" class="headerlink" title="5.3.2 Covariance of delegate return types"></a>5.3.2 Covariance of delegate return types</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">delegate Stream StreamFactory();</span><br><span class="line">static MemoryStream GenerateSampleData()</span><br><span class="line">&#123;</span><br><span class="line">	byte[] buffer = new byte[16];</span><br><span class="line">	for(int i=0;i&lt;buffer.Length;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		buffer[i]=(byte)i;</span><br><span class="line">	&#125;</span><br><span class="line">	return new MemoryStream(buffer);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">StreamFactory factory = GenerateSampleData;</span><br><span class="line">using(Stream stream = factory())</span><br><span class="line">&#123;</span><br><span class="line">	int data;</span><br><span class="line">	while((data=stream.ReadByte())!=-1)</span><br><span class="line">	&#123;</span><br><span class="line">		Console.WriteLine(data);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-3-3-A-small-risk-of-incompatibility"><a href="#5-3-3-A-small-risk-of-incompatibility" class="headerlink" title="5.3.3 A small risk of incompatibility"></a>5.3.3 A small risk of incompatibility</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">delegate void SampleDelegate(string x);</span><br><span class="line"></span><br><span class="line">        public void CandidateAction(string x)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;Snippet.CandidateAction&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public class Derived : Snippet</span><br><span class="line">        &#123;</span><br><span class="line">            public void CandidateAction(object o)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;Derived.CandidateAction&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Derived x = new Derived();</span><br><span class="line">          SampleDelegate factory = new SampleDelegate(x.CandidateAction);</span><br><span class="line">          factory(&quot;test&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="5-4-Inline-delegate-actions-with-anonymous-methods"><a href="#5-4-Inline-delegate-actions-with-anonymous-methods" class="headerlink" title="5.4 Inline delegate actions with anonymous methods"></a>5.4 Inline delegate actions with anonymous methods</h3><h4 id="5-4-1-Starting-simply-acting-on-a-parameter"><a href="#5-4-1-Starting-simply-acting-on-a-parameter" class="headerlink" title="5.4.1 Starting simply : acting on a parameter"></a>5.4.1 Starting simply : acting on a parameter</h4><blockquote>
<p>list5.5</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Action&lt;string&gt; printReverse = delegate(string text)</span><br><span class="line">                &#123;</span><br><span class="line">                    char[] chars = text.ToCharArray();</span><br><span class="line">                    Array.Reverse(chars);</span><br><span class="line">                    Console.WriteLine(new string(chars));</span><br><span class="line">                &#125;;</span><br><span class="line">            Action&lt;int&gt; printRoot = delegate(int number) &#123; Console.WriteLine(Math.Sqrt(number)); &#125;;</span><br><span class="line">            Action&lt;IList&lt;double&gt;&gt; printMean = delegate(IList&lt;double&gt; numbers)</span><br><span class="line">                &#123;</span><br><span class="line">                    double total = 0;</span><br><span class="line">                    foreach (double value in numbers)</span><br><span class="line">                    &#123;</span><br><span class="line">                        total += value;</span><br><span class="line">                    &#125;</span><br><span class="line">                    Console.WriteLine(total / numbers.Count);</span><br><span class="line">                &#125;;</span><br><span class="line">            printReverse(&quot;Hello her&quot;);</span><br><span class="line">            printRoot(2);</span><br><span class="line">            printMean(new double[] &#123; 1.5, 2.5, 3, 4.5 &#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//三级跳</span><br><span class="line"> delegate int calculator(int x, int y); //委托类型</span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            calculator cal = new calculator(Adding);</span><br><span class="line">            int He = cal(1, 1);</span><br><span class="line">            Console.Write(He);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static int Adding(int x, int y)</span><br><span class="line">        &#123;</span><br><span class="line">            return x + y;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">delegate int calculator(int x, int y); //委托 匿名方法 其实就是省略了 委托的方法名称</span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            calculator cal = delegate(int num1,int num2)</span><br><span class="line">            &#123;</span><br><span class="line">                return num1 + num2;</span><br><span class="line">            &#125;;</span><br><span class="line">            int he = cal(1, 1);</span><br><span class="line">            Console.Write(he);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">delegate int calculator(int x, int y); //委托类型</span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            calculator cal = (x, y) =&gt; x + y;//Lambda表达式，大家发现没有，代码一个比一个简洁</span><br><span class="line">            int he = cal(1, 1);</span><br><span class="line">            Console.Write(he);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-4-2-Returing-values-from-anonymous-methods"><a href="#5-4-2-Returing-values-from-anonymous-methods" class="headerlink" title="5.4.2 Returing values from anonymous methods"></a>5.4.2 Returing values from anonymous methods</h4><blockquote>
<p>list 5.7</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Predicate&lt;int&gt; isEven = delegate(int x) &#123; return x % 2 == 0; &#125;;</span><br><span class="line">            Console.WriteLine(isEven(1));</span><br></pre></td></tr></table></figure>
<p>​    新的语法和我们所期望的几乎完全相符__不需要在delegate那里声明返回类型.The compiler checks that all the possible return values are compatible with the declared return type of the delgate type it is trying to  convert the anonymous method into.</p>
<blockquote>
<p>list5.8</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SortAndShowFiles(</span><br><span class="line">                &quot;Sorted by name:&quot;,</span><br><span class="line">                delegate(FileInfo f1, FileInfo f2) &#123; return f1.Name.CompareTo(f2.Name); &#125;);</span><br><span class="line">            SortAndShowFiles(</span><br><span class="line">                &quot;Sorted by length: &quot;,</span><br><span class="line">                delegate(FileInfo f1, FileInfo f2) &#123; return f1.Length.CompareTo(f2.Length); &#125;);</span><br><span class="line">            SortAndShowFiles(&quot;Sorted by name lambda: &quot;,</span><br><span class="line">                (x, y) =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        return x.Name.CompareTo(y.Name);</span><br><span class="line">                    &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="5-4-3-Ignoring-delegate-parameters"><a href="#5-4-3-Ignoring-delegate-parameters" class="headerlink" title="5.4.3 Ignoring delegate parameters"></a>5.4.3 Ignoring delegate parameters</h4><blockquote>
<p>list 5.6 代码精简</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">List&lt;int&gt; x = new List&lt;int&gt;();</span><br><span class="line">            x.Add(5);</span><br><span class="line">            x.Add(10);</span><br><span class="line">            x.Add(15);</span><br><span class="line">            x.Add(20);</span><br><span class="line">            x.Add(25);</span><br><span class="line">			x.ForEach(</span><br><span class="line">                delegate(int n)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Console.WriteLine(Math.Sqrt(n));</span><br><span class="line">                    &#125;</span><br><span class="line">            );</span><br><span class="line">            x.ForEach(</span><br><span class="line">                (n) =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        Console.WriteLine(Math.Sqrt(n));</span><br><span class="line">                    &#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>list 5.9 Subcribing to events with anonymous methods that ignore parameters</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Button button = new Button();</span><br><span class="line">            button.Text = &quot;Click me&quot;;</span><br><span class="line">            button.Click += delegate &#123; Console.WriteLine(&quot;LogPlain&quot;); &#125;;</span><br><span class="line">            button.KeyPress += delegate &#123; Console.WriteLine(&quot;LogKey&quot;); &#125;;</span><br><span class="line">            button.MouseClick += delegate &#123; Console.WriteLine(&quot;LogMouse&quot;); &#125;;</span><br><span class="line">            Form form = new Form();</span><br><span class="line">            form.AutoSize = true;</span><br><span class="line">            form.Controls.Add(button);</span><br><span class="line">            Application.Run(form);</span><br><span class="line"></span><br><span class="line">how about lambda</span><br></pre></td></tr></table></figure>
<h3 id="5-5-Capturing-variables-in-anonymous-methods"><a href="#5-5-Capturing-variables-in-anonymous-methods" class="headerlink" title="5.5 Capturing variables in anonymous methods"></a>5.5 Capturing variables in anonymous methods</h3><blockquote>
<p>list 5.10 Examples of variable kinds with respect to anonymous methods</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">static void EnclosingMethod()</span><br><span class="line">        &#123;</span><br><span class="line">            int outerVariable = 5;</span><br><span class="line">            string capturedVariable = &quot;captured&quot;;</span><br><span class="line">            if (DateTime.Now.Hour == 9)</span><br><span class="line">            &#123;</span><br><span class="line">                int normallLocalVariable = DateTime.Now.Minute;</span><br><span class="line">                Console.WriteLine(normallLocalVariable);</span><br><span class="line">            &#125;</span><br><span class="line">            MethodInvoker x = delegate()</span><br><span class="line">                &#123;</span><br><span class="line">                    string anonLocal = &quot;local to anonymous method&quot;;</span><br><span class="line">                    Console.WriteLine(capturedVariable+anonLocal);</span><br><span class="line">                &#125;;</span><br><span class="line">            x();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-5-1-Defining-closures-and-different-types-of-variables"><a href="#5-5-1-Defining-closures-and-different-types-of-variables" class="headerlink" title="5.5.1 Defining closures and different types of variables"></a>5.5.1 Defining closures and different types of variables</h4><h4 id="5-5-2-Examining-the-behavior-of-captured-variables"><a href="#5-5-2-Examining-the-behavior-of-captured-variables" class="headerlink" title="5.5.2 Examining the behavior of captured variables"></a>5.5.2 Examining the behavior of captured variables</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">string captured = &quot;Before x is captured&quot;;</span><br><span class="line">            MethodInvoker x = delegate</span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(captured);</span><br><span class="line">                    captured = &quot;Changed by x&quot;;</span><br><span class="line">                &#125;;</span><br><span class="line">            captured = &quot;directly before x is invoked&quot;;</span><br><span class="line">            x();</span><br><span class="line">            Console.WriteLine(captured);</span><br><span class="line">            captured = &quot;before second invocation&quot;;</span><br><span class="line">            x();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; FindAllYoungerThan(List&lt;Person&gt; people,int limit)</span><br><span class="line">&#123;</span><br><span class="line">    return people.FindAll(delegate (Person person)</span><br><span class="line">                          &#123;</span><br><span class="line">                              return person.Age&lt;limit;</span><br><span class="line">                          &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-5-3-What’s-the-point-of-captured-variables"><a href="#5-5-3-What’s-the-point-of-captured-variables" class="headerlink" title="5.5.3 What’s the point of captured variables"></a>5.5.3 What’s the point of captured variables</h4><h4 id="5-5-4-The-extended-lifetime-of-captured-variables"><a href="#5-5-4-The-extended-lifetime-of-captured-variables" class="headerlink" title="5.5.4 The extended lifetime of  captured variables"></a>5.5.4 The extended lifetime of  captured variables</h4><blockquote>
<p>list5.12  Demonstration of a captured variabled variable having its lifetime extended</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            MethodInvoker x = CreateDelegateInstance();</span><br><span class="line">            x();</span><br><span class="line">            x();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static MethodInvoker CreateDelegateInstance()</span><br><span class="line">        &#123;</span><br><span class="line">            int counter = 5;</span><br><span class="line">            MethodInvoker ret = delegate</span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(counter);</span><br><span class="line">                    counter++;</span><br><span class="line">                &#125;;</span><br><span class="line">            ret();</span><br><span class="line">            return ret;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>A captured varibale lives for at least as long as any delegate instance referring to it.</p>
<p>我们一般会人为counter在栈上,实际上在堆上?</p>
<p>####5.5.5 Local vairable instantiations</p>
<p>比较这两段代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int single;</span><br><span class="line">for(int i =0;i&lt;10;i++)&#123;</span><br><span class="line">    single =5;</span><br><span class="line">    cw(single+i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//latter</span><br><span class="line">for(int i =0;i&lt;10;i++)</span><br><span class="line">&#123;</span><br><span class="line">    int multiple =5;</span><br><span class="line">    Cw(multiple+i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后者被创建了10次moultiple</p>
<blockquote>
<p>list5.13 capturing multiple variable instantiations with multiple delegates<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">List&lt;MethodInvoker&gt; list = new List&lt;MethodInvoker&gt;();</span><br><span class="line">            for (int index = 0; index &lt; 5; index++)</span><br><span class="line">            &#123;</span><br><span class="line">                int counter = index * 10; //实例化counter 多次 每次都是不同的变量</span><br><span class="line">                list.Add(</span><br><span class="line">                    delegate</span><br><span class="line">                        &#123;</span><br><span class="line">                            Console.WriteLine(counter);//打印并递增捕获的变量</span><br><span class="line">                            counter++;</span><br><span class="line">                        &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            foreach (MethodInvoker t in list)</span><br><span class="line">            &#123;</span><br><span class="line">                t(); //执行全部5个委托</span><br><span class="line">            &#125;</span><br><span class="line">            list[0]();</span><br><span class="line">            list[0]();</span><br><span class="line">            list[0]();</span><br><span class="line">            list[1]();</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>####5.5.6 Mixtures of shared and distinct variables</p>
<blockquote>
<p>list 5.14 Capturing variables in different scopes. Warning : nasty code ahead!<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MethodInvoker[] delegates = new MethodInvoker[2];</span><br><span class="line">           int outside = 0;           //Instatiates variable once</span><br><span class="line">           for (int i = 0; i &lt; 2; i++)</span><br><span class="line">           &#123;</span><br><span class="line">               int inside = 0;        //Instatiates variable multiple times</span><br><span class="line">               delegates[i] = delegate  //Captures variables with anonymous method</span><br><span class="line">                   &#123;</span><br><span class="line">                       Console.WriteLine(&quot;(&#123;0&#125;,&#123;1&#125;)&quot;, outside, inside);</span><br><span class="line">                       outside++;</span><br><span class="line">                       inside++;</span><br><span class="line">                   &#125;;</span><br><span class="line">           &#125;</span><br><span class="line">           MethodInvoker first = delegates[0];</span><br><span class="line">           MethodInvoker second = delegates[1];</span><br><span class="line">           first();</span><br><span class="line">           first();</span><br><span class="line">           first();</span><br><span class="line">           second();</span><br><span class="line">           second();</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>####5.5.7 Captured variable guidelines and summary</p>
<ul>
<li>If Code that doesnot use captured variables is just as simple as code that does,dont use them</li>
<li>Before capturing a variable declared by a for or foreach statement,consider whether your delegate is going to live beyont the loop iteration, and whether your want it to see the subsequent values of that variable. If not ,create another variable inside the loop that just copies the value you do want</li>
<li>If you create multiple delegate instances that capture variables, put thought into whether your want them to capture the same variable</li>
<li>If you capture avariable that doesnt actually change,you dont need to worry as much</li>
<li>If the delegate instances your create never escape from the method - in other words,they’re never stored anywhere else,or returned, or used for starting threads-life is a lot simple</li>
<li>Consider the extended lifetie of any  captured variables in terms of garbage collection. This is normally not an issue,but if you capture an object that’s expensive in terms of memory, it may be significant’<h3 id="5-6-Summary"><a href="#5-6-Summary" class="headerlink" title="5.6 Summary"></a>5.6 Summary</h3></li>
<li>The varibale is captured - not its value at the point of delegate instance creation</li>
<li>Captured variables have lifetimes extended to at least that of the capturing delegate</li>
<li>Multiple delegates can capture the same variable…</li>
<li>…but within loops,the same variable declaration can effectively refer to different variable “instances”</li>
<li>for loop declarations careate variable that live for the duration of the loop– they are not instantiated on each iteration. the same is true for foreach statements before C#5</li>
<li>Extra types are created ,where necessary,to hold captured variable.</li>
<li>Be careful! Simple is almost always better than clever.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">木兰花令·拟古决绝词</span><br><span class="line">人生若只如初见，何事秋风悲画扇。</span><br><span class="line">等闲变却故人心，却道故人心易变。</span><br><span class="line">骊山语罢清宵半，泪雨零铃终不怨。</span><br><span class="line">何如薄幸锦衣郎，比翼连枝当日愿。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="6-Inplementing-iterators-the-easy-way"><a href="#6-Inplementing-iterators-the-easy-way" class="headerlink" title="6 Inplementing iterators the easy way"></a>6 Inplementing iterators the easy way</h2><h3 id="6-1-C-1-The-pain-of-hadwritten-iterators"><a href="#6-1-C-1-The-pain-of-hadwritten-iterators" class="headerlink" title="6.1 C#1 The pain of hadwritten iterators"></a>6.1 C#1 The pain of hadwritten iterators</h3><blockquote>
<p>listing 6.1 Code using the (as yet unimplemented) new collection type</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">class Program</span><br><span class="line">    &#123;</span><br><span class="line">        static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            object[] values = &#123; &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot; &#125;;</span><br><span class="line">            IterationSample collection = new IterationSample(values, 3);</span><br><span class="line">            foreach (object x in collection)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class IterationSample : IEnumerable</span><br><span class="line">    &#123;</span><br><span class="line">        public object[] values;</span><br><span class="line">        public int startingPoint;</span><br><span class="line"></span><br><span class="line">        public IterationSample(object[] values, int startingPoint)</span><br><span class="line">        &#123;</span><br><span class="line">            this.values = values;</span><br><span class="line">            this.startingPoint = startingPoint;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IEnumerator GetEnumerator()</span><br><span class="line">        &#123;</span><br><span class="line">            return new IterationSampleIterator(this);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class IterationSampleIterator : IEnumerator</span><br><span class="line">    &#123;</span><br><span class="line">        IterationSample parent;</span><br><span class="line">        int position;</span><br><span class="line"></span><br><span class="line">        internal IterationSampleIterator(IterationSample parent)</span><br><span class="line">        &#123;</span><br><span class="line">            this.parent = parent;</span><br><span class="line">            position = -1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public bool MoveNext()</span><br><span class="line">        &#123;</span><br><span class="line">            if (position != parent.values.Length)</span><br><span class="line">            &#123;</span><br><span class="line">                position++;</span><br><span class="line">            &#125;</span><br><span class="line">            return position &lt; parent.values.Length;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public object Current</span><br><span class="line">        &#123;</span><br><span class="line">            get</span><br><span class="line">            &#123;</span><br><span class="line">                if (position == -1 || position == parent.values.Length)</span><br><span class="line">                &#123;</span><br><span class="line">                    throw new InvalidOperationException();</span><br><span class="line">                &#125;</span><br><span class="line">                int index = position + parent.startingPoint;</span><br><span class="line">                index = index % parent.values.Length;</span><br><span class="line">                return parent.values[index];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void Reset()</span><br><span class="line">        &#123;</span><br><span class="line">            position = -1;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-2-C-2-Simple-iterators-with-yield-statements"><a href="#6-2-C-2-Simple-iterators-with-yield-statements" class="headerlink" title="6.2 C#2 Simple iterators with yield statements"></a>6.2 C#2 Simple iterators with yield statements</h3><blockquote>
<p>listing 6.4 Iterating through the sample collection with c#2 and yield return</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public IEnumerator GetEnumerator()</span><br><span class="line">        &#123;</span><br><span class="line">            for (int index = 0; index &lt; values.Length; index++)</span><br><span class="line">            &#123;</span><br><span class="line">                yield return values[(index + startingPoint) % values.Length];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">//That replaces the whole of the IterationSampleIterator class</span><br></pre></td></tr></table></figure>
<h4 id="6-2-1-Introducing-iterator-blocks-and-yield-return"><a href="#6-2-1-Introducing-iterator-blocks-and-yield-return" class="headerlink" title="6.2.1 Introducing iterator blocks and yield return"></a>6.2.1 Introducing iterator blocks and yield return</h4><h4 id="6-2-2-Visualizing-an-iterator-workflow"><a href="#6-2-2-Visualizing-an-iterator-workflow" class="headerlink" title="6.2.2 Visualizing an iterator workflow"></a>6.2.2 Visualizing an iterator workflow</h4><blockquote>
<p>listing 6.6 showing the sequence of calls between an iterator and its caller</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">private static readonly string Padding = new string(&apos; &apos;, 30);</span><br><span class="line"></span><br><span class="line">        static IEnumerable&lt;int&gt; CreateEnumerable()</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;&#123;0&#125; Start of CreateEnumerable()&quot;,Padding);</span><br><span class="line">            for (int i = 0; i &lt; 3; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;&#123;0&#125; About to yield &#123;1&#125; &quot;,Padding,i);</span><br><span class="line">                yield return i;</span><br><span class="line">                Console.WriteLine(&quot;&#123;0&#125; After yield &quot;,Padding);</span><br><span class="line">            &#125;</span><br><span class="line">            Console.WriteLine(&quot;&#123;0&#125;Yielding final value&quot;,Padding);</span><br><span class="line">            yield return -1;</span><br><span class="line">            Console.WriteLine(&quot;&#123;0&#125; End of CreateEnumerable()&quot;,Padding);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            IEnumerable&lt;int&gt; iterable = CreateEnumerable();</span><br><span class="line">            IEnumerator&lt;int&gt; iterator = iterable.GetEnumerator();</span><br><span class="line">            Console.WriteLine(&quot;starting to iterate&quot;);</span><br><span class="line">            while (true)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;Calling Move NExt()...&quot;);</span><br><span class="line">                bool result = iterator.MoveNext();</span><br><span class="line">                Console.WriteLine(&quot;...MoveNext result=&#123;0&#125;&quot;,result);</span><br><span class="line">                if (!result)</span><br><span class="line">                &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                Console.WriteLine(&quot;Fetching Current...&quot;);</span><br><span class="line">                Console.WriteLine(&quot;...Current result=&#123;0&#125;&quot;,iterator.Current);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>None of the code in CreateEnumerable is called until the first call to MoveNext.</li>
<li>It is only when you call MoveNext that any real work gets done.Fetching Current doesn’t run any of your code</li>
<li>The code stops executing at yield return and picks up again just afterward at the next call to MoveNext</li>
<li>You can have multiple yield return statements in different places in the method</li>
<li>The code doesn’t end at the last yield return .Instead, the call to MoveNext that causes you toreach the end of the method is the one that returns false.</li>
</ul>
<h4 id="6-2-3-Advanced-iterator-execution-flow"><a href="#6-2-3-Advanced-iterator-execution-flow" class="headerlink" title="6.2.3 Advanced iterator execution flow"></a>6.2.3 Advanced iterator execution flow</h4><blockquote>
<p>listing6.6 Demonstration of yield break</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">static IEnumerable&lt;int&gt; CountWithTimeLimit(DateTime limit)</span><br><span class="line">        &#123;</span><br><span class="line">            for (int i = 1; i &lt; 100; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if (DateTime.Now &gt; limit)</span><br><span class="line">                &#123;</span><br><span class="line">                    yield break;</span><br><span class="line">                &#125;</span><br><span class="line">                yield return i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    DateTime stop = DateTime.Now.AddSeconds(2);</span><br><span class="line">            foreach (var i in CountWithTimeLimit(stop))</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;Received &#123;0&#125;&quot;,i);</span><br><span class="line">                Thread.Sleep(300);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing6.7 Demonstration of yield break working with try/finally</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="6-2-4-Quirks-in-the-implementation"><a href="#6-2-4-Quirks-in-the-implementation" class="headerlink" title="6.2.4 Quirks in the implementation"></a>6.2.4 Quirks in the implementation</h4><h3 id="6-3-Real-lifer-iterator-examples"><a href="#6-3-Real-lifer-iterator-examples" class="headerlink" title="6.3 Real-lifer iterator examples"></a>6.3 Real-lifer iterator examples</h3><h4 id="6-3-1-Iteration-over-the-dates-in-a-timetable"><a href="#6-3-1-Iteration-over-the-dates-in-a-timetable" class="headerlink" title="6.3.1 Iteration over the dates in a timetable"></a>6.3.1 Iteration over the dates in a timetable</h4><h4 id="6-3-2-Iterating-over-lines-in-a-file"><a href="#6-3-2-Iterating-over-lines-in-a-file" class="headerlink" title="6.3.2 Iterating over lines in a file"></a>6.3.2 Iterating over lines in a file</h4><blockquote>
<p>listing 6.8 Looping over the lines in a file using an iterator blcok</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">static IEnumerable&lt;string&gt; ReadLines(string filename)</span><br><span class="line">        &#123;</span><br><span class="line">            using (TextReader reader = File.OpenText(filename))</span><br><span class="line">            &#123;</span><br><span class="line">                string line;</span><br><span class="line">                while ((line = reader.ReadLine()) != null)</span><br><span class="line">                &#123;</span><br><span class="line">                    yield return line;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    foreach (var line in ReadLines(&quot;test.txt&quot;))</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(line);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-3-Filtering-items-lazily-using-an-iterator-block-and-a-predicate"><a href="#6-3-3-Filtering-items-lazily-using-an-iterator-block-and-a-predicate" class="headerlink" title="6.3.3 Filtering items lazily using an iterator block and a predicate"></a>6.3.3 Filtering items lazily using an iterator block and a predicate</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">public static IEnumerable&lt;T&gt; Where&lt;T&gt;(IEnumerable&lt;T&gt; source, Predicate&lt;T&gt; predicate)</span><br><span class="line">        &#123;</span><br><span class="line">            if (source == null || predicate == null)</span><br><span class="line">            &#123;</span><br><span class="line">                throw new ArgumentNullException(); //Eagerly checks arguments</span><br><span class="line">            &#125;</span><br><span class="line">            return WhereImpl(source, predicate);  //lazily processes data</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static IEnumerable&lt;T&gt; WhereImpl&lt;T&gt;(IEnumerable&lt;T&gt; source, Predicate&lt;T&gt; predicate)</span><br><span class="line">        &#123;</span><br><span class="line">            foreach (var item in source)</span><br><span class="line">            &#123;</span><br><span class="line">                if (predicate(item))  //Tests current item against predicate</span><br><span class="line">                &#123;</span><br><span class="line">                    yield return item;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">static IEnumerable&lt;string&gt; ReadLines(string filename)</span><br><span class="line">        &#123;</span><br><span class="line">            using (TextReader reader = File.OpenText(filename))</span><br><span class="line">            &#123;</span><br><span class="line">                string line;</span><br><span class="line">                while ((line = reader.ReadLine()) != null)</span><br><span class="line">                &#123;</span><br><span class="line">                    yield return line;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    IEnumerable&lt;string&gt; lines = ReadLines(&quot;../../FakeLinq.cs&quot;);</span><br><span class="line">            Predicate&lt;string&gt; predicate = ((x) =&gt; &#123; return x.StartsWith(&quot;using&quot;); &#125;);</span><br><span class="line">            foreach (var item in Where(lines,predicate))</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(item);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>我们将实现分为两部分: 参数验证和真正的过滤逻辑.假设将所有内容放在同一个方法里,那么调用<code>Where&lt;string&gt;(null,null)</code>时什么都不会发生</p>
<h3 id="6-4-Pseudo-synchronous-code-with-the-Concurrency-and-Coordination-Runtime"><a href="#6-4-Pseudo-synchronous-code-with-the-Concurrency-and-Coordination-Runtime" class="headerlink" title="6.4 Pseudo-synchronous code with the Concurrency and Coordination Runtime"></a>6.4 Pseudo-synchronous code with the Concurrency and Coordination Runtime</h3><p>skip but worth Reading</p>
<h3 id="6-5-Summary"><a href="#6-5-Summary" class="headerlink" title="6.5 Summary"></a>6.5 Summary</h3><h2 id="7-Concluding-C-2-the-final-features"><a href="#7-Concluding-C-2-the-final-features" class="headerlink" title="7 Concluding C#2 : the final features"></a>7 Concluding C#2 : the final features</h2><p>This chapter covers</p>
<ul>
<li>Partial types</li>
<li>Static classes</li>
<li>Separate getter/setter property access</li>
<li>Namespace aliases</li>
<li>Pragma directives</li>
<li>Fixed-size buffers</li>
<li>Friend assemblies</li>
</ul>
<h3 id="7-1-Patial-types"><a href="#7-1-Patial-types" class="headerlink" title="7.1 Patial types"></a>7.1 Patial types</h3><h3 id="7-2-Static-classes"><a href="#7-2-Static-classes" class="headerlink" title="7.2 Static classes"></a>7.2 Static classes</h3><p>工具类:</p>
<ul>
<li>所有的成员都是静态的(除了私有构造函数)</li>
<li>类直接从object派生</li>
<li>一般情况下不应该有状态,除非涉及高速缓存或单例</li>
<li>不能存在任何可见的构造函数</li>
<li>类可以是密封的(添加sealed修饰符</li>
</ul>
<blockquote>
<p>Listing 7.2 A partial method called from a constructor</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">partial class PartialMethodDemo</span><br><span class="line">    &#123;</span><br><span class="line">        public PartialMethodDemo()</span><br><span class="line">        &#123;</span><br><span class="line">            OnConstructorStart();</span><br><span class="line">            Console.WriteLine(&quot;Generated constructor&quot;);</span><br><span class="line">            OnConstructorEnd();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        partial void OnConstructorStart();</span><br><span class="line"></span><br><span class="line">        partial void OnConstructorEnd();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">partial class PartialMethodDemo</span><br><span class="line">    &#123;</span><br><span class="line">        partial void OnConstructorEnd()</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;Manual code&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 7.3 sealed class NonStarticStringHelper</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public sealed class NonStaticsStringHelper  // seals class to prevent derivation</span><br><span class="line">    &#123;</span><br><span class="line">        private NonStaticsStringHelper()  // Prevents instantiation from other code</span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static string Reverse(string input)  // All methods are static</span><br><span class="line">        &#123;</span><br><span class="line">            char[] chars = input.ToCharArray();</span><br><span class="line">            Array.Reverse(chars);</span><br><span class="line">            return new string(chars);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 7. 4  The same utility class as in listing 7.3 but converted into a c#2 static class</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public static class StringHelper</span><br><span class="line">    &#123;</span><br><span class="line">        public static string Reverse(string input)</span><br><span class="line">        &#123;</span><br><span class="line">            char[] chars = input.ToCharArray();</span><br><span class="line">            Array.Reverse(chars);</span><br><span class="line">            return new string(chars);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-3-Separate-getter-setter-property-access"><a href="#7-3-Separate-getter-setter-property-access" class="headerlink" title="7.3 Separate getter/setter property access"></a>7.3 Separate getter/setter property access</h3><blockquote>
<p>listing </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private string name;</span><br><span class="line"></span><br><span class="line">        public string Name</span><br><span class="line">        &#123;</span><br><span class="line">            get &#123; return name; &#125;</span><br><span class="line">            private set</span><br><span class="line">            &#123;</span><br><span class="line">                name = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-4-Namespace-class"><a href="#7-4-Namespace-class" class="headerlink" title="7.4 Namespace class"></a>7.4 Namespace class</h3><p>在C#2中,有三种别名种类: C#1 的命名空间别名/ 全局命名空间别名和外部别名.</p>
<blockquote>
<p>listing 7.5 Using aliases to distinguish between different button types</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">using WinForms = System.Windows.Forms;</span><br><span class="line">using WebForms = System.Web.UI.WebControls;</span><br><span class="line"></span><br><span class="line">static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(typeof(WinForms.Button));</span><br><span class="line">            Console.WriteLine(typeof(WinForms.Button));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 7.6 use : : to tell the compiler to use aliases</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">using WinForms = System.Windows.Forms;</span><br><span class="line">using WebForms = System.Web.UI.WebControls;</span><br><span class="line">class WinForms &#123; &#125;</span><br><span class="line">    class Program</span><br><span class="line">    &#123;</span><br><span class="line">        static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(typeof(WinForms::Button));</span><br><span class="line">            Console.WriteLine(typeof(WinForms::Button));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-4-2-The-global-namespace-alias"><a href="#7-4-2-The-global-namespace-alias" class="headerlink" title="7.4.2 The global namespace alias"></a>7.4.2 The global namespace alias</h4><blockquote>
<p>listing 7.7 Use of the global namespace alias to specify the desired type exactly</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class Configuration &#123; &#125;</span><br><span class="line"></span><br><span class="line">namespace Learn</span><br><span class="line">&#123;</span><br><span class="line">    class Configuration &#123; &#125;</span><br><span class="line">    class WriteAny</span><br><span class="line">    &#123;</span><br><span class="line">        private static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(typeof(Configuration));</span><br><span class="line">            Console.WriteLine(typeof(global::Configuration));</span><br><span class="line">            Console.WriteLine(typeof(global::Learn.WriteAny));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-4-3-Extern-aliases"><a href="#7-4-3-Extern-aliases" class="headerlink" title="7.4.3 Extern aliases"></a>7.4.3 Extern aliases</h4><p>Mark!</p>
<blockquote>
<p>listing 7.8 Working with different types of the same type in different assemblies</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">extern alias FirstAlias;</span><br><span class="line">extern alias SecondAlias;</span><br><span class="line">using FD = FirstAlias::Demo;</span><br><span class="line"></span><br><span class="line">static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(typeof(FD.Example));</span><br><span class="line">            Console.WriteLine(typeof(SecondAlias::Demo.Example));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-5-Pragma-directives"><a href="#7-5-Pragma-directives" class="headerlink" title="7.5 Pragma directives"></a>7.5 Pragma directives</h3><h4 id="7-5-1-Warning-pragmas"><a href="#7-5-1-Warning-pragmas" class="headerlink" title="7.5.1 Warning pragmas"></a>7.5.1 Warning pragmas</h4><p>有时候你需要忽略一个警告</p>
<blockquote>
<p>listing 7.9 Class containing an unused field</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class FieldUsedOnlyByReflection</span><br><span class="line">    &#123;</span><br><span class="line">#pragma warning disable 169</span><br><span class="line">        private int x;</span><br><span class="line">#pragma warning restore 169</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-5-2-Checksum-pragmas"><a href="#7-5-2-Checksum-pragmas" class="headerlink" title="7.5.2 Checksum pragmas"></a>7.5.2 Checksum pragmas</h4><p>Skip</p>
<h3 id="7-6-Fixed-size-buffers-in-unsafe-code"><a href="#7-6-Fixed-size-buffers-in-unsafe-code" class="headerlink" title="7.6 Fixed-size buffers in unsafe code"></a>7.6 Fixed-size buffers in unsafe code</h3><p>UnSafe   </p>
<p><code>fixed byte data[20]</code></p>
<blockquote>
<p>listing 7.11 Demonstration of fixed-size buffers to obtain console color information</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">namespace Fixedsizebuffers</span><br><span class="line">&#123;</span><br><span class="line">    using System;</span><br><span class="line">    using System.Runtime.InteropServices;</span><br><span class="line"></span><br><span class="line">    struct COORD</span><br><span class="line">&#123;</span><br><span class="line">    public short X, Y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct SMALL_RECT</span><br><span class="line">&#123;</span><br><span class="line">    public short Left, Top, Right, Bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsafe struct CONSOLE_SCREEN_BUFFER_INFOEX</span><br><span class="line">&#123;</span><br><span class="line">    public int StructureSize;</span><br><span class="line">    public COORD ConsoleSize, CursorPosition;</span><br><span class="line"></span><br><span class="line">    public short Attributes;</span><br><span class="line"></span><br><span class="line">    public SMALL_RECT DisplayWindow;</span><br><span class="line">    public COORD MaximumWindowSize;</span><br><span class="line"></span><br><span class="line">    public int FullScreenSupported;</span><br><span class="line"></span><br><span class="line">    public fixed int ColorTable[16];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    static class FixedSizeBufferDemo</span><br><span class="line">    &#123;</span><br><span class="line">        private const int StdOutputHandle = -11;</span><br><span class="line"></span><br><span class="line">        [DllImport(&quot;kernel32.dll&quot;)]</span><br><span class="line">        static extern IntPtr GetStdHandle(int nStdHandle);</span><br><span class="line"></span><br><span class="line">        [DllImport(&quot;kernel32.dll&quot;)]</span><br><span class="line">        static extern bool GetConsoleScreenBufferInfoEx(IntPtr handle, ref CONSOLE_SCREEN_BUFFER_INFOEX info);</span><br><span class="line">        unsafe static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            IntPtr handle = GetStdHandle(StdOutputHandle);</span><br><span class="line">            CONSOLE_SCREEN_BUFFER_INFOEX info;</span><br><span class="line">            info = new CONSOLE_SCREEN_BUFFER_INFOEX();</span><br><span class="line">            info.StructureSize = sizeof(CONSOLE_SCREEN_BUFFER_INFOEX);</span><br><span class="line">            GetConsoleScreenBufferInfoEx(handle, ref info);</span><br><span class="line">            for (int i = 0; i &lt; 16; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;&#123;0:x6&#125;&quot;,info.ColorTable[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-7-Exposing-internal-members-to-selected-assemblies"><a href="#7-7-Exposing-internal-members-to-selected-assemblies" class="headerlink" title="7.7 Exposing internal members to selected assemblies"></a>7.7 Exposing internal members to selected assemblies</h3><blockquote>
<p>Listing 7.11 Demonstration of fixed-size bufer to obtain console color information</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//Compiled to Source.dll</span><br><span class="line">using System.Runtime.CompilerServices;</span><br><span class="line">[assembly:InternalsVisibleTo(&quot;FriendAssembly&quot;)] //授予额外的访问权限</span><br><span class="line"></span><br><span class="line">public class Source</span><br><span class="line">&#123;</span><br><span class="line">    internal static void InternalMethod() &#123; &#125;</span><br><span class="line">    public static void PublicMethod() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//COmpiled to FriendAssembly.dll</span><br><span class="line">public class Friend</span><br><span class="line">&#123;</span><br><span class="line">    static void Main()</span><br><span class="line">    &#123;</span><br><span class="line">        Source.InternalMethod();    //在FriendAssembly中使用额外的访问权限</span><br><span class="line">        Source.PublicMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//Compiled to EnemyAssembly.dll</span><br><span class="line">public class Enemy</span><br><span class="line">&#123;</span><br><span class="line">    static void Main()</span><br><span class="line">    &#123;</span><br><span class="line">        //Source.InternalMethod();</span><br><span class="line">        Source.PublicMethod();   //EnemyAssembly不具备特殊的访问权限 依旧可以正常访问公有方法.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-7-1-Friend-assemblies-in-the-simple-selected-assemblies"><a href="#7-7-1-Friend-assemblies-in-the-simple-selected-assemblies" class="headerlink" title="7.7.1 Friend assemblies in the simple selected assemblies"></a>7.7.1 Friend assemblies in the simple selected assemblies</h4><h4 id="7-7-2-Why-use-InternalsVisibleTo"><a href="#7-7-2-Why-use-InternalsVisibleTo" class="headerlink" title="7.7.2 Why use InternalsVisibleTo"></a>7.7.2 Why use InternalsVisibleTo</h4><h4 id="7-7-3-InternalsVisibleTO-and-signed-assemblies"><a href="#7-7-3-InternalsVisibleTO-and-signed-assemblies" class="headerlink" title="7.7.3 InternalsVisibleTO and signed assemblies"></a>7.7.3 InternalsVisibleTO and signed assemblies</h4><h3 id="7-8-Summary"><a href="#7-8-Summary" class="headerlink" title="7.8 Summary"></a>7.8 Summary</h3><p>总结 一句 按需查找</p>
<h2 id="8-Cutting-fluff-with-a-smart-compiler"><a href="#8-Cutting-fluff-with-a-smart-compiler" class="headerlink" title="8 Cutting fluff with a smart compiler"></a>8 Cutting fluff with a smart compiler</h2><ul>
<li>Automatically implemented properties</li>
<li>Implicitly typed local variables</li>
<li>Object and collection initializers</li>
<li>Implicitly typed arrays</li>
<li>Anonymous types</li>
</ul>
<h3 id="8-1-Automatically-implemented-properties"><a href="#8-1-Automatically-implemented-properties" class="headerlink" title="8.1 Automatically implemented properties"></a>8.1 Automatically implemented properties</h3><p>安全但是没有什么卵用的静态自动属性</p>
<blockquote>
<p>listing8.1 Counting instances awkwardly with a static automatic property</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class Person</span><br><span class="line">    &#123;</span><br><span class="line">        public string Name &#123; get; private set; &#125;  //Declares properties with public getters</span><br><span class="line">        public int Age &#123; get; private set; &#125;</span><br><span class="line">        private static int InstanceCounter &#123; get; set; &#125;  //Declares private static property and lock</span><br><span class="line"></span><br><span class="line">        private static readonly object counterLock = new object();</span><br><span class="line"></span><br><span class="line">        public InstanceCountingPerson(string name, int age)</span><br><span class="line">        &#123;</span><br><span class="line">            Name = name;</span><br><span class="line">            Age = age;</span><br><span class="line">            lock (counterLock)   //Uses lock for safe property access</span><br><span class="line">            &#123;</span><br><span class="line">                InstanceCounter++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-2-Implicit-typing-of-local-variables"><a href="#8-2-Implicit-typing-of-local-variables" class="headerlink" title="8.2 Implicit typing of local variables"></a>8.2 Implicit typing of local variables</h3><p>var variableName = someInitialValue;</p>
<p>此处为推断类型 而不是动态类型</p>
<h4 id="8-2-1-Using-var-to-declare-a-local-variable"><a href="#8-2-1-Using-var-to-declare-a-local-variable" class="headerlink" title="8.2.1 Using var to declare a local variable"></a>8.2.1 Using var to declare a local variable</h4><h4 id="8-2-2-Restrictions-on-implicit-typing"><a href="#8-2-2-Restrictions-on-implicit-typing" class="headerlink" title="8.2.2 Restrictions on implicit typing"></a>8.2.2 Restrictions on implicit typing</h4><p>使用隐式类型的限制</p>
<ul>
<li>被声明的变量是一个局部变量,而不是静态字段和实例字段</li>
<li>变量在声明的同时被初始化</li>
<li>初始化表达式不是方法组,也不是匿名函数</li>
<li>初始化表达式不是null</li>
<li>语句中只声明了一个变量</li>
<li>你希望变量拥有的类型是初始化表达式的编译时类型</li>
<li>初始化表达式不包含正在声明的变量</li>
</ul>
<p><strong>用方法调用的结果来初始化一个变量可能是隐式类型最常用的应用</strong></p>
<h4 id="8-2-3-Pros-and-cons-of-implicit-typing"><a href="#8-2-3-Pros-and-cons-of-implicit-typing" class="headerlink" title="8.2.3 Pros and cons of implicit typing"></a>8.2.3 Pros and cons of implicit typing</h4><p>主要是为了可读性</p>
<ul>
<li>如果让读代码的人以沿就能看出变量的类型很重要 ,就用显式类型</li>
<li>如果变量直接用一个构造函数初始化,并且类型名很长,就考虑使用隐式类型.</li>
<li>如果变量的确切类型不重要,就用隐式类型</li>
<li>在开发新项目的时候,与团队成员进行商议</li>
<li>如有疑虑,两种方式都写写,用舒服的</li>
</ul>
<h4 id="8-2-4-Recommendations"><a href="#8-2-4-Recommendations" class="headerlink" title="8.2.4 Recommendations"></a>8.2.4 Recommendations</h4><h3 id="8-3-Simplified-initialization"><a href="#8-3-Simplified-initialization" class="headerlink" title="8.3 Simplified initialization"></a>8.3 Simplified initialization</h3><h4 id="8-3-1-Defining-some-sample-types"><a href="#8-3-1-Defining-some-sample-types" class="headerlink" title="8.3.1 Defining some sample types"></a>8.3.1 Defining some sample types</h4><blockquote>
<p>listing8.2  A fairly simple Person class used for further demonstrations</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class Person</span><br><span class="line">    &#123;</span><br><span class="line">        public string Name &#123; get; private set; &#125; </span><br><span class="line">        public int Age &#123; get; private set; &#125;</span><br><span class="line"></span><br><span class="line">        private List&lt;Person&gt; friends = new List&lt;Person&gt;();</span><br><span class="line">        public List&lt;Person&gt; Friends &#123;</span><br><span class="line">            get</span><br><span class="line">            &#123;</span><br><span class="line">                return friends;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private Location home = new Location();</span><br><span class="line">        public Location Home &#123; get &#123; return home; &#125; &#125;</span><br><span class="line">        public Person() &#123; &#125;</span><br><span class="line"></span><br><span class="line">        public Person(string name)</span><br><span class="line">        &#123;</span><br><span class="line">            Name = name;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Location</span><br><span class="line">    &#123;</span><br><span class="line">        public string Country &#123; get; set; &#125;</span><br><span class="line">        public string Town &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-3-2-Setting-simple-properties"><a href="#8-3-2-Setting-simple-properties" class="headerlink" title="8.3.2 Setting simple properties"></a>8.3.2 Setting simple properties</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Person tom = new Person(&quot;Tom&quot;)</span><br><span class="line">&#123;</span><br><span class="line">    Age = 9;</span><br><span class="line">    Home = &#123;Country =&quot;UK&quot;, Town=&quot;Reading&quot;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="8-3-3-Setting-properties-on-embedded-objects"><a href="#8-3-3-Setting-properties-on-embedded-objects" class="headerlink" title="8.3.3 Setting properties on embedded objects"></a>8.3.3 Setting properties on embedded objects</h4><h4 id="8-3-4-Collection-initializers"><a href="#8-3-4-Collection-initializers" class="headerlink" title="8.3.4 Collection initializers"></a>8.3.4 Collection initializers</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var names = new List&lt;string&gt; &#123; &quot;Holly&quot;, &quot;Jon&quot;, &quot;Tom&quot;, &quot;Robin&quot;, &quot;William&quot; &#125;;</span><br><span class="line">var nameAgeMap = new Dictionary&lt;string, int&gt; &#123; &#123; &quot;Holly&quot;, 35 &#125;, &#123; &quot;Jon&quot;, 26 &#125;, &#123; &quot;Tom&quot;, 9 &#125; &#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 8.3  Building up a rich object using object and collection initializers</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Person tom = new Person</span><br><span class="line">                             &#123;</span><br><span class="line">                                 Name =&quot;Tom&quot;,</span><br><span class="line">                                 Age=9,</span><br><span class="line">                                 Home = &#123;Town =&quot;Reading&quot;,Country =&quot;UK&quot;&#125;,</span><br><span class="line">                                 Friends=</span><br><span class="line">                                     &#123;</span><br><span class="line">                                         new Person&#123;Name = &quot;Alberto&quot;&#125;,</span><br><span class="line">                                         new Person(&quot;Max&quot;),</span><br><span class="line">                                         new Person&#123;Name =&quot;Zak&quot;,Age=7&#125;,</span><br><span class="line">                                         new Person(&quot;Ben&quot;),</span><br><span class="line">                                         new Person(&quot;Alice&quot;)</span><br><span class="line">                                         &#123;</span><br><span class="line">                                             Age=9,</span><br><span class="line">                                             Home=&#123;Town=&quot;Twyford&quot;,Country=&quot;UK&quot;&#125;</span><br><span class="line">                                         &#125;</span><br><span class="line">                                     &#125;</span><br><span class="line">                             &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="8-3-5-Uses-of-initialization-features"><a href="#8-3-5-Uses-of-initialization-features" class="headerlink" title="8.3.5 Uses of initialization features"></a>8.3.5 Uses of initialization features</h4><h3 id="8-4-Implicitly-typed-arrays"><a href="#8-4-Implicitly-typed-arrays" class="headerlink" title="8.4 Implicitly typed arrays"></a>8.4 Implicitly typed arrays</h3><p><code>MyMethod({&quot;Holly&quot;,&quot;Jon&quot;,&quot;Tom&quot;,&quot;Robin&quot;,&quot;William&quot;})</code></p>
<h3 id="8-5-Anonymous-types"><a href="#8-5-Anonymous-types" class="headerlink" title="8.5 Anonymous types"></a>8.5 Anonymous types</h3><blockquote>
<p>Listing 8.4 Creating objects of an anonymous type with Name and Age properties</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var tom = new &#123;Name =&quot;Tom&quot;,Age=9&#125;;</span><br><span class="line">var holly = new &#123;Name = &quot;Holly&quot;,Age=36&#125;;</span><br><span class="line">var jon = new &#123;Name = &quot;Jon&quot;,Age=36&#125;;</span><br><span class="line">System.Console.WriteLine(&quot;&#123;0&#125; is &#123;1&#125; years old&quot;,jon.Name,jon.Age);</span><br></pre></td></tr></table></figure>
<h4 id="8-5-1-First-encounters-of-the-anonymous-kind"><a href="#8-5-1-First-encounters-of-the-anonymous-kind" class="headerlink" title="8.5.1 First encounters of the anonymous kind"></a>8.5.1 First encounters of the anonymous kind</h4><blockquote>
<p>Listing 8.5 Populatio an array using anonymous types and then finding the total age</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var family = new []</span><br><span class="line">&#123;</span><br><span class="line">    new &#123; Name =&quot;Holly&quot;, Age = 36 &#125;,</span><br><span class="line">    new &#123; Name =&quot;Jon&quot;, Age =36 &#125;,</span><br><span class="line">    new &#123; Name =&quot;Tom&quot;, Age = 9 &#125;,</span><br><span class="line">    new &#123; Name = &quot;Robin&quot;, Age = 6 &#125;,</span><br><span class="line">    new &#123; Name = &quot;William&quot; , Age = 6 &#125;</span><br><span class="line">&#125;;</span><br><span class="line">int totalAge = 0;</span><br><span class="line">foreach (var person in family)</span><br><span class="line">&#123;</span><br><span class="line">    totalAge +=person.Age;</span><br><span class="line">&#125;</span><br><span class="line">System.Console.WriteLine(&quot;Total Age : &#123;0&#125;&quot;,totalAge);</span><br></pre></td></tr></table></figure>
<h4 id="8-5-2-members-of-anonymous-types"><a href="#8-5-2-members-of-anonymous-types" class="headerlink" title="8.5.2 members of anonymous types"></a>8.5.2 members of anonymous types</h4><h4 id="8-5-3-Projection-initializers"><a href="#8-5-3-Projection-initializers" class="headerlink" title="8.5.3 Projection initializers"></a>8.5.3 Projection initializers</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; family = new List&lt;Person&gt;                 </span><br><span class="line">            &#123;</span><br><span class="line">                new Person &#123; Name=&quot;Holly&quot;, Age=37 &#125;,</span><br><span class="line">                new Person &#123; Name=&quot;Jon&quot;, Age=36 &#125;,</span><br><span class="line">                new Person &#123; Name=&quot;Tom&quot;, Age=9 &#125;,</span><br><span class="line">                new Person &#123; Name=&quot;Robin&quot;, Age=6 &#125;,</span><br><span class="line">                new Person &#123; Name=&quot;William&quot;, Age=6 &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            var converted = family.ConvertAll(delegate(Person person)</span><br><span class="line">                &#123; return new &#123; person.Name, IsAdult = (person.Age &gt;= 18) &#125;; &#125;</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            foreach (var person in converted)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;&#123;0&#125; is an adult? &#123;1&#125;&quot;,</span><br><span class="line">                                  person.Name, person.IsAdult);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-5-4-What’s-the-point"><a href="#8-5-4-What’s-the-point" class="headerlink" title="8.5.4 What’s the point?"></a>8.5.4 What’s the point?</h4><h3 id="8-6-Summary"><a href="#8-6-Summary" class="headerlink" title="8.6 Summary"></a>8.6 Summary</h3><h2 id="9-Lambda-expressions-and-expression-trees"><a href="#9-Lambda-expressions-and-expression-trees" class="headerlink" title="9  Lambda expressions and expression trees"></a>9  Lambda expressions and expression trees</h2><h4 id="9-1-2-First-transformatio-to-a-lambda-expression"><a href="#9-1-2-First-transformatio-to-a-lambda-expression" class="headerlink" title="9.1.2 First transformatio to a lambda expression"></a>9.1.2 First transformatio to a lambda expression</h4><blockquote>
<p>list 9.1 Using an anonymous method to create a delegate instance</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;string,int&gt; returnLength;</span><br><span class="line">returnLength = delegate(string text)&#123;return text.Length;&#125;;</span><br><span class="line">Console.WriteLine(returnLength(&quot;Hello&quot;));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>list 9.2 A long-winded first lambda expression,similar to an anonymous method</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;string,int&gt; returnLength;</span><br><span class="line">returnLength = (string text)=&gt;&#123;return text.Length;&#125;;</span><br><span class="line">Console.WriteLine(returnLength(&quot;Hello&quot;));</span><br></pre></td></tr></table></figure>
<p><img src="C:\Users\Neuracle\Documents\我的坚果云\Learn\Learn EveryDay\RawPic\a003.png" alt=""></p>
<h3 id="9-2-Simple-examples-using-List-lt-T-gt-and-events"><a href="#9-2-Simple-examples-using-List-lt-T-gt-and-events" class="headerlink" title="9.2 Simple examples using List&lt;T&gt; and events"></a>9.2 Simple examples using List<code>&lt;T&gt;</code> and events</h3><h4 id="9-2-1-Filtering-sorting-and-actions-on-lists"><a href="#9-2-1-Filtering-sorting-and-actions-on-lists" class="headerlink" title="9.2.1 Filtering ,sorting,and actions on lists"></a>9.2.1 Filtering ,sorting,and actions on lists</h4><blockquote>
<p>listing 9.4 Manipulation a list of films using lambda expressions</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">class Film</span><br><span class="line">&#123;</span><br><span class="line">    public string Name &#123; get; set; &#125;</span><br><span class="line">    public int Year &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">var films = new List&lt;Film&gt;</span><br><span class="line">&#123;</span><br><span class="line">    new Film &#123;Name=&quot;Jaws&quot;, Year=1975&#125;,</span><br><span class="line">    new Film &#123;Name=&quot;Singing in the Rain&quot;, Year=1952&#125;,</span><br><span class="line">    new Film &#123;Name=&quot;Some like it Hot&quot;, Year=1959&#125;,</span><br><span class="line">    new Film &#123;Name=&quot;The Wizard of Oz&quot;, Year=1939&#125;,</span><br><span class="line">    new Film &#123;Name=&quot;It&apos;s a Wonderful Life&quot;, Year=1946&#125;,</span><br><span class="line">    new Film &#123;Name=&quot;American Beauty&quot;, Year=1999&#125;,</span><br><span class="line">    new Film &#123;Name=&quot;High Fidelity&quot;, Year=2000&#125;,</span><br><span class="line">    new Film &#123;Name=&quot;The Usual Suspects&quot;, Year=1995&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Action&lt;Film&gt; print =</span><br><span class="line">    film =&gt; Console.WriteLine(&quot;Name=&#123;0&#125;, Year=&#123;1&#125;&quot;, film.Name, film.Year);</span><br><span class="line"></span><br><span class="line">// Note: extra lines added for clarity when running</span><br><span class="line">Console.WriteLine(&quot;All films&quot;);</span><br><span class="line">films.ForEach(print);</span><br><span class="line">Console.WriteLine();</span><br><span class="line"></span><br><span class="line">Console.WriteLine(&quot;Oldies&quot;);</span><br><span class="line">films.FindAll(film =&gt; film.Year &lt; 1960)</span><br><span class="line">     .ForEach(print);</span><br><span class="line">Console.WriteLine();</span><br><span class="line"></span><br><span class="line">Console.WriteLine(&quot;Sorted&quot;);</span><br><span class="line">films.Sort((f1, f2) =&gt; f1.Name.CompareTo(f2.Name));</span><br><span class="line">films.ForEach(print);</span><br></pre></td></tr></table></figure>
<h4 id="9-2-2-Logging-in-an-event-handler"><a href="#9-2-2-Logging-in-an-event-handler" class="headerlink" title="9.2.2 Logging in an event handler"></a>9.2.2 Logging in an event handler</h4><blockquote>
<p>Listing9.5 Logging events using lambda expressions</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">static void Log(string title, object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;Event: &#123;0&#125;&quot;, title);</span><br><span class="line">    Console.WriteLine(&quot;  Sender: &#123;0&#125;&quot;, sender);</span><br><span class="line">    Console.WriteLine(&quot;  Arguments: &#123;0&#125;&quot;, e.GetType());</span><br><span class="line">    foreach (PropertyDescriptor prop in</span><br><span class="line">             TypeDescriptor.GetProperties(e))</span><br><span class="line">    &#123;</span><br><span class="line">        string name = prop.DisplayName;</span><br><span class="line">        object value = prop.GetValue(e);</span><br><span class="line">        Console.WriteLine(&quot;    &#123;0&#125;=&#123;1&#125;&quot;, name, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Button button = new Button();</span><br><span class="line">button.Text = &quot;Click me&quot;;</span><br><span class="line">button.Click += (src, e) =&gt; Log(&quot;Click&quot;, src, e);</span><br><span class="line">button.KeyPress += (src, e) =&gt; Log(&quot;KeyPress&quot;, src, e);</span><br><span class="line">button.MouseClick += (src, e) =&gt; Log(&quot;MouseClick&quot;, src, e);</span><br><span class="line"></span><br><span class="line">Form form = new Form();</span><br><span class="line">form.AutoSize = true;</span><br><span class="line">form.Controls.Add(button);</span><br><span class="line">Application.Run(form);</span><br></pre></td></tr></table></figure>
<h3 id="9-3-Expression-trees"><a href="#9-3-Expression-trees" class="headerlink" title="9.3 Expression trees"></a>9.3 Expression trees</h3><h4 id="9-3-1-Building-expressiono-trees-programmatically"><a href="#9-3-1-Building-expressiono-trees-programmatically" class="headerlink" title="9.3.1 Building expressiono trees programmatically"></a>9.3.1 Building expressiono trees programmatically</h4><blockquote>
<p>listing 9.6 A simple expression tree ,adding 2 and 3;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Expression firstArg = Expression.Constant(2);</span><br><span class="line">            Expression secondArg = Expression.Constant(3);</span><br><span class="line">            Expression add = Expression.Add(firstArg, secondArg);</span><br><span class="line">            Console.WriteLine(add);</span><br></pre></td></tr></table></figure>
<h4 id="9-3-2-Compiling-expression-trees-into-delegates"><a href="#9-3-2-Compiling-expression-trees-into-delegates" class="headerlink" title="9.3.2 Compiling expression trees into delegates"></a>9.3.2 Compiling expression trees into delegates</h4><blockquote>
<p>listing 9.7 Compiling and executing an expression tree</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Expression firstArg = Expression.Constant(2);</span><br><span class="line">            Expression secondArg = Expression.Constant(3);</span><br><span class="line">            Expression add = Expression.Add(firstArg, secondArg);</span><br><span class="line"></span><br><span class="line">            Func&lt;int&gt; compiled = Expression.Lambda&lt;Func&lt;int&gt;&gt;(add).Compile();</span><br><span class="line">            Console.WriteLine(compiled());</span><br></pre></td></tr></table></figure>
<h4 id="9-3-3-COnverting-C-lambda-expressions-to-expression-trees"><a href="#9-3-3-COnverting-C-lambda-expressions-to-expression-trees" class="headerlink" title="9.3.3 COnverting C# lambda expressions to expression trees"></a>9.3.3 COnverting C# lambda expressions to expression trees</h4><blockquote>
<p>listing 9.8 Compliing and executing an expression tree</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Expression&lt;Func&lt;int&gt;&gt; return5 = () =&gt; 5;</span><br><span class="line">            Func&lt;int&gt; compiled = return5.Compile();</span><br><span class="line">            Console.WriteLine(compiled());</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 9.9 Demonstration of a more complicated expression tree</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Expression&lt;Func&lt;string, string, bool&gt;&gt; expression = (x, y) =&gt; x.StartsWith(y);</span><br><span class="line">            var compiled = expression.Compile();</span><br><span class="line">            Console.WriteLine(compiled(&quot;First&quot;,&quot;Second&quot;));</span><br><span class="line">            Console.WriteLine(compiled(&quot;First&quot;,&quot;Fir&quot;));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 9.10 Building a method call expression tree in code</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MethodInfo method = typeof(string).GetMethod(&quot;StartsWith&quot;, new[] &#123; typeof(string) &#125;);</span><br><span class="line">            var target = Expression.Parameter(typeof(string), &quot;x&quot;);</span><br><span class="line">            var methodArg = Expression.Parameter(typeof(string), &quot;y&quot;);</span><br><span class="line">            Expression[] methodArgs = new[] &#123; methodArg &#125;;</span><br><span class="line"></span><br><span class="line">            Expression call = Expression.Call(target, method, methodArgs);</span><br><span class="line"></span><br><span class="line">            var lambdaParameters = new[] &#123; target, methodArg &#125;;</span><br><span class="line">            var lambda = Expression.Lambda&lt;Func&lt;string, string, bool&gt;&gt;(call, lambdaParameters);</span><br><span class="line"></span><br><span class="line">            var compiled = lambda.Compile();</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(compiled(&quot;First&quot;, &quot;Second&quot;));</span><br><span class="line">            Console.WriteLine(compiled(&quot;First&quot;, &quot;Fir&quot;));</span><br></pre></td></tr></table></figure>
<h4 id="9-3-4-Expression-trees-at-the-heart-of-LINQ"><a href="#9-3-4-Expression-trees-at-the-heart-of-LINQ" class="headerlink" title="9.3.4 Expression trees at the heart of LINQ"></a>9.3.4 Expression trees at the heart of LINQ</h4><h4 id="9-3-5-Expression-trees-beyond-LINQ"><a href="#9-3-5-Expression-trees-beyond-LINQ" class="headerlink" title="9.3.5 Expression trees beyond LINQ"></a>9.3.5 Expression trees beyond LINQ</h4><h3 id="9-4-Changes-to-type-inference-and-overload-resolution"><a href="#9-4-Changes-to-type-inference-and-overload-resolution" class="headerlink" title="9.4  Changes to type inference and overload resolution"></a>9.4  Changes to type inference and overload resolution</h3><h4 id="9-4-1-Reasons-for-change-streamlining-generic-method-calls"><a href="#9-4-1-Reasons-for-change-streamlining-generic-method-calls" class="headerlink" title="9.4.1 Reasons for change: streamlining generic method calls"></a>9.4.1 Reasons for change: streamlining generic method calls</h4><blockquote>
<p>listing 9.11 Example of code requiring the new type inference rules</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">static void PrintConvertedValue&lt;TInput,TOutput&gt;</span><br><span class="line">            (TInput input,Converter&lt;TInput,TOutput&gt; converter)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(converter(input));</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    PrintConvertedValue(&quot;I am a string&quot;, x =&gt; x.Length);</span><br></pre></td></tr></table></figure>
<h4 id="9-4-2-Inferred-return-types-of-anonymous-functions"><a href="#9-4-2-Inferred-return-types-of-anonymous-functions" class="headerlink" title="9.4.2 Inferred return types of anonymous functions"></a>9.4.2 Inferred return types of anonymous functions</h4><blockquote>
<p>listing 9.12 Attempting to infer the return type of an anonymous method</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delegate T MyFunc&lt;T&gt;();</span><br><span class="line">        static void WriteResult&lt;T&gt;(MyFunc&lt;T&gt; function)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(function());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    WriteResult(delegate &#123; return 5; &#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 9.13 Code returning an integer or an object depending on the time of day</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delegate T MyFunc&lt;T&gt;();</span><br><span class="line">        static void WriteResult&lt;T&gt;(MyFunc&lt;T&gt; function)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(function());</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="9-4-3-Two-phase-type-inference"><a href="#9-4-3-Two-phase-type-inference" class="headerlink" title="9.4.3 Two-phase type inference"></a>9.4.3 Two-phase type inference</h4><blockquote>
<p>listing 9.14 Flexible type inference combining information from multiple arguments</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static void PrintType&lt;T&gt;(T first, T second)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(typeof(T));</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">    PrintType(1,new object());</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 9.15 Multistage type inferenct</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">static void ConvertTwice&lt;TInput, TMiddle, TOutput&gt;(</span><br><span class="line">            TInput input,</span><br><span class="line">            Converter&lt;TInput, TMiddle&gt;firstConversion,</span><br><span class="line">            Converter&lt;TMiddle, TOutput&gt;secondConversion)</span><br><span class="line">        &#123;</span><br><span class="line">            TMiddle middle = firstConversion(input);</span><br><span class="line">            TOutput output = secondConversion(middle);</span><br><span class="line">            Console.WriteLine(output);</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    ConvertTwice(&quot;Another string&quot;, text =&gt; text.Length, length =&gt; Math.Sqrt(length));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 9.16 Sample of overloading choice influenced by delgate return type</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">static void Execute(Func&lt;int&gt; action)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;action returns an int: &quot; + action());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static void Execute(Func&lt;double&gt; action)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;action returns a double: &quot; + action());</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    Execute(()=&gt;1);</span><br></pre></td></tr></table></figure>
<h4 id="9-4-4-Picking-the-right-overloaded-method"><a href="#9-4-4-Picking-the-right-overloaded-method" class="headerlink" title="9.4.4 Picking the right overloaded method"></a>9.4.4 Picking the right overloaded method</h4><h4 id="9-4-5-Wrapping-up-tpe-inference-and-overload-resolution"><a href="#9-4-5-Wrapping-up-tpe-inference-and-overload-resolution" class="headerlink" title="9.4.5 Wrapping up tpe inference and overload resolution"></a>9.4.5 Wrapping up tpe inference and overload resolution</h4><h3 id="9-5-Summary"><a href="#9-5-Summary" class="headerlink" title="9.5 Summary"></a>9.5 Summary</h3><h2 id="10-Extension-methods"><a href="#10-Extension-methods" class="headerlink" title="10 Extension methods"></a>10 Extension methods</h2><p>This chapter covers</p>
<ul>
<li>Writing extension methods</li>
<li>Calling extension methods</li>
<li>Method chaining</li>
<li>Extension methods in .net 3.5</li>
<li>Other uses for extension methods</li>
</ul>
<h3 id="10-1-Life-before-extension-methods"><a href="#10-1-Life-before-extension-methods" class="headerlink" title="10.1 Life before extension methods"></a>10.1 Life before extension methods</h3><blockquote>
<p>listing 10.1 A simple utility class to provide extra functionality for streams</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class StreamUtil</span><br><span class="line">    &#123;</span><br><span class="line">        private const int BufferSize = 8192;</span><br><span class="line"></span><br><span class="line">        public static void Copy(Stream input, Stream output)</span><br><span class="line">        &#123;</span><br><span class="line">            byte[] buffer = new byte[BufferSize];</span><br><span class="line">            int read;</span><br><span class="line">            while ((read = input.Read(buffer, 0, buffer.Length)) &gt; 0)</span><br><span class="line">            &#123;</span><br><span class="line">                output.Write(buffer, 0, read);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static byte[] ReadFully(Stream input)</span><br><span class="line">        &#123;</span><br><span class="line">            using (MemoryStream tempStream = new MemoryStream())</span><br><span class="line">            &#123;</span><br><span class="line">                &#123;</span><br><span class="line">                    Copy(input, tempStream);</span><br><span class="line">                    return tempStream.ToArray();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 10.2 Using StreamUtil to copy a web response stream to a file</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            WebRequest request = WebRequest.Create(&quot;http://www.baidu.com&quot;);</span><br><span class="line">            using (WebResponse response = request.GetResponse())</span><br><span class="line">            using (Stream responseStream = response.GetResponseStream())</span><br><span class="line">            using (FileStream output = File.Create(&quot;response.dat&quot;))</span><br><span class="line">            &#123;</span><br><span class="line">                StreamUtil.Copy(responseStream, output);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-2-Extension-method-syntax"><a href="#10-2-Extension-method-syntax" class="headerlink" title="10.2 Extension method syntax"></a>10.2 Extension method syntax</h3><h4 id="10-2-1-Declearing-extension-methods"><a href="#10-2-1-Declearing-extension-methods" class="headerlink" title="10.2.1 Declearing extension methods"></a>10.2.1 Declearing extension methods</h4><blockquote>
<p>listing 10.3 The StreamUtil class again,but this time with extension methods</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class StreamUtil</span><br><span class="line">    &#123;</span><br><span class="line">        private const int BufferSize = 8192;</span><br><span class="line"></span><br><span class="line">        public static void Copy(Stream input, Stream output)</span><br><span class="line">        &#123;</span><br><span class="line">            byte[] buffer = new byte[BufferSize];</span><br><span class="line">            int read;</span><br><span class="line">            while ((read = input.Read(buffer, 0, buffer.Length)) &gt; 0)</span><br><span class="line">            &#123;</span><br><span class="line">                output.Write(buffer, 0, read);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static byte[] ReadFully(Stream input)</span><br><span class="line">        &#123;</span><br><span class="line">            using (MemoryStream tempStream = new MemoryStream())</span><br><span class="line">            &#123;</span><br><span class="line">                &#123;</span><br><span class="line">                    Copy(input, tempStream);</span><br><span class="line">                    return tempStream.ToArray();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-2-2-Calling-extensio-methods"><a href="#10-2-2-Calling-extensio-methods" class="headerlink" title="10.2.2 Calling extensio methods"></a>10.2.2 Calling extensio methods</h4><blockquote>
<p>listing 10.4 Copying a stream using an extension method</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">static void Method2()</span><br><span class="line">        &#123;</span><br><span class="line">            WebRequest request = WebRequest.Create(&quot;http://www.baidu.com&quot;);</span><br><span class="line">            using (WebResponse response = request.GetResponse())</span><br><span class="line">            using (Stream responseStream = response.GetResponseStream())</span><br><span class="line">            using (FileStream output = File.Create(&quot;response.dat&quot;))</span><br><span class="line">            &#123;</span><br><span class="line">                responseStream.CopyTo(output);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-2-3-Extension-method-discovery"><a href="#10-2-3-Extension-method-discovery" class="headerlink" title="10.2.3 Extension method discovery"></a>10.2.3 Extension method discovery</h4><h4 id="10-2-4-Calling-a-method-discovery"><a href="#10-2-4-Calling-a-method-discovery" class="headerlink" title="10.2.4 Calling a method discovery"></a>10.2.4 Calling a method discovery</h4><blockquote>
<p>listing 10.5 Extension method being called on a null reference</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public static class NullUtil</span><br><span class="line">    &#123;</span><br><span class="line">        public static bool IsNull(this object x)</span><br><span class="line">        &#123;</span><br><span class="line">            return x == null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">static void List5()</span><br><span class="line">        &#123;</span><br><span class="line">            object y = null;</span><br><span class="line">            Console.WriteLine(y.IsNull());</span><br><span class="line">            y = new object();</span><br><span class="line">            Console.WriteLine(y.IsNull());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-3-Extension-methods-in-NET-3-5"><a href="#10-3-Extension-methods-in-NET-3-5" class="headerlink" title="10.3 Extension methods in .NET 3.5"></a>10.3 Extension methods in .NET 3.5</h3><h4 id="10-3-1-First-steps-with-Enumerable"><a href="#10-3-1-First-steps-with-Enumerable" class="headerlink" title="10.3.1 First steps with Enumerable"></a>10.3.1 First steps with Enumerable</h4><blockquote>
<p>listing 10.6 Using Enumerable.Range to print out the numbers 0~9</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">var collection = Enumerable.Range(0, 10);</span><br><span class="line">            foreach (var c in collection)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(c);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 10.7 Reversing a collection with the Reverse method</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">var collection = Enumerable.Range(0, 10)</span><br><span class="line">    						.Reverse();</span><br><span class="line">            foreach (var c in collection)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(c);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-3-2-Filtering-with-WHere-and-chaining-method-calls-together"><a href="#10-3-2-Filtering-with-WHere-and-chaining-method-calls-together" class="headerlink" title="10.3.2 Filtering with  WHere and chaining method calls together"></a>10.3.2 Filtering with  WHere and chaining method calls together</h4><blockquote>
<p>listing 10.8 Using the where method with a lambda expression to find odd numbers</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var collection = Enumerable.Range(0, 10).Where(x =&gt; x % 2 != 0).Reverse();</span><br><span class="line">            foreach (var c in collection)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(c);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-3-3-Interlude-haven’t-we-seen-the-Where-method-before"><a href="#10-3-3-Interlude-haven’t-we-seen-the-Where-method-before" class="headerlink" title="10.3.3 Interlude : haven’t we seen the Where method before?"></a>10.3.3 Interlude : haven’t we seen the Where method before?</h4><blockquote>
<p>listing 10.9 Projection using a lambda expression and an anonymous type</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var collection = Enumerable.Range(0, 10)</span><br><span class="line">    .Where(x =&gt; x % 2 != 0).Reverse()</span><br><span class="line">    .Select(x =&gt; new &#123; Original = x, SquareRoot = Math.Sqrt(x) &#125;);</span><br><span class="line">            foreach (var element in collection)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(&quot;sqrt(&#123;0&#125;) = &#123;1&#125;&quot;,</span><br><span class="line">                                  element.Original,</span><br><span class="line">                                  element.SquareRoot);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-3-4-Projections-using-the-select-method-and-anonymous-types"><a href="#10-3-4-Projections-using-the-select-method-and-anonymous-types" class="headerlink" title="10.3.4 Projections using the select method and anonymous types"></a>10.3.4 Projections using the select method and anonymous types</h4><h4 id="10-3-5-Sorting-using-the-OrderBy-method"><a href="#10-3-5-Sorting-using-the-OrderBy-method" class="headerlink" title="10.3.5 Sorting using the OrderBy method"></a>10.3.5 Sorting using the OrderBy method</h4><blockquote>
<p>listing 10.10 Ordering a sequence by two properties</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var collection = Enumerable.Range(-5, 11)</span><br><span class="line">                .Select(x =&gt; new &#123; Original = x, Square = x * x &#125;)</span><br><span class="line">                .OrderBy(x =&gt; x.Square)</span><br><span class="line">                .ThenBy(x =&gt; x.Original);</span><br><span class="line">            foreach (var c in collection)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(c);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-3-6-Business-examples-involving-chaining"><a href="#10-3-6-Business-examples-involving-chaining" class="headerlink" title="10.3.6 Business examples involving chaining"></a>10.3.6 Business examples involving chaining</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">company.Departments</span><br><span class="line">                .Select(dept =&gt; new</span><br><span class="line">                &#123;</span><br><span class="line">                    dept.Name,</span><br><span class="line">                    Cost = dept.Employees.Sum(person =&gt; person.Salary)</span><br><span class="line">                &#125;)</span><br><span class="line">                .OrderByDescending(deptWithCost =&gt; deptWithCost.Cost);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bugs.GroupBy(bug =&gt; bug.AssignedTo)</span><br><span class="line">    .Select(list =&gt; new &#123;Developer = list.Key,Count = list.Count() &#125;)</span><br><span class="line">    .OrderByDescending(x=&gt;x.Count);</span><br></pre></td></tr></table></figure>
<h3 id="10-4-Usage-ideas-and-guidelines"><a href="#10-4-Usage-ideas-and-guidelines" class="headerlink" title="10.4 Usage ideas and guidelines"></a>10.4 Usage ideas and guidelines</h3><h4 id="10-4-1-“Extending-the-world-“-and-making-interfaces-richer"><a href="#10-4-1-“Extending-the-world-“-and-making-interfaces-richer" class="headerlink" title="10.4.1 “Extending the world “ and making interfaces richer"></a>10.4.1 “Extending the world “ and making interfaces richer</h4><h4 id="10-4-2-Fluent-interfaces"><a href="#10-4-2-Fluent-interfaces" class="headerlink" title="10.4.2 Fluent interfaces"></a>10.4.2 Fluent interfaces</h4><h4 id="10-4-3-Using-extension-methods-sensibly"><a href="#10-4-3-Using-extension-methods-sensibly" class="headerlink" title="10.4.3 Using extension methods sensibly"></a>10.4.3 Using extension methods sensibly</h4><h3 id="10-5-Summary"><a href="#10-5-Summary" class="headerlink" title="10.5 Summary"></a>10.5 Summary</h3><h2 id="LINQ"><a href="#LINQ" class="headerlink" title="LINQ"></a>LINQ</h2><p>Query expressions and LINQ to Objects</p>
<p>This chapter covers</p>
<ul>
<li>Streaming sequences of data and deferred execution</li>
<li>Standard query operators and query expression</li>
<li>Range variables and transparent identifiers</li>
<li>Projecting,Filtering , and sorting</li>
<li>Joining and grouping</li>
<li>Choosing which syntas to use</li>
</ul>
<h3 id="11-1-Introducing-LINQ"><a href="#11-1-Introducing-LINQ" class="headerlink" title="11.1 Introducing LINQ"></a>11.1 Introducing LINQ</h3><p>延迟执行 和流处理</p>
<p>Reverse 成为一个缓冲操作</p>
<blockquote>
<p>listing 11.1 Trivial query to print the list of users</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var query = from user in SampleData.AllUsers</span><br><span class="line">			select user;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.2 The query expression of listing 11.1 translated into a method call </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var query = SampleData.AllUsers.Select(user=&gt;user);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.3 Compilier translation calling methods on a dummy LINQ implementation</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">class TranslationExample&#123;</span><br><span class="line">    static void Main()</span><br><span class="line">    &#123;</span><br><span class="line">        var source = new Dummy&lt;string&gt;();</span><br><span class="line">        var query = from dummy in source</span><br><span class="line">        where dummy.ToString() == &quot;Ignored&quot;</span><br><span class="line">        select &quot;Anything&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static class Extensiions</span><br><span class="line">&#123;</span><br><span class="line">    public static Dummy&lt;T&gt; Where&lt;T&gt;(this Dummy&lt;T&gt; dummy,Func&lt;T,bool&gt; predicate)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(&quot;Where called&quot;);</span><br><span class="line">        return dummy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Dummy&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">    public Dummy&lt;U&gt; Select&lt;U&gt;(Func&lt;T,U&gt; selector)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(&quot;Select called&quot;);</span><br><span class="line">        return new Dummy&lt;U&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//output</span><br><span class="line">Where called</span><br><span class="line">Select called</span><br><span class="line">//equals</span><br><span class="line">var query = source.Where(dummy =&gt; dummy.ToString() == &quot;Ignored&quot;)</span><br><span class="line">    		.Select(dummy =&gt; &quot;Anything&quot;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.4 Query selecting just the names of the users</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IEnumerable&lt;string&gt; query = from user in SampleData.AllUsers select user.Name;</span><br><span class="line">//translation</span><br><span class="line">SampleData.AllUsers.Select(user =&gt;user.Name)</span><br></pre></td></tr></table></figure>
<h3 id="11-2-Simple-beginnings-selecting-elements"><a href="#11-2-Simple-beginnings-selecting-elements" class="headerlink" title="11.2 Simple beginnings : selecting elements"></a>11.2 Simple beginnings : selecting elements</h3><blockquote>
<p>listing11.5 using Cast and OfType to work with weakly typed collections</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public void List115()</span><br><span class="line">        &#123;</span><br><span class="line">            ArrayList list = new ArrayList&#123;&quot;First&quot;,&quot;Second&quot;,&quot;Third&quot;&#125;;</span><br><span class="line">            IEnumerable&lt;string&gt; strings = list.Cast&lt;string&gt;();</span><br><span class="line">            foreach (var item  in strings)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(item);</span><br><span class="line">            &#125;</span><br><span class="line">            list = new ArrayList&#123;1,&quot;not an int&quot;,2,3&#125;;</span><br><span class="line">            IEnumerable&lt;int&gt; ints = list.OfType&lt;int&gt;();</span><br><span class="line">            foreach (var VARIABLE in ints)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(VARIABLE);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing11.6  Using an explicitly typed range variable to automatically call Cast</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public void List116()</span><br><span class="line">        &#123;</span><br><span class="line">            ArrayList list = new ArrayList&#123;&quot;First&quot;,&quot;Second&quot;,&quot;Third&quot;&#125;;</span><br><span class="line">            var strings = from string entry in list</span><br><span class="line">                select entry.Substring(0, 3);</span><br><span class="line">            foreach (var s in strings)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">//translation more interesting</span><br><span class="line">list.Cast&lt;string&gt;().Select(entry=&gt;entry.Substring(0,3));</span><br></pre></td></tr></table></figure>
<p>what is important</p>
<ul>
<li>LINQ 以数据序列为基础，在任何可能的地方都是流处理</li>
<li>创建一个查询并不会立即执行它： 大部分操作都会延迟执行</li>
<li>C#3 的查询表达式包括一个把表达式转换成普通C#代码的预处理阶段，接着使用类型推断、重载、Lambda表达式等这些常规规则来恰当地对转换后的代码进行编译</li>
<li>在查询表达式中声明的变量的作用：他们仅仅是范围变量，通过他们你可以在查询表达式内部一致地引用数据</li>
</ul>
<h3 id="11-3-Filtering-and-ordering-a-sequence"><a href="#11-3-Filtering-and-ordering-a-sequence" class="headerlink" title="11.3 Filtering and ordering a sequence"></a>11.3 Filtering and ordering a sequence</h3><blockquote>
<p>listing 11.7 Query expression usig mutiple where clauses</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">User tim = SampleData.Users.TesterTim;</span><br><span class="line">            var query = from defect in SampleData.AllDefects</span><br><span class="line">                where defect.Status != Status.Closed</span><br><span class="line">                where defect.AssignedTo == tim</span><br><span class="line">                select defect.Summary;</span><br><span class="line">            foreach (var su in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(su);</span><br><span class="line">            &#125;</span><br><span class="line">translated in</span><br><span class="line">SampleData.AllDefects.Where(defect =&gt; defect.Status != Status.Closed)</span><br><span class="line">                .Where(defect =&gt; defect.AssignedTo == tim)</span><br><span class="line">                .Select(defect =&gt; defect.Summary);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.8 Sorting by the severity of a defect, from high to low priority</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public void List118()</span><br><span class="line">        &#123;</span><br><span class="line">            User tim = SampleData.Users.TesterTim;</span><br><span class="line">            var query = from defect in SampleData.AllDefects</span><br><span class="line">                where defect.Status != Status.Closed</span><br><span class="line">                where defect.AssignedTo == tim</span><br><span class="line">                orderby defect.Severity descending</span><br><span class="line">                select defect;</span><br><span class="line">            foreach (var de in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;&#123;0&#125; : &#123;1&#125; &quot;,de.Severity,de.Summary);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.9 Ordering by severity and then last modified time</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public void List119()</span><br><span class="line">        &#123;</span><br><span class="line">            User tim = SampleData.Users.TesterTim;</span><br><span class="line">            var query = from defect in SampleData.AllDefects</span><br><span class="line">                where defect.Status != Status.Closed</span><br><span class="line">                where defect.AssignedTo == tim</span><br><span class="line">                orderby defect.Severity descending, defect.LastModified</span><br><span class="line">                select defect;</span><br><span class="line">            foreach (var defect in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;&#123;0&#125; : &#123;1&#125; (&#123;2:d&#125;)&quot;,defect.Severity,defect.Summary,defect.LastModified);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">translation</span><br><span class="line">SampleData.AllDefects.Where(defect =&gt; defect.Status != Status.Closed)</span><br><span class="line">                .Where(defect =&gt; defect.AssignedTo == tim)</span><br><span class="line">                .OrderByDescending(defect =&gt; defect.Severity)</span><br><span class="line">                .ThenBy(defect =&gt; defect.LastModified);</span><br></pre></td></tr></table></figure>
<h3 id="11-4-Let-clauses-and-transparent-identifiers"><a href="#11-4-Let-clauses-and-transparent-identifiers" class="headerlink" title="11.4 Let clauses and transparent identifiers"></a>11.4 Let clauses and transparent identifiers</h3><blockquote>
<p>listing 11.10 Sorting by the lengths of user names without a let clause</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var query = from user in SampleData.AllUsers</span><br><span class="line">                orderby user.Name.Length</span><br><span class="line">                select user.Name;</span><br><span class="line">            foreach (var name in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;&#123;0&#125;: &#123;1&#125;&quot;,name.Length,name);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.11 use let</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var query = from user in SampleData.AllUsers</span><br><span class="line">                let length = user.Name.Length</span><br><span class="line">                orderby length</span><br><span class="line">                select new &#123;Name = user.Name, Length = length&#125;;</span><br><span class="line">            foreach (var entry in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;&#123;0&#125; : &#123;1&#125;&quot;,entry.Length,entry.Name);</span><br><span class="line">            &#125;</span><br><span class="line">//translation</span><br><span class="line">SampleData.AllUsers</span><br><span class="line">                .Select(user =&gt; new &#123;user, length = user.Name.Length&#125;)</span><br><span class="line">                .OrderBy(z =&gt; z.length)</span><br><span class="line">                .Select(z =&gt; new &#123;Name = z.user.Name, Length = z.length&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="11-5-Joins"><a href="#11-5-Joins" class="headerlink" title="11.5 Joins"></a>11.5 Joins</h3><blockquote>
<p>listing 11-12</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var query = from defect in SampleData.AllDefects</span><br><span class="line">                join subscription in SampleData.AllSubscriptions</span><br><span class="line">                    on defect.Project equals subscription.Project</span><br><span class="line">                select new &#123;defect.Summary, subscription.EmailAddress&#125;;</span><br><span class="line">            foreach (var entry in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;&#123;0&#125; : &#123;1&#125; &quot;,entry.EmailAddress,entry.Summary);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.13 Joining defects and subscriptions with a group join</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.15</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void List1115()</span><br><span class="line">        &#123;</span><br><span class="line">            var query = from user in SampleData.AllUsers</span><br><span class="line">                from project in SampleData.AllProjects</span><br><span class="line">                select new &#123;User = user, Project = project&#125;;</span><br><span class="line">            foreach (var pair in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;&#123;0&#125; / &#123;1&#125; &quot;,pair.User.Name,pair.Project.Name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.16</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public void List1116()</span><br><span class="line">        &#123;</span><br><span class="line">            var query = from left in Enumerable.Range(1, 5)</span><br><span class="line">                from right in Enumerable.Range(11, left)</span><br><span class="line">                select new &#123;Left = left, Right = right&#125;;</span><br><span class="line">            foreach (var pair in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;Left=&#123;0&#125;; Right =&#123;1&#125;&quot;,pair.Left,pair.Right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">//</span><br><span class="line">SampleData.AllDefects.Where(defect =&gt; defect.AssignedTo != null)</span><br><span class="line">                .GroupBy(defect =&gt; defect.AssignedTo);</span><br></pre></td></tr></table></figure>
<h3 id="11-6-Groupings-and-continuations"><a href="#11-6-Groupings-and-continuations" class="headerlink" title="11.6 Groupings and continuations"></a>11.6 Groupings and continuations</h3><blockquote>
<p>listing 11.17 Grouping defects by assignee - trivial projection</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void List1117()</span><br><span class="line">        &#123;</span><br><span class="line">            var query = from defect in SampleData.AllDefects</span><br><span class="line">                where defect.AssignedTo != null</span><br><span class="line">                      group defect by defect.AssignedTo;</span><br><span class="line">            foreach (var entry in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(entry.Key.Name);</span><br><span class="line">                foreach (var defect in entry)</span><br><span class="line">                &#123;</span><br><span class="line">                    System.Console.WriteLine(&quot;(&#123;0&#125;) &#123;1&#125;&quot;,defect.Severity,defect.Summary);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                System.Console.WriteLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">//</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.18 Grouping defects by assignee – projection retains just the summary</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public void List1118()</span><br><span class="line">        &#123;</span><br><span class="line">            var query = from defect in SampleData.AllDefects</span><br><span class="line">                where defect.AssignedTo != null</span><br><span class="line">                group defect.Summary by defect.AssignedTo;</span><br><span class="line">            foreach (var entry in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(entry.Key.Name);</span><br><span class="line">                foreach (var defect in entry)</span><br><span class="line">                &#123;</span><br><span class="line">                    System.Console.WriteLine(&quot;(&#123;0&#125;) &quot;,defect);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                System.Console.WriteLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">//</span><br><span class="line">SampleData.AllDefects.Where(defect =&gt; defect.AssignedTo != null)</span><br><span class="line">                .GroupBy(defect =&gt; defect.AssignedTo, defect =&gt; defect.Summary);</span><br></pre></td></tr></table></figure>
<h3 id="11-7-Choosing-between-query-expressions-and-dot-notation"><a href="#11-7-Choosing-between-query-expressions-and-dot-notation" class="headerlink" title="11.7 Choosing between query expressions and dot notation"></a>11.7 Choosing between query expressions and dot notation</h3><blockquote>
<p>listing 11.19  Continuing a grouping with another projection</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public void List1119()</span><br><span class="line">        &#123;</span><br><span class="line">            var query = from defect in SampleData.AllDefects</span><br><span class="line">                where defect.AssignedTo != null</span><br><span class="line">                group defect by defect.AssignedTo</span><br><span class="line">                into grouped</span><br><span class="line">                select new &#123;Assignee = grouped.Key, Count = grouped.Count()&#125;;</span><br><span class="line">            foreach (var entry in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;&#123;0&#125;: &#123;1&#125;&quot;,entry.Assignee.Name,entry.Count);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 11.20 Query expression continuations from group and select\</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void List1120()</span><br><span class="line">        &#123;</span><br><span class="line">            var query = from defect in SampleData.AllDefects</span><br><span class="line">                where defect.AssignedTo != null</span><br><span class="line">                group defect by defect.AssignedTo</span><br><span class="line">                into grouped</span><br><span class="line">                select new &#123;Assignee = grouped.Key, Count = grouped.Count()&#125;;</span><br><span class="line">            foreach (var entry in query)</span><br><span class="line">            &#123;</span><br><span class="line">                System.Console.WriteLine(&quot;&#123;0&#125; : &#123;1&#125;&quot;,entry.Assignee.Name,entry.Count);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            SampleData.AllDefects.Where(defect =&gt; defect.AssignedTo != null)</span><br><span class="line">                .GroupBy(defect =&gt; defect.AssignedTo)</span><br><span class="line">                .Select(grouped =&gt; new &#123;Assignee = grouped.Key, Count = grouped.Count()&#125;)</span><br><span class="line">                .OrderByDescending(result =&gt; result.Count);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-8-Summary"><a href="#11-8-Summary" class="headerlink" title="11.8 Summary"></a>11.8 Summary</h3><p>在合适的时候使用点标记</p>
<h1 id="C-4-Playing-nicely-with-others"><a href="#C-4-Playing-nicely-with-others" class="headerlink" title="C# 4:Playing nicely with others"></a>C# 4:Playing nicely with others</h1><h2 id="13-minor-changes-to-simplify-code"><a href="#13-minor-changes-to-simplify-code" class="headerlink" title="13 minor changes to simplify code"></a>13 minor changes to simplify code</h2><ul>
<li>Optional parameters</li>
<li>Named arguments</li>
<li>Streamlining ref parameters in COM</li>
<li>Embedding COM Primary Interop Assemblies</li>
<li>Calling named indexers declared in COM</li>
<li>Generic variance for inter faces and delegates</li>
<li>Changes in locking and field-like events</li>
</ul>
<h3 id="13-1-Optional-parameters-and-named-arguments"><a href="#13-1-Optional-parameters-and-named-arguments" class="headerlink" title="13.1 Optional parameters and named arguments"></a>13.1 Optional parameters and named arguments</h3><blockquote>
<p>listing 13.1 Declaring and calling a method with optional parameters</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void List1301(int x,int y =20 ,int z =30)</span><br><span class="line">        &#123;</span><br><span class="line">            System.Console.WriteLine(&quot;x=&#123;0&#125;,y=&#123;1&#125;,z=&#123;2&#125;&quot;,x,y,z);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.2 Using null default values to handle nonconstant situations</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public void List1302(string filename, string message, Encoding encoding = null, DateTime? timestamp = null)</span><br><span class="line">        &#123;</span><br><span class="line">            Encoding realEncoding = encoding ?? Encoding.UTF8;</span><br><span class="line">            DateTime realTimestamp = timestamp ?? DateTime.Now;</span><br><span class="line">            using (TextWriter writer = new StreamWriter(filename, true, realEncoding))</span><br><span class="line">            &#123;</span><br><span class="line">                writer.WriteLine(&quot;&#123;0:s&#125; : &#123;1&#125;&quot;,realTimestamp,message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">     new CinD().List1302(&quot;utf8.txt&quot;,&quot;First message&quot;);</span><br><span class="line">            new CinD().List1302(&quot;ascii.txt&quot;,&quot;ASCII&quot;,Encoding.ASCII);</span><br><span class="line">            new CinD().List1302(&quot;utf8.txt&quot;,&quot;message in the future&quot;,null,new DateTime(2030,1,1));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.3 Simple examples of using named arguments</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">static void Dump(int x, int y, int z)</span><br><span class="line">        &#123;</span><br><span class="line">            System.Console.WriteLine(&quot;x=&#123;0&#125; y=&#123;1&#125; z=&#123;2&#125; &quot;,x,y,z);</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            Dump(1,2,3);</span><br><span class="line">            Dump(x:1,y:2,z:3);</span><br><span class="line">            Dump(z:3,y:2,x:1);</span><br><span class="line">            Dump(1,y:2,z:3);</span><br><span class="line">            Dump(1,z:3,y:2);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.4 Logging argument evaluation</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            Dump(x:Log(1),y:Log(2),z:Log(3));</span><br><span class="line">            Dump(z:Log(3),x:Log(1),y:Log(2));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static int Log(int value)</span><br><span class="line">        &#123;</span><br><span class="line">            System.Console.WriteLine(&quot;Log: &#123;0&#125;&quot;,value);</span><br><span class="line">            return value;</span><br><span class="line">        &#125;</span><br><span class="line">        static void Dump(int x, int y, int z)</span><br><span class="line">        &#123;</span><br><span class="line">            System.Console.WriteLine(&quot;x=&#123;0&#125; y=&#123;1&#125; z=&#123;2&#125; &quot;,x,y,z);</span><br><span class="line">        &#125;</span><br><span class="line">//re</span><br><span class="line">log 1 2 3</span><br><span class="line">    log 3 1 2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.5  Abusing argument evaluation order</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int i = 0;</span><br><span class="line">            Dump(x:++i,y:++i,z:++i);</span><br><span class="line">            i = 0;</span><br><span class="line">            Dump(x:++i,y:++i,z:++i);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.6 Combining named arguments and optional parameters</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">static void AppendTimestamp(string filename,string message,Encoding encoding = null, DateTime? timestamp = null)</span><br><span class="line">        &#123;</span><br><span class="line">            Encoding realEncoding = encoding ?? Encoding.UTF8;</span><br><span class="line">            DateTime realTimestamp = timestamp ?? DateTime.Now;</span><br><span class="line">            using (TextWriter writer = new StreamWriter(filename, true, realEncoding))</span><br><span class="line">            &#123;</span><br><span class="line">                writer.WriteLine(&quot;&#123;0:s&#125; : &#123;1&#125;&quot;,realTimestamp,message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">///</span><br><span class="line">AppendTimestamp(&quot;utf8.txt&quot;,&quot;Message in the future&quot;,timestamp: new DateTime(2030,1,1));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.7 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="13-2-Improvements-for-COM-interoperablity"><a href="#13-2-Improvements-for-COM-interoperablity" class="headerlink" title="13.2 Improvements for COM interoperablity"></a>13.2 Improvements for COM interoperablity</h3><blockquote>
<p>listing 13.8 Creating and saving a documents in C# 3</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">object missing = Type.Missing;</span><br><span class="line">            Application app = new Application &#123;Visible = true&#125;;</span><br><span class="line">            app.Documents.Add(ref missing, ref missing, ref missing, ref missing);</span><br><span class="line">            Document doc = app.ActiveDocument;</span><br><span class="line">            Paragraph para = doc.Paragraphs.Add(ref missing);</span><br><span class="line">            para.Range.Text = &quot;Thank goodness for C# 4&quot;;</span><br><span class="line"></span><br><span class="line">            object filename = &quot;demo.doc&quot;;</span><br><span class="line">            object format = WdSaveFormat.wdFormatDocument97;</span><br><span class="line">            doc.SaveAs(ref filename,ref format,ref missing,ref missing,ref missing,</span><br><span class="line">            ref missing,ref missing,ref missing,</span><br><span class="line">                ref missing,ref missing,ref missing,</span><br><span class="line">                ref missing,ref missing,ref missing,</span><br><span class="line">                ref missing,ref missing);</span><br><span class="line">            doc.Close(ref missing,ref  missing,ref missing);</span><br><span class="line">            app.Application.Quit(ref missing,ref missing,ref missing);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.9 Automating Word using normal C# 4 features</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Application app = new Application &#123;Visible = true&#125;;</span><br><span class="line">            app.Documents.Add();</span><br><span class="line">            Document doc = app.ActiveDocument;</span><br><span class="line">            Paragraph para = doc.Paragraphs.Add();</span><br><span class="line">            para.Range.Text = &quot;Thank goodness for C# 44444444444444444444&quot;;</span><br><span class="line">            object filename = &quot;demo1.doc&quot;;</span><br><span class="line">            object format = WdSaveFormat.wdFormatDocument97;</span><br><span class="line">            doc.SaveAs(FileName:ref filename,FileFormat:ref format);</span><br><span class="line">            doc.Close();</span><br><span class="line">            app.Application.Quit();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.10 Passing arguments by value in COM methods</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Application app = new Application &#123;Visible = true&#125;;</span><br><span class="line">            app.Documents.Add();</span><br><span class="line">            Document doc = app.ActiveDocument;</span><br><span class="line">            Paragraph para = doc.Paragraphs.Add();</span><br><span class="line">            para.Range.Text = &quot;Thank goodness for C# 4&quot;;</span><br><span class="line">            doc.SaveAs(FileName:&quot;text.doc&quot;,FileFormat:WdSaveFormat.wdFormatDocument97);</span><br><span class="line">            doc.Close();</span><br><span class="line">            app.Application.Quit();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.11 Error–              Using the SynonymInfo indexer to count word meanings</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">static void List1311(SynonymInfo info)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;&#123;0&#125; has &#123;1&#125; meanings &quot;,info.Word,info.MeaningCount);</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">    Application app = new Application &#123;Visible = false&#125;;</span><br><span class="line">            object missing = Type.Missing;</span><br><span class="line">            List1311(app.get_SynonymInfo(&quot;painful&quot;,ref missing));</span><br><span class="line">            List1311(app.SynonymInfo[&quot;nice&quot;,WdLanguageID.wdEnglishUS]);</span><br><span class="line">            List1311(app.SynonymInfo[Word:&quot;features&quot;]);</span><br><span class="line">            app.Application.Quit();</span><br></pre></td></tr></table></figure>
<h3 id="13-3-Generic-variance-for-interfaces-and-delegates"><a href="#13-3-Generic-variance-for-interfaces-and-delegates" class="headerlink" title="13.3 Generic variance for interfaces and delegates"></a>13.3 Generic variance for interfaces and delegates</h3><p>协变性和逆变性</p>
<p>1 协变</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface IFactory&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">    T CreateInstance();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如在现实世界中， 你可以把比萨工厂视为食品工厂</p>
<p>2 逆变</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface IPrettyPrinter&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">    Void Print(T document);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们实现了IPrettyPrinter<sourcecode>，就可以当做IPrettyPrinter<csharpcode>来使用</csharpcode></sourcecode></p>
<p>3 不变</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface IStorage&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">    byte[] Serialize(T value);</span><br><span class="line">    T Deserialize(byte[] data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.12 Using variance to build a list of general shapes from specific lists</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;IShape&gt; shapesByAdding = new List&lt;IShape&gt;();</span><br><span class="line">            shapesByAdding.AddRange(circles);</span><br><span class="line">            shapesByAdding.AddRange(squares);</span><br><span class="line">            List&lt;IShape&gt; shapesByConcat = circles.Concat&lt;IShape&gt;(squares).ToList();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>listing 13.13 Sorting circles using a general-purpose comparer and contravariance</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class AreaComparer: IComparer&lt;IShape&gt;</span><br><span class="line">&#123;</span><br><span class="line">	public intCompare(IShape x,IShape y)</span><br><span class="line">    &#123;</span><br><span class="line">    	return x.Area.CompareTo(y.Area);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">    IComparer&lt;IShape&gt; areaComparer = new AreaComparer();</span><br><span class="line">	circles.Sort(areaComparer);</span><br></pre></td></tr></table></figure>
<p>Sort的参数应该为IComparer<circle></circle>类型，但是逆变性会进行隐式转换。就这么简单</p>
<blockquote>
<p>listing 13.14 Using variance with simple Func<t> and Action<t> delegates</t></t></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;Square&gt; squareFactory = ()=&gt; new Square(new Point(5,5),10);</span><br><span class="line">Func&lt;IShape&gt; shapeFactory = squareFactory;</span><br><span class="line">Action&lt;IShape&gt; shapePrinter = shape =&gt; Console.WriteLine(shape.Area);</span><br><span class="line">Action&lt;Square&gt; squarePrinter = shapePrinter;</span><br><span class="line"></span><br><span class="line">squarePrinter(squareFactory());</span><br><span class="line">shapePrinter(shapeFactory());</span><br></pre></td></tr></table></figure>
<h3 id="13-4-Teeny-tiny-changes-to-locking-and-field-like-events"><a href="#13-4-Teeny-tiny-changes-to-locking-and-field-like-events" class="headerlink" title="13.4 Teeny tiny changes to locking and field-like events"></a>13.4 Teeny tiny changes to locking and field-like events</h3><blockquote>
<p>listing 13.15 Demonstrating covariance and contravariance with a single type</p>
</blockquote>
<p><code>Converter&lt;TInput,TOutput&gt;</code> 同时使用协变性 和逆变性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Converter&lt;object, string&gt; converter = x =&gt; x.ToString();</span><br><span class="line">         Converter&lt;string, string&gt; contravariance = converter;</span><br><span class="line"></span><br><span class="line">         Converter&lt;object, object&gt; convariance = converter;</span><br><span class="line">         Converter&lt;string, object&gt; both = converter;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delegate Func&lt;T&gt; FuncFunc&lt;out T&gt;();</span><br><span class="line">delegate void ActionAction&lt;out T&gt;(Action&lt;T&gt; action);</span><br><span class="line">delegate void ActionFunc&lt;int T&gt; (Func&lt;T&gt; function);</span><br><span class="line">delegate Action&lt;T&gt; FuncAction&lt;int T&gt;();</span><br></pre></td></tr></table></figure>
<h3 id="13-5-Summary"><a href="#13-5-Summary" class="headerlink" title="13.5 Summary"></a>13.5 Summary</h3>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/29/WPF-Web-Review/" rel="next" title="WPF-Web-Review">
                <i class="fa fa-chevron-left"></i> WPF-Web-Review
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/10/pixiv-dns/" rel="prev" title="pixiv_dns">
                pixiv_dns <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Psmyfish</p>
              <p class="site-description motion-element" itemprop="description">Some fish in the rain,some fish in the sun.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#C-in-Depth"><span class="nav-number">1.</span> <span class="nav-text">C# in Depth</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-changing-face-of-C-development"><span class="nav-number">1.1.</span> <span class="nav-text">The changing face of C# development</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-Starting-with-a-simple-data-type"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 Starting with a simple data type</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-1-The-Product-type-in-C-1"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">1.1.1 The Product type in C#1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-2-Strongly-typed-collections-in-C-2"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">1.1.2 Strongly typed collections in C#2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-3-Automatically-implemented-properties-in-C-3"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">1.1.3 Automatically implemented properties in C#3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-4-Name-arguments-in-C-4"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">1.1.4 Name arguments in C# 4</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Sorting-and-filtering"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 Sorting and filtering</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-Sorting-products-by-name"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">1.2.1 Sorting products by name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-Querying-collections"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">1.2.2 Querying collections</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-1-Representing-an-unknown-price"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">1.3.1 Representing an unknown price</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-2-Optional-parameters-and-default-values"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">1.3.2 Optional parameters and default values</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-Introducing-LINQ"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.4 Introducing LINQ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-1-Query-expressions-and-in-process-queries"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">1.4.1 Query expressions and in-process queries</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Core-foundations-building-on-C-1"><span class="nav-number">1.2.</span> <span class="nav-text">Core foundations:building on C#1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Delegates"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 Delegates</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-A-recipe-for-simple-delegates"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">2.1.1 A recipe for simple delegates</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-Combining-and-removing-delegates"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">2.1.2 Combining and removing delegates</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-A-brief-diversion-into-events"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">2.1.3 A brief diversion into events</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-4-Summary-of-delegates"><span class="nav-number">1.2.1.4.</span> <span class="nav-text">2.1.4 Summary of delegates</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Type-system-characteristics"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2  Type system characteristics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-C-’s-place-in-the-world-of-type-systems"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">2.2.1 C#’s place in the world of type systems</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#STATIC-TYPING-VERSUS-DYNAMIC-TYPING"><span class="nav-number">1.2.2.1.1.</span> <span class="nav-text">STATIC TYPING VERSUS DYNAMIC TYPING</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#EXPLICIT-TYPING-VERSUS-IMPLICIT-TYPING"><span class="nav-number">1.2.2.1.2.</span> <span class="nav-text">EXPLICIT TYPING VERSUS IMPLICIT TYPING</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TYPE-SAFE-VERSUS-TYPE-UNSAFE"><span class="nav-number">1.2.2.1.3.</span> <span class="nav-text">TYPE-SAFE VERSUS TYPE-UNSAFE</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-When-is-C-1’s-type-ststem-not-rich-enough"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">2.2.2 When is C# 1’s type ststem not rich enough?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-Summary-of-type-system-characteristics"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">2.2.3 Summary of type system characteristics</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-Value-types-and-reference-types"><span class="nav-number">1.3.</span> <span class="nav-text">2.3 Value types and reference types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-Values-and-references-in-the-real-world"><span class="nav-number">1.3.0.1.</span> <span class="nav-text">2.3.1 Values and references in the real world</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-Value-and-reference-type-fundamentals"><span class="nav-number">1.3.0.2.</span> <span class="nav-text">2.3.2 Value and reference type fundamentals</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-Dispelling-myths"><span class="nav-number">1.3.0.3.</span> <span class="nav-text">2.3.3 Dispelling myths</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-4-Boxing-and-unboxing"><span class="nav-number">1.3.0.4.</span> <span class="nav-text">2.3.4 Boxing and unboxing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-5-值类型和引用类型小结"><span class="nav-number">1.3.0.5.</span> <span class="nav-text">2.3.5 值类型和引用类型小结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-C-1之外-构建于坚实基础之上的新特性"><span class="nav-number">1.3.1.</span> <span class="nav-text">2.4 C#1之外:构建于坚实基础之上的新特性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-与委托有关的特性"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">2.4.1 与委托有关的特性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-2-Features-related-to-value-types"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">2.4.2 Features related to value types</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Parameterized-typing-with-generics"><span class="nav-number">1.4.</span> <span class="nav-text">3  Parameterized typing with generics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-why-generics-are-necessary"><span class="nav-number">1.4.1.</span> <span class="nav-text">3.1 why generics are necessary</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-Generic-types-and-type-parameters"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">3.2.2  Generic types and type parameters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-Generic-methods-and-reading-generic-declarations"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">3.2.3 Generic methods and reading generic declarations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-Type-constraints"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">3.3.1 Type constraints</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-Type-inference-for-type-arguments-of-generic-methods"><span class="nav-number">1.4.1.4.</span> <span class="nav-text">3.3.2 Type inference for type arguments of generic methods</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-Implementing-generics"><span class="nav-number">1.4.1.5.</span> <span class="nav-text">3.3.3 Implementing generics</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-Advanced-generics"><span class="nav-number">1.4.2.</span> <span class="nav-text">3.4 Advanced generics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-Static-fields-and-static-constructors"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">3.4.1 Static fields and static constructors</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-How-the-JIT-compiler-handles-generics"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">3.4.2 How the JIT compiler handles generics</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-3-Generic-iteration"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">3.4.3 Generic iteration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-4-Reflection-and-generics"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">3.4.4 Reflection and generics</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-Limitations-of-generics-in-C-and-other-languages"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.5 Limitations of generics in C# and other languages</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-Lack-of-generic-variance"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">3.5.1 Lack of generic variance</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Saying-nothing-with-nullable-types"><span class="nav-number">1.5.</span> <span class="nav-text">4 Saying nothing with nullable types</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-What-do-you-do-when-you-just-dont-have-a-value"><span class="nav-number">1.5.1.</span> <span class="nav-text">4.1 What do you do when you  just dont have a value?</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-Why-value-type-variables-cant-be-null"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">4.1.1 Why value type variables cant be null</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-Patterns-for-representing-null-values-in-C-1"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">4.1.2 Patterns for representing null values in C#1</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-System-Nullable-lt-T-gt-and-System-Nullable"><span class="nav-number">1.5.2.</span> <span class="nav-text">4.2 System.Nullable &lt;T&gt;and System.Nullable</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-Introduciong-Nullable-lt-T-gt"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">4.2.1 Introduciong Nullable&lt;T&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-Boxing-Nullable-lt-T-gt-and-unboxing"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">4.2.2 Boxing Nullable&lt;T&gt; and unboxing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-Equality-of-Nullable-lt-T-gt-instances"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">4.2.3 Equality of Nullable&lt;T&gt; instances</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-Support-from-the-nongeneric-Nullable-class"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">4.2.4 Support from the nongeneric Nullable class</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-C-2’s-syntactic-sugar-for-nullable-types"><span class="nav-number">1.5.3.</span> <span class="nav-text">4.3 C# 2’s syntactic sugar for nullable types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-The-modifier"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">4.3.1 The ? modifier</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-Assigning-and-comparing-with-null"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">4.3.2 Assigning and comparing with null</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-3-Nullable-conversions-and-operators"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">4.3.3 Nullable conversions and operators</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-4-Nullable-logic"><span class="nav-number">1.5.3.4.</span> <span class="nav-text">4.3.4 Nullable logic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-5-Using-the-as-operator-with-nullable-types"><span class="nav-number">1.5.3.5.</span> <span class="nav-text">4.3.5  Using the as operator with nullable types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-6-The-null-coalescing-operator"><span class="nav-number">1.5.3.6.</span> <span class="nav-text">4.3.6 The null coalescing operator</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-Novel-uses-of-nullable-types"><span class="nav-number">1.5.4.</span> <span class="nav-text">4.4 Novel uses of nullable types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-1-Tyeing-an-operation-without-using-output-parameter"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">4.4.1 Tyeing an operation without using output parameter</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-Summary"><span class="nav-number">1.5.5.</span> <span class="nav-text">4.5 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Fast-tracked-delegates"><span class="nav-number">1.6.</span> <span class="nav-text">5 Fast-tracked delegates</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-Saying-goodbye-to-awkward-delegate-syntax"><span class="nav-number">1.6.1.</span> <span class="nav-text">5.1 Saying goodbye to awkward delegate syntax</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-Method-group-conversions"><span class="nav-number">1.6.2.</span> <span class="nav-text">5.2 Method group conversions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-Covariance-and-contravariance"><span class="nav-number">1.6.3.</span> <span class="nav-text">5.3 Covariance and contravariance</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-1-Contravariance-for-delegate-parameters"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">5.3.1 Contravariance for delegate parameters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-2-Covariance-of-delegate-return-types"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">5.3.2 Covariance of delegate return types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-3-A-small-risk-of-incompatibility"><span class="nav-number">1.6.3.3.</span> <span class="nav-text">5.3.3 A small risk of incompatibility</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-Inline-delegate-actions-with-anonymous-methods"><span class="nav-number">1.6.4.</span> <span class="nav-text">5.4 Inline delegate actions with anonymous methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-4-1-Starting-simply-acting-on-a-parameter"><span class="nav-number">1.6.4.1.</span> <span class="nav-text">5.4.1 Starting simply : acting on a parameter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-4-2-Returing-values-from-anonymous-methods"><span class="nav-number">1.6.4.2.</span> <span class="nav-text">5.4.2 Returing values from anonymous methods</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-4-3-Ignoring-delegate-parameters"><span class="nav-number">1.6.4.3.</span> <span class="nav-text">5.4.3 Ignoring delegate parameters</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-Capturing-variables-in-anonymous-methods"><span class="nav-number">1.6.5.</span> <span class="nav-text">5.5 Capturing variables in anonymous methods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-5-1-Defining-closures-and-different-types-of-variables"><span class="nav-number">1.6.5.1.</span> <span class="nav-text">5.5.1 Defining closures and different types of variables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-5-2-Examining-the-behavior-of-captured-variables"><span class="nav-number">1.6.5.2.</span> <span class="nav-text">5.5.2 Examining the behavior of captured variables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-5-3-What’s-the-point-of-captured-variables"><span class="nav-number">1.6.5.3.</span> <span class="nav-text">5.5.3 What’s the point of captured variables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-5-4-The-extended-lifetime-of-captured-variables"><span class="nav-number">1.6.5.4.</span> <span class="nav-text">5.5.4 The extended lifetime of  captured variables</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-Summary"><span class="nav-number">1.6.6.</span> <span class="nav-text">5.6 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Inplementing-iterators-the-easy-way"><span class="nav-number">1.7.</span> <span class="nav-text">6 Inplementing iterators the easy way</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-C-1-The-pain-of-hadwritten-iterators"><span class="nav-number">1.7.1.</span> <span class="nav-text">6.1 C#1 The pain of hadwritten iterators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-C-2-Simple-iterators-with-yield-statements"><span class="nav-number">1.7.2.</span> <span class="nav-text">6.2 C#2 Simple iterators with yield statements</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-Introducing-iterator-blocks-and-yield-return"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">6.2.1 Introducing iterator blocks and yield return</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-2-Visualizing-an-iterator-workflow"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">6.2.2 Visualizing an iterator workflow</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-Advanced-iterator-execution-flow"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">6.2.3 Advanced iterator execution flow</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-4-Quirks-in-the-implementation"><span class="nav-number">1.7.2.4.</span> <span class="nav-text">6.2.4 Quirks in the implementation</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-Real-lifer-iterator-examples"><span class="nav-number">1.7.3.</span> <span class="nav-text">6.3 Real-lifer iterator examples</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-1-Iteration-over-the-dates-in-a-timetable"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">6.3.1 Iteration over the dates in a timetable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-2-Iterating-over-lines-in-a-file"><span class="nav-number">1.7.3.2.</span> <span class="nav-text">6.3.2 Iterating over lines in a file</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-3-Filtering-items-lazily-using-an-iterator-block-and-a-predicate"><span class="nav-number">1.7.3.3.</span> <span class="nav-text">6.3.3 Filtering items lazily using an iterator block and a predicate</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-Pseudo-synchronous-code-with-the-Concurrency-and-Coordination-Runtime"><span class="nav-number">1.7.4.</span> <span class="nav-text">6.4 Pseudo-synchronous code with the Concurrency and Coordination Runtime</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-Summary"><span class="nav-number">1.7.5.</span> <span class="nav-text">6.5 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-Concluding-C-2-the-final-features"><span class="nav-number">1.8.</span> <span class="nav-text">7 Concluding C#2 : the final features</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-Patial-types"><span class="nav-number">1.8.1.</span> <span class="nav-text">7.1 Patial types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-Static-classes"><span class="nav-number">1.8.2.</span> <span class="nav-text">7.2 Static classes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-Separate-getter-setter-property-access"><span class="nav-number">1.8.3.</span> <span class="nav-text">7.3 Separate getter/setter property access</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-Namespace-class"><span class="nav-number">1.8.4.</span> <span class="nav-text">7.4 Namespace class</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-2-The-global-namespace-alias"><span class="nav-number">1.8.4.1.</span> <span class="nav-text">7.4.2 The global namespace alias</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-3-Extern-aliases"><span class="nav-number">1.8.4.2.</span> <span class="nav-text">7.4.3 Extern aliases</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5-Pragma-directives"><span class="nav-number">1.8.5.</span> <span class="nav-text">7.5 Pragma directives</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-5-1-Warning-pragmas"><span class="nav-number">1.8.5.1.</span> <span class="nav-text">7.5.1 Warning pragmas</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-5-2-Checksum-pragmas"><span class="nav-number">1.8.5.2.</span> <span class="nav-text">7.5.2 Checksum pragmas</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-Fixed-size-buffers-in-unsafe-code"><span class="nav-number">1.8.6.</span> <span class="nav-text">7.6 Fixed-size buffers in unsafe code</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-7-Exposing-internal-members-to-selected-assemblies"><span class="nav-number">1.8.7.</span> <span class="nav-text">7.7 Exposing internal members to selected assemblies</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-7-1-Friend-assemblies-in-the-simple-selected-assemblies"><span class="nav-number">1.8.7.1.</span> <span class="nav-text">7.7.1 Friend assemblies in the simple selected assemblies</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-7-2-Why-use-InternalsVisibleTo"><span class="nav-number">1.8.7.2.</span> <span class="nav-text">7.7.2 Why use InternalsVisibleTo</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-7-3-InternalsVisibleTO-and-signed-assemblies"><span class="nav-number">1.8.7.3.</span> <span class="nav-text">7.7.3 InternalsVisibleTO and signed assemblies</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-8-Summary"><span class="nav-number">1.8.8.</span> <span class="nav-text">7.8 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Cutting-fluff-with-a-smart-compiler"><span class="nav-number">1.9.</span> <span class="nav-text">8 Cutting fluff with a smart compiler</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-Automatically-implemented-properties"><span class="nav-number">1.9.1.</span> <span class="nav-text">8.1 Automatically implemented properties</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-Implicit-typing-of-local-variables"><span class="nav-number">1.9.2.</span> <span class="nav-text">8.2 Implicit typing of local variables</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-1-Using-var-to-declare-a-local-variable"><span class="nav-number">1.9.2.1.</span> <span class="nav-text">8.2.1 Using var to declare a local variable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-2-Restrictions-on-implicit-typing"><span class="nav-number">1.9.2.2.</span> <span class="nav-text">8.2.2 Restrictions on implicit typing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-3-Pros-and-cons-of-implicit-typing"><span class="nav-number">1.9.2.3.</span> <span class="nav-text">8.2.3 Pros and cons of implicit typing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-4-Recommendations"><span class="nav-number">1.9.2.4.</span> <span class="nav-text">8.2.4 Recommendations</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-Simplified-initialization"><span class="nav-number">1.9.3.</span> <span class="nav-text">8.3 Simplified initialization</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-1-Defining-some-sample-types"><span class="nav-number">1.9.3.1.</span> <span class="nav-text">8.3.1 Defining some sample types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-2-Setting-simple-properties"><span class="nav-number">1.9.3.2.</span> <span class="nav-text">8.3.2 Setting simple properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-3-Setting-properties-on-embedded-objects"><span class="nav-number">1.9.3.3.</span> <span class="nav-text">8.3.3 Setting properties on embedded objects</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-4-Collection-initializers"><span class="nav-number">1.9.3.4.</span> <span class="nav-text">8.3.4 Collection initializers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-5-Uses-of-initialization-features"><span class="nav-number">1.9.3.5.</span> <span class="nav-text">8.3.5 Uses of initialization features</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-Implicitly-typed-arrays"><span class="nav-number">1.9.4.</span> <span class="nav-text">8.4 Implicitly typed arrays</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-5-Anonymous-types"><span class="nav-number">1.9.5.</span> <span class="nav-text">8.5 Anonymous types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-5-1-First-encounters-of-the-anonymous-kind"><span class="nav-number">1.9.5.1.</span> <span class="nav-text">8.5.1 First encounters of the anonymous kind</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-5-2-members-of-anonymous-types"><span class="nav-number">1.9.5.2.</span> <span class="nav-text">8.5.2 members of anonymous types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-5-3-Projection-initializers"><span class="nav-number">1.9.5.3.</span> <span class="nav-text">8.5.3 Projection initializers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-5-4-What’s-the-point"><span class="nav-number">1.9.5.4.</span> <span class="nav-text">8.5.4 What’s the point?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-6-Summary"><span class="nav-number">1.9.6.</span> <span class="nav-text">8.6 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-Lambda-expressions-and-expression-trees"><span class="nav-number">1.10.</span> <span class="nav-text">9  Lambda expressions and expression trees</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-1-2-First-transformatio-to-a-lambda-expression"><span class="nav-number">1.10.0.1.</span> <span class="nav-text">9.1.2 First transformatio to a lambda expression</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-Simple-examples-using-List-lt-T-gt-and-events"><span class="nav-number">1.10.1.</span> <span class="nav-text">9.2 Simple examples using List&lt;T&gt; and events</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-2-1-Filtering-sorting-and-actions-on-lists"><span class="nav-number">1.10.1.1.</span> <span class="nav-text">9.2.1 Filtering ,sorting,and actions on lists</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-2-2-Logging-in-an-event-handler"><span class="nav-number">1.10.1.2.</span> <span class="nav-text">9.2.2 Logging in an event handler</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-Expression-trees"><span class="nav-number">1.10.2.</span> <span class="nav-text">9.3 Expression trees</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-1-Building-expressiono-trees-programmatically"><span class="nav-number">1.10.2.1.</span> <span class="nav-text">9.3.1 Building expressiono trees programmatically</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-2-Compiling-expression-trees-into-delegates"><span class="nav-number">1.10.2.2.</span> <span class="nav-text">9.3.2 Compiling expression trees into delegates</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-3-COnverting-C-lambda-expressions-to-expression-trees"><span class="nav-number">1.10.2.3.</span> <span class="nav-text">9.3.3 COnverting C# lambda expressions to expression trees</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-4-Expression-trees-at-the-heart-of-LINQ"><span class="nav-number">1.10.2.4.</span> <span class="nav-text">9.3.4 Expression trees at the heart of LINQ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-5-Expression-trees-beyond-LINQ"><span class="nav-number">1.10.2.5.</span> <span class="nav-text">9.3.5 Expression trees beyond LINQ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-Changes-to-type-inference-and-overload-resolution"><span class="nav-number">1.10.3.</span> <span class="nav-text">9.4  Changes to type inference and overload resolution</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-4-1-Reasons-for-change-streamlining-generic-method-calls"><span class="nav-number">1.10.3.1.</span> <span class="nav-text">9.4.1 Reasons for change: streamlining generic method calls</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-4-2-Inferred-return-types-of-anonymous-functions"><span class="nav-number">1.10.3.2.</span> <span class="nav-text">9.4.2 Inferred return types of anonymous functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-4-3-Two-phase-type-inference"><span class="nav-number">1.10.3.3.</span> <span class="nav-text">9.4.3 Two-phase type inference</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-4-4-Picking-the-right-overloaded-method"><span class="nav-number">1.10.3.4.</span> <span class="nav-text">9.4.4 Picking the right overloaded method</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-4-5-Wrapping-up-tpe-inference-and-overload-resolution"><span class="nav-number">1.10.3.5.</span> <span class="nav-text">9.4.5 Wrapping up tpe inference and overload resolution</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-5-Summary"><span class="nav-number">1.10.4.</span> <span class="nav-text">9.5 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-Extension-methods"><span class="nav-number">1.11.</span> <span class="nav-text">10 Extension methods</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-Life-before-extension-methods"><span class="nav-number">1.11.1.</span> <span class="nav-text">10.1 Life before extension methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-Extension-method-syntax"><span class="nav-number">1.11.2.</span> <span class="nav-text">10.2 Extension method syntax</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-1-Declearing-extension-methods"><span class="nav-number">1.11.2.1.</span> <span class="nav-text">10.2.1 Declearing extension methods</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-2-Calling-extensio-methods"><span class="nav-number">1.11.2.2.</span> <span class="nav-text">10.2.2 Calling extensio methods</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-3-Extension-method-discovery"><span class="nav-number">1.11.2.3.</span> <span class="nav-text">10.2.3 Extension method discovery</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-2-4-Calling-a-method-discovery"><span class="nav-number">1.11.2.4.</span> <span class="nav-text">10.2.4 Calling a method discovery</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-Extension-methods-in-NET-3-5"><span class="nav-number">1.11.3.</span> <span class="nav-text">10.3 Extension methods in .NET 3.5</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-1-First-steps-with-Enumerable"><span class="nav-number">1.11.3.1.</span> <span class="nav-text">10.3.1 First steps with Enumerable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-2-Filtering-with-WHere-and-chaining-method-calls-together"><span class="nav-number">1.11.3.2.</span> <span class="nav-text">10.3.2 Filtering with  WHere and chaining method calls together</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-3-Interlude-haven’t-we-seen-the-Where-method-before"><span class="nav-number">1.11.3.3.</span> <span class="nav-text">10.3.3 Interlude : haven’t we seen the Where method before?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-4-Projections-using-the-select-method-and-anonymous-types"><span class="nav-number">1.11.3.4.</span> <span class="nav-text">10.3.4 Projections using the select method and anonymous types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-5-Sorting-using-the-OrderBy-method"><span class="nav-number">1.11.3.5.</span> <span class="nav-text">10.3.5 Sorting using the OrderBy method</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-6-Business-examples-involving-chaining"><span class="nav-number">1.11.3.6.</span> <span class="nav-text">10.3.6 Business examples involving chaining</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-4-Usage-ideas-and-guidelines"><span class="nav-number">1.11.4.</span> <span class="nav-text">10.4 Usage ideas and guidelines</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-4-1-“Extending-the-world-“-and-making-interfaces-richer"><span class="nav-number">1.11.4.1.</span> <span class="nav-text">10.4.1 “Extending the world “ and making interfaces richer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-4-2-Fluent-interfaces"><span class="nav-number">1.11.4.2.</span> <span class="nav-text">10.4.2 Fluent interfaces</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-4-3-Using-extension-methods-sensibly"><span class="nav-number">1.11.4.3.</span> <span class="nav-text">10.4.3 Using extension methods sensibly</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-5-Summary"><span class="nav-number">1.11.5.</span> <span class="nav-text">10.5 Summary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LINQ"><span class="nav-number">1.12.</span> <span class="nav-text">LINQ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-Introducing-LINQ"><span class="nav-number">1.12.1.</span> <span class="nav-text">11.1 Introducing LINQ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-Simple-beginnings-selecting-elements"><span class="nav-number">1.12.2.</span> <span class="nav-text">11.2 Simple beginnings : selecting elements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-Filtering-and-ordering-a-sequence"><span class="nav-number">1.12.3.</span> <span class="nav-text">11.3 Filtering and ordering a sequence</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-4-Let-clauses-and-transparent-identifiers"><span class="nav-number">1.12.4.</span> <span class="nav-text">11.4 Let clauses and transparent identifiers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-Joins"><span class="nav-number">1.12.5.</span> <span class="nav-text">11.5 Joins</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-6-Groupings-and-continuations"><span class="nav-number">1.12.6.</span> <span class="nav-text">11.6 Groupings and continuations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-7-Choosing-between-query-expressions-and-dot-notation"><span class="nav-number">1.12.7.</span> <span class="nav-text">11.7 Choosing between query expressions and dot notation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-8-Summary"><span class="nav-number">1.12.8.</span> <span class="nav-text">11.8 Summary</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#C-4-Playing-nicely-with-others"><span class="nav-number">2.</span> <span class="nav-text">C# 4:Playing nicely with others</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#13-minor-changes-to-simplify-code"><span class="nav-number">2.1.</span> <span class="nav-text">13 minor changes to simplify code</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1-Optional-parameters-and-named-arguments"><span class="nav-number">2.1.1.</span> <span class="nav-text">13.1 Optional parameters and named arguments</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2-Improvements-for-COM-interoperablity"><span class="nav-number">2.1.2.</span> <span class="nav-text">13.2 Improvements for COM interoperablity</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-3-Generic-variance-for-interfaces-and-delegates"><span class="nav-number">2.1.3.</span> <span class="nav-text">13.3 Generic variance for interfaces and delegates</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-4-Teeny-tiny-changes-to-locking-and-field-like-events"><span class="nav-number">2.1.4.</span> <span class="nav-text">13.4 Teeny tiny changes to locking and field-like events</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-5-Summary"><span class="nav-number">2.1.5.</span> <span class="nav-text">13.5 Summary</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Psmyfish</span>

  
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
